<html><head><meta charset="UTF-8"></head><body>
<hr><h2>strings.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">in pike only double quotes are used for strings</span>
<span class="comment-delimiter">// </span><span class="comment">they are not interpolated.</span>
<span class="comment-delimiter">// </span><span class="comment">single quotes are used for chars (the integer value of a character)</span>
<span class="comment-delimiter">// </span><span class="comment">see chapter 1.4</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> str<span class="punctuation">;</span>                     <span class="comment-delimiter">// </span><span class="comment">declare a variable of type string</span>
str = <span class="string">"\n"</span><span class="punctuation">;</span>                     <span class="comment-delimiter">// </span><span class="comment">a "newline" character</span>
str = <span class="string">"Jon \"Maddog\" Orwant"</span><span class="punctuation">;</span>  <span class="comment-delimiter">// </span><span class="comment">literal double quotes</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
str =
#<span class="string">"This is a multiline string
terminated by a double-quote like any other string"</span><span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">accessing part of a string</span>
<span class="comment-delimiter">//</span><span class="comment">------------------------------</span>
<span class="type">string</span> str, value<span class="punctuation">;</span>
<span class="type">int</span> offset, count<span class="punctuation">;</span>
value = str<span class="punctuation">[</span>offset..offset+count<span class="punctuation">];</span>
value = str<span class="punctuation">[</span>offset..<span class="punctuation">];</span>

<span class="type">string</span> newstring, newtail<span class="punctuation">;</span>
str = str<span class="punctuation">[</span>..offset<span class="number">-1</span><span class="punctuation">]</span>+newstring+str<span class="punctuation">[</span>offset+count..<span class="punctuation">];</span>
str = str<span class="punctuation">[</span>..offset<span class="number">-1</span><span class="punctuation">]</span>+newtail<span class="punctuation">;</span>

<span class="comment-delimiter">//</span><span class="comment">------------------------------</span>
<span class="comment-delimiter">// </span><span class="comment">get a 5-byte string, skip 3, then grab 2 8-byte strings, then the rest</span>
<span class="type">string</span> leading, s1, s2, trailing<span class="punctuation">;</span>
<span class="punctuation">[</span>leading, s1, s2, trailing<span class="punctuation">]</span> = array_sscanf<span class="punctuation">(</span>str, <span class="string">"%5s%*3s%8s%8s%s"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">split at five byte boundaries</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> fivers = str/<span class="number">5</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">chop string into individual characters</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> chars = str/<span class="string">""</span><span class="punctuation">;</span>

<span class="comment-delimiter">//</span><span class="comment">------------------------------</span>

str = <span class="string">"This is what you have"</span><span class="punctuation">;</span> 

<span class="type">string</span> first, start, rest, last, end, piece<span class="punctuation">;</span>
<span class="type">int</span> t = str<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">84</span>
first = str<span class="punctuation">[</span><span class="number">0</span>..<span class="number">0</span><span class="punctuation">];</span>                     
<span class="comment-delimiter">// </span><span class="comment">"T"          </span>
start = str<span class="punctuation">[</span><span class="number">5</span>..<span class="number">5</span>+<span class="number">1</span><span class="punctuation">];</span> 
<span class="comment-delimiter">// </span><span class="comment">"is"</span>
rest  = str<span class="punctuation">[</span><span class="number">13</span>..<span class="punctuation">];</span>   
<span class="comment-delimiter">// </span><span class="comment">"you have"</span>
last  = str<span class="punctuation">[</span>sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-1</span>..sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">"e"</span>
end   = str<span class="punctuation">[</span>sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-4</span>..<span class="punctuation">];</span> 
<span class="comment-delimiter">// </span><span class="comment">"have"                 </span>
piece = str<span class="punctuation">[</span>sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-8</span>..sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-8</span>+<span class="number">2</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">"you"</span>
               
str = <span class="string">"This is what you have"</span><span class="punctuation">;</span>               
str = replace<span class="punctuation">(</span>str, <span class="punctuation">([</span> <span class="string">" is "</span>:<span class="string">" wasn't "</span> <span class="punctuation">])</span> <span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">"This wasn't what you have"</span>
str = str<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-13</span><span class="punctuation">]</span>+<span class="string">"ondrous"</span><span class="punctuation">;</span>       
<span class="comment-delimiter">// </span><span class="comment">"This wasn't wondrous"</span>
str = str<span class="punctuation">[</span><span class="number">1</span>..<span class="punctuation">];</span> 
<span class="comment-delimiter">// </span><span class="comment">"his wasn't wondrous"               </span>
str = str<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="number">-11</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">"his wasn'"            </span>
str = <span class="string">"This is what you have"</span><span class="punctuation">;</span>
str = replace<span class="punctuation">(</span>str<span class="punctuation">[</span>..<span class="number">4</span><span class="punctuation">]</span>, <span class="punctuation">([</span> <span class="string">"is"</span>:<span class="string">"at"</span> <span class="punctuation">])</span> <span class="punctuation">)</span>+str<span class="punctuation">[</span><span class="number">5</span>..<span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">"That is what you have"    </span>
str = <span class="string">"make a hat"</span><span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">"make a hat"          </span>
<span class="punctuation">[</span>str<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, str<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]]</span> = <span class="punctuation">({</span> str<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]</span>, str<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">});</span>
<span class="comment-delimiter">// </span><span class="comment">"take a ham"</span>

<span class="type">string</span> a, b, c<span class="punctuation">;</span>
a = <span class="string">"To be or not to be"</span><span class="punctuation">;</span>    
b = a<span class="punctuation">[</span><span class="number">6</span>..<span class="number">11</span><span class="punctuation">];</span>      
<span class="comment-delimiter">// </span><span class="comment">"or not"                </span>
b = a<span class="punctuation">[</span><span class="number">6</span>..<span class="number">7</span><span class="punctuation">];</span> c=a<span class="punctuation">[</span><span class="number">3</span>..<span class="number">4</span><span class="punctuation">];</span>            
write<span class="punctuation">(</span><span class="string">"%s\n%s\n"</span>, b, c<span class="punctuation">);</span>
<span class="comment-delimiter">/*</span><span class="comment">
or                  
be
*/</span>
<span class="comment-delimiter">//</span><span class="comment">------------------------------------------------</span>

<span class="type">string</span> cut2fmt<span class="punctuation">(</span><span class="type">int</span> ... positions<span class="punctuation">)</span>
<span class="punctuation">{</span> 
  <span class="type">string</span> template = <span class="string">""</span><span class="punctuation">;</span>
  <span class="type">int</span> lastpos  = <span class="number">1</span><span class="punctuation">;</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>positions <span class="punctuation">;;</span> <span class="type">int</span> place<span class="punctuation">)</span> 
  <span class="punctuation">{</span>      
    template += <span class="string">"A"</span> + <span class="punctuation">(</span>place - lastpos<span class="punctuation">)</span> + <span class="string">" "</span><span class="punctuation">;</span>
    lastpos = place<span class="punctuation">;</span>     
  <span class="punctuation">}</span>
  template += <span class="string">"A*"</span><span class="punctuation">;</span>
  <span class="keyword">return</span> template<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">string</span> fmt = cut2fmt<span class="punctuation">(</span><span class="number">8</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">26</span>, <span class="number">30</span><span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, fmt<span class="punctuation">);</span>
<span class="comment-delimiter">//</span><span class="comment">A7 A6 A6 A6 A4 A*         </span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">set a default, ie, only set the value if no other value is set.</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">// </span><span class="comment">use b if b is true, else c</span>
a = b || c<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">set x to y unless x is already true</span>
<span class="keyword">if</span><span class="punctuation">(</span>!x<span class="punctuation">)</span>
  x = y<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">use b if b is defined, else c</span>
<span class="comment-delimiter">// </span><span class="comment">an undefined variable would be a compile time error so this</span>
<span class="comment-delimiter">// </span><span class="comment">does not really apply. </span>

<span class="comment-delimiter">// </span><span class="comment">return b if b is defined (was supplied by the caller), else c</span>
<span class="type">int</span> foo<span class="punctuation">(</span><span class="type">int</span> c, <span class="type">int</span>|<span class="type">void</span> b<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> zero_type<span class="punctuation">(</span>b<span class="punctuation">)</span> ? c : b<span class="punctuation">;</span>
<span class="punctuation">}</span>

foo = bar || <span class="string">"DEFAULT VALUE"</span><span class="punctuation">;</span>
argv = argv<span class="punctuation">[</span><span class="number">1</span>..<span class="punctuation">];</span>              <span class="comment-delimiter">// </span><span class="comment">remove program, as that is always set.</span>
dir = argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> || <span class="string">"/tmp"</span><span class="punctuation">;</span>       <span class="comment-delimiter">// </span><span class="comment">and see if anything is left...</span>
dir = sizeof<span class="punctuation">(</span>argv<span class="punctuation">)</span> ? argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> : <span class="string">"/tmp"</span><span class="punctuation">;</span>
count<span class="punctuation">[</span>shell||<span class="string">"/bin/sh"</span><span class="punctuation">]</span>++<span class="punctuation">;</span>     

user = getenv<span class="punctuation">(</span><span class="string">"USER"</span><span class="punctuation">)</span> || getenv<span class="punctuation">(</span><span class="string">"LOGNAME"</span><span class="punctuation">)</span> || getpwuid<span class="punctuation">(</span>getuid<span class="punctuation">())[</span><span class="number">0</span><span class="punctuation">]</span> ||
<span class="string">"Unknown uid number "</span>+getuid<span class="punctuation">();</span>

<span class="keyword">if</span><span class="punctuation">(</span>!starting_point<span class="punctuation">)</span>
  starting_point = <span class="string">"Greenwich"</span><span class="punctuation">;</span>

<span class="keyword">if</span><span class="punctuation">(</span>!sizeof<span class="punctuation">(</span>a<span class="punctuation">))</span>                  
  a = b<span class="punctuation">;</span>              <span class="comment-delimiter">// </span><span class="comment">copy only if empty              </span>
a = <span class="punctuation">(</span>sizeof<span class="punctuation">(</span>b<span class="punctuation">)</span>?b:c<span class="punctuation">);</span>  <span class="comment-delimiter">// </span><span class="comment">assign b if nonempty, else c</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="punctuation">[</span>var1, var2<span class="punctuation">]</span> = <span class="punctuation">({</span> var2, var1 <span class="punctuation">});</span>  <span class="comment-delimiter">// </span><span class="comment">gee, i love this example.        </span>
                                  <span class="comment-delimiter">// </span><span class="comment">it didn't even occur to me before</span>
                                  <span class="comment-delimiter">// </span><span class="comment">:-)</span>
temp = a<span class="punctuation">;</span>
a    = b<span class="punctuation">;</span>             
b    = temp<span class="punctuation">;</span>

a = <span class="string">"alpha"</span><span class="punctuation">;</span>
b = <span class="string">"omega"</span><span class="punctuation">;</span>
<span class="punctuation">[</span>a, b<span class="punctuation">]</span> = <span class="punctuation">({</span> b, a <span class="punctuation">});</span>

<span class="punctuation">[</span>alpha, beta, production<span class="punctuation">]</span> = <span class="string">"January March August"</span>/<span class="string">" "</span><span class="punctuation">;</span>
<span class="punctuation">[</span>alpha, beta, production<span class="punctuation">]</span> = <span class="punctuation">({</span> beta, production, alpha <span class="punctuation">});</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">print the ascii value of a char, or the char from its ascii value</span>
<span class="type">int</span> i<span class="punctuation">;</span>                          <span class="comment-delimiter">// </span><span class="comment">declare a variable of type int             </span>
i = <span class="string">'a'</span><span class="punctuation">;</span>                        <span class="comment-delimiter">// </span><span class="comment">the ascii value of "a"</span>
i = <span class="string">'\n'</span><span class="punctuation">;</span>                       <span class="comment-delimiter">// </span><span class="comment">the ascii value of a "newline"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> char = <span class="string">"foo"</span><span class="punctuation">;</span>
<span class="type">int</span> num = char<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>   <span class="comment-delimiter">// </span><span class="comment">gets the ascii value from the first char (that's</span>
                     <span class="comment-delimiter">// </span><span class="comment">what ord() in perl does)</span>
char = <span class="constant">String</span>.int2char<span class="punctuation">(</span>num<span class="punctuation">);</span>

char = sprintf<span class="punctuation">(</span><span class="string">"%c"</span>,num<span class="punctuation">);</span>   <span class="comment-delimiter">// </span><span class="comment">the same as String.int2char(num) :-)</span>
write<span class="punctuation">(</span><span class="string">"Number %d is character %[0]c\n"</span>, num<span class="punctuation">);</span>

Number <span class="number">101</span> is character e

<span class="type">string</span> str<span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr<span class="punctuation">;</span>
arr = <span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span>str<span class="punctuation">;</span>
str = <span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span>arr<span class="punctuation">;</span>
<span class="type">int</span> ascii_value = <span class="string">'e'</span><span class="punctuation">;</span>                      <span class="comment-delimiter">// </span><span class="comment">now 101</span>
<span class="type">string</span> character = <span class="constant">String</span>.int2char<span class="punctuation">(</span><span class="number">101</span><span class="punctuation">);</span>    <span class="comment-delimiter">// </span><span class="comment">now "e"                  </span>

write<span class="punctuation">(</span><span class="string">"Number %d is character %[0]c\n"</span>, <span class="number">101</span><span class="punctuation">);</span>


<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ascii_character_numbers = <span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">))</span><span class="string">"sample"</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, <span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">))</span>ascii_character_numbers*<span class="string">" "</span><span class="punctuation">);</span>    

<span class="type">string</span> word = <span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span>ascii_character_numbers<span class="punctuation">;</span>
<span class="type">string</span> word = <span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)({</span> <span class="number">115</span>, <span class="number">97</span>, <span class="number">109</span>, <span class="number">112</span>, <span class="number">108</span>, <span class="number">101</span> <span class="punctuation">});</span>  <span class="comment-delimiter">// </span><span class="comment">same</span>
write<span class="punctuation">(</span>word+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">sample           </span>

<span class="type">string</span> hal =<span class="string">"HAL"</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ascii = <span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span>hal<span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ibm = ascii<span class="punctuation">[</span>*<span class="punctuation">]</span>+<span class="number">1</span><span class="punctuation">;</span>       <span class="comment-delimiter">// </span><span class="comment">add 1 to each element in the array.</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ibm = map<span class="punctuation">(</span>ascii, `+, <span class="number">1</span><span class="punctuation">)</span> <span class="comment-delimiter">// </span><span class="comment">apply the function +, with the argument</span>
                                   <span class="comment-delimiter">// </span><span class="comment">1, to each element in the array.</span>
write<span class="punctuation">(</span>ibm+<span class="string">"\n"</span><span class="punctuation">);</span>                   <span class="comment-delimiter">// </span><span class="comment">prints "IBM"</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> hello = <span class="string">"Hello world!"</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> chars = hello/<span class="string">""</span><span class="punctuation">;</span>     <span class="comment-delimiter">// </span><span class="comment">array of characters as strings</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>chars<span class="punctuation">;;</span> <span class="type">string</span> char<span class="punctuation">)</span>        <span class="comment-delimiter">// </span><span class="comment">this also matches newlines</span>
  <span class="punctuation">;</span>  <span class="comment-delimiter">// </span><span class="comment">do stuff with char</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> data = <span class="string">"an apple a day"</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> chars = data/<span class="string">""</span><span class="punctuation">;</span>
<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">int</span><span class="punctuation">)</span> seen = <span class="punctuation">([]);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>chars <span class="punctuation">;;</span> <span class="type">string</span> char<span class="punctuation">)</span>
  seen<span class="punctuation">[</span>char<span class="punctuation">]</span>++<span class="punctuation">;</span> 

write<span class="punctuation">(</span><span class="string">"unique chars are: %s\n"</span>, sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>seen<span class="punctuation">))</span>*<span class="string">""</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">unique chars are:  adelnpy</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> data = <span class="string">"an apple a day"</span><span class="punctuation">;</span>
<span class="type">string</span> result = sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>mkmapping<span class="punctuation">(</span>data/<span class="string">""</span>, allocate<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>data<span class="punctuation">))))</span>*<span class="string">""</span><span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"unique chars are: %s\n"</span>, result<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">unique chars are:  adelnpy</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> data = <span class="string">"an apple a day"</span><span class="punctuation">;</span>
<span class="type">int</span> sum<span class="punctuation">;</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>data <span class="punctuation">;;</span> <span class="type">int</span> char<span class="punctuation">)</span>
  sum += char<span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"sum is %d\n"</span>, sum<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">sum is 1248</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> data = <span class="string">"an apple a day"</span><span class="punctuation">;</span>
<span class="type">int</span> sum=`+<span class="punctuation">(</span>@<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span>data<span class="punctuation">);</span>  

write<span class="punctuation">(</span><span class="string">"sum is %d\n"</span>, sum<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">sum is 1248</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/sum.html">download the following standalone program</a></font>
</span>#/usr/bin/pike
<span class="comment-delimiter">// </span><span class="comment">chapter 1.5
</span><span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> data = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
  <span class="type">int</span> checksum<span class="punctuation">;</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>data <span class="punctuation">;;</span> <span class="type">int</span> char<span class="punctuation">)</span>
    checksum += char<span class="punctuation">;</span>

  checksum %= pow<span class="punctuation">(</span><span class="number">2</span>,<span class="number">16</span><span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">;</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, checksum<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">// </span><span class="comment">alternate version</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/sum2.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 1.5
</span><span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> data=<span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
  <span class="type">int</span> checksum = `+<span class="punctuation">(</span>@<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span>data<span class="punctuation">)</span> % <span class="punctuation">((</span><span class="number">1</span>&lt;&lt;<span class="number">16</span><span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">);</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, checksum<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/slowcat.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 1.5
</span><span class="comment-delimiter">// </span><span class="comment">slowcat - emulate a   s l o w  line printer
</span><span class="comment-delimiter">// </span><span class="comment">usage: slowcat [-DELAY] [files ...]
</span><span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> files<span class="punctuation">;</span>
  <span class="type">int</span> delay = <span class="number">1</span><span class="punctuation">;</span>

  <span class="keyword">if</span><span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">][</span><span class="number">0</span><span class="punctuation">]</span> == <span class="string">'-'</span><span class="punctuation">)</span>
  <span class="punctuation">{</span>
    files = argv<span class="punctuation">[</span><span class="number">2</span>..<span class="punctuation">];</span>
    delay = <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">][</span><span class="number">1</span>..<span class="punctuation">];</span>
  <span class="punctuation">}</span>
  <span class="keyword">else</span>
    files = argv<span class="punctuation">[</span><span class="number">1</span>..<span class="punctuation">];</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>files, <span class="type">string</span> file<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">string</span> data = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>file<span class="punctuation">);</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>data/<span class="string">""</span>, <span class="type">string</span> char<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      write<span class="punctuation">(</span>char<span class="punctuation">);</span>
      sleep<span class="punctuation">(</span><span class="number">0.005</span>*delay<span class="punctuation">);</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">#1.6 (reverse a string by char/word)</span>
<span class="comment-delimiter">// </span><span class="comment">by Olivier Girondel</span>

<span class="type">string</span> s = <span class="string">"This is  a string"</span><span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This is  a string"</span>

reverse<span class="punctuation">(</span>s<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "gnirts a  si sihT"</span>

reverse<span class="punctuation">(</span>s/<span class="string">" "</span><span class="punctuation">)</span> * <span class="string">" "</span><span class="punctuation">;</span>               <span class="comment-delimiter">// </span><span class="comment">preserve whitespace</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "string a  is This"</span>

<span class="punctuation">(</span>reverse<span class="punctuation">(</span>s/<span class="string">" "</span><span class="punctuation">)</span>-<span class="punctuation">({</span> <span class="string">""</span> <span class="punctuation">}))</span> * <span class="string">" "</span><span class="punctuation">;</span>    <span class="comment-delimiter">// </span><span class="comment">collapse whitespace</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "string a is This"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> word = <span class="string">"reviver"</span><span class="punctuation">;</span>
<span class="type">int</span> is_palindrome = word==reverse<span class="punctuation">(</span>word<span class="punctuation">);</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/palindrome.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 1.6
</span><span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> data=<span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>data/<span class="string">"\n"</span>, <span class="type">string</span> line<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="keyword">if</span><span class="punctuation">(</span>line==reverse<span class="punctuation">(</span>line<span class="punctuation">)</span> &amp;&amp; sizeof<span class="punctuation">(</span>line<span class="punctuation">)</span>&gt;<span class="number">5</span><span class="punctuation">)</span>
    write<span class="punctuation">(</span><span class="string">"%s\n"</span>, line<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> s = <span class="string">"This         is                a    \n   string"</span><span class="punctuation">;</span>

<span class="type">string</span> notabs=<span class="constant">String</span>.expand_tabs<span class="punctuation">(</span>s<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This     is                a    \n   string"</span>

<span class="type">string</span> notabs=<span class="constant">String</span>.expand_tabs<span class="punctuation">(</span>s, <span class="number">4</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This     is            a    \n   string"</span>

<span class="type">string</span> notabs=<span class="constant">String</span>.expand_tabs<span class="punctuation">(</span>s, <span class="number">4</span>, <span class="string">"-"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This   - is --------   a ---\n   string"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> s = <span class="string">"This     is      a     string"</span><span class="punctuation">;</span>
<span class="type">string</span> tabs=<span class="string">""</span><span class="punctuation">;</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>s/<span class="number">8.0</span> <span class="punctuation">;;</span> <span class="type">string</span> stop<span class="punctuation">)</span>
<span class="punctuation">{</span> 
  <span class="type">int</span> spaces=sizeof<span class="punctuation">(</span><span class="constant">String</span>.common_prefix<span class="punctuation">(({</span> reverse<span class="punctuation">(</span>stop<span class="punctuation">)</span>, <span class="string">"        "</span><span class="punctuation">})));</span> 
  tabs+=stop<span class="punctuation">[</span>..<span class="number">7</span>-spaces<span class="punctuation">];</span> 
  <span class="keyword">if</span><span class="punctuation">(</span>spaces<span class="punctuation">)</span>
    tabs+=<span class="string">"^I"</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This\t is\t a     string"</span>

<span class="type">string</span> notabs=<span class="string">""</span><span class="punctuation">;</span> 
<span class="keyword">foreach</span><span class="punctuation">(</span>tabs/<span class="string">"^I"</span> <span class="punctuation">;;</span> <span class="type">string</span> stop<span class="punctuation">)</span>
<span class="punctuation">{</span> 
  notabs+=stop<span class="punctuation">;</span> 
  <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>stop<span class="punctuation">)</span>&lt;<span class="number">8</span><span class="punctuation">)</span> 
    notabs+=<span class="string">" "</span>*<span class="punctuation">(</span><span class="number">8</span>-sizeof<span class="punctuation">(</span>stop<span class="punctuation">));</span> 
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "This     is      a     string"</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">since variable names in pike do not have a special notation we need to </span>
<span class="comment-delimiter">// </span><span class="comment">"invent" one for this.</span>
<span class="comment-delimiter">// </span><span class="comment">there are a few ways to solve this problem.</span>
<span class="comment-delimiter">// </span><span class="comment">here is one:</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> vars = <span class="punctuation">([</span> <span class="string">"$fruit$"</span>:<span class="string">"apple"</span>, <span class="string">"$desert$"</span>:<span class="string">"pudding"</span> <span class="punctuation">]);</span>
<span class="type">string</span> template  = <span class="string">"Todays fruit is $fruit$, and for desert we have $desert$"</span><span class="punctuation">;</span>
<span class="type">string</span> menu = replace<span class="punctuation">(</span>template, vars<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Result: "Todays fruit is apple, and for desert we have pudding"</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> upper, lower, result<span class="punctuation">;</span>
upper = <span class="string">"DON'T SHOUT!"</span><span class="punctuation">;</span>
result = lower_case<span class="punctuation">(</span>upper<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "don't shout!"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
lower = <span class="string">"speak up"</span><span class="punctuation">;</span>
result = upper_case<span class="punctuation">(</span>lower<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "SPEAK UP"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
result = <span class="constant">String</span>.capitalize<span class="punctuation">(</span>lower<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "Speak up"</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> text = <span class="string">"thIS is a loNG liNE"</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> words = text/<span class="string">" "</span><span class="punctuation">;</span>       <span class="comment-delimiter">// </span><span class="comment">splits the line into words</span>
words = lower_case<span class="punctuation">(</span>words<span class="punctuation">[</span>*<span class="punctuation">]);</span>         <span class="comment-delimiter">// </span><span class="comment">lower_case each word</span>
words = <span class="constant">String</span>.capitalize<span class="punctuation">(</span>words<span class="punctuation">[</span>*<span class="punctuation">]);</span>  <span class="comment-delimiter">// </span><span class="comment">capitalize each word</span>
text = words*<span class="string">" "</span><span class="punctuation">;</span>                     <span class="comment-delimiter">// </span><span class="comment">join back</span>
<span class="comment-delimiter">// </span><span class="comment">you may do the same in one short line:</span>
text = <span class="constant">String</span>.capitalize<span class="punctuation">(</span>lower_case<span class="punctuation">((</span>text/<span class="string">" "</span><span class="punctuation">)[</span>*<span class="punctuation">])[</span>*<span class="punctuation">])</span>*<span class="string">" "</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/randcap">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 1.9
</span><span class="comment-delimiter">// </span><span class="comment">randcap: filter to randomly capitalize 20% of the letters
</span>
<span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">string</span> input<span class="punctuation">;</span>
  <span class="keyword">while</span><span class="punctuation">(</span>input=<span class="constant">Stdio</span>.<span class="constant">stdin</span>.read<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">))</span>
    write<span class="punctuation">(</span>randcap<span class="punctuation">(</span>input<span class="punctuation">));</span>
<span class="punctuation">}</span>

<span class="type">string</span> randcap<span class="punctuation">(</span><span class="type">string</span> char<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>random<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span>&lt;<span class="number">20</span><span class="punctuation">)</span>
    char=<span class="constant">String</span>.capitalize<span class="punctuation">(</span>char<span class="punctuation">);</span>
  <span class="keyword">return</span> char<span class="punctuation">;</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">since pike does not provide any string interpolation </span>
<span class="comment-delimiter">// </span><span class="comment">there are no sneaky tricks here.</span>
<span class="comment-delimiter">// </span><span class="comment">a solution could be similar to the one in chapter 1.8</span>
<span class="comment-delimiter">// </span><span class="comment">putting functions into the mapping instead of string values, or use xml and</span>
<span class="comment-delimiter">// </span><span class="comment">callbacks</span>
<span class="comment-delimiter">// </span><span class="comment">TODO: provide an example of using the xml parser here</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">we believe that indenting the string and then removing that indent does not</span>
<span class="comment-delimiter">// </span><span class="comment">actually enhance readability of the code.</span>
<span class="comment-delimiter">// </span><span class="comment">but if you insist the following will remove all whitespace at the beginning</span>
<span class="comment-delimiter">// </span><span class="comment">of each line:</span>
<span class="type">string</span> here=#<span class="string">"your text
              goes here"</span><span class="punctuation">;</span>
    
<span class="type">string</span> there=array_sscanf<span class="punctuation">((</span>here/<span class="string">"\n"</span><span class="punctuation">)[</span>*<span class="punctuation">]</span>, <span class="string">"%*[\t ]%s"</span><span class="punctuation">)[</span>*<span class="punctuation">][</span><span class="number">0</span><span class="punctuation">]</span>*<span class="string">"\n"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">expanded version:</span>
<span class="type">array</span> tmp=<span class="punctuation">({});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>here/<span class="string">"\n"</span><span class="punctuation">;;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  tmp+=array_sscanf<span class="punctuation">(</span>line, <span class="string">"%*[\t ]%s"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="type">string</span> there=tmp*<span class="string">"\n"</span><span class="punctuation">;</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">pike sprintf() provides a facility for wrapping (column mode):</span>
<span class="comment-delimiter">// </span><span class="comment">sprintf("%-=&lt;int width&gt;s", text);</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch01/wrapdemo">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 1.12
</span><span class="comment-delimiter">// </span><span class="comment">wrapdemo - show how wrapping with sprintf works
</span><span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> input = <span class="punctuation">({</span> <span class="string">"Folding and splicing is the work of an editor,"</span>,
                           <span class="string">"not a mere collection of silicon"</span>,
                           <span class="string">"and"</span>,
                           <span class="string">"mobile electrons!"</span><span class="punctuation">});</span>
  <span class="type">int</span> columns = <span class="number">20</span><span class="punctuation">;</span>

  write<span class="punctuation">(</span><span class="string">"0123456789"</span>*<span class="number">2</span>+<span class="string">"\n"</span><span class="punctuation">);</span>
  write<span class="punctuation">(</span>wrap<span class="punctuation">(</span>input*<span class="string">" "</span>, <span class="number">20</span>, <span class="string">"  "</span>, <span class="string">"  "</span><span class="punctuation">)</span>+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">unlike the perl version here leadtab is relative to nexttab, 
</span><span class="comment-delimiter">// </span><span class="comment">to get a shorter lead use a negative int value. this allows the default of 0
</span><span class="comment-delimiter">// </span><span class="comment">to be a lead indent that is the same as nexttab, and it also has the
</span><span class="comment-delimiter">// </span><span class="comment">advantage of allowing you to change the indent without having to worry about
</span><span class="comment-delimiter">// </span><span class="comment">the lead getting messed up.
</span><span class="comment-delimiter">// </span><span class="comment">a negative lead will cut away from the nexttab which will be visible if you
</span><span class="comment-delimiter">// </span><span class="comment">use something other than spaces
</span><span class="type">string</span> wrap<span class="punctuation">(</span><span class="type">string</span> text, <span class="type">void</span>|<span class="type">int</span> width, 
            <span class="type">void</span>|<span class="type">string</span>|<span class="type">int</span> nexttab, <span class="type">void</span>|<span class="type">string</span>|<span class="type">int</span> leadtab<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> leadindent=<span class="string">""</span><span class="punctuation">;</span>
  <span class="type">string</span> indent=<span class="string">""</span><span class="punctuation">;</span> 
  <span class="type">string</span> indent2=<span class="string">""</span><span class="punctuation">;</span>

  <span class="keyword">if</span><span class="punctuation">(</span>!width<span class="punctuation">)</span>
    width=<span class="constant">Stdio</span>.stdout-&gt;tcgetattr<span class="punctuation">()</span>-&gt;columns<span class="punctuation">;</span>

  <span class="keyword">if</span><span class="punctuation">(</span>stringp<span class="punctuation">(</span>nexttab<span class="punctuation">))</span>
  <span class="punctuation">{</span>
    indent=nexttab<span class="punctuation">;</span>
    width-=sizeof<span class="punctuation">(</span>nexttab<span class="punctuation">);</span>  <span class="comment-delimiter">// </span><span class="comment">this will be off if there are chars that have a
</span>                             <span class="comment-delimiter">// </span><span class="comment">different width than 1.
</span>  <span class="punctuation">}</span>
  <span class="keyword">else</span> <span class="keyword">if</span><span class="punctuation">(</span>intp<span class="punctuation">(</span>nexttab<span class="punctuation">))</span>
  <span class="punctuation">{</span>
    indent=<span class="string">" "</span>*nexttab<span class="punctuation">;</span>
    width-=nexttab<span class="punctuation">;</span>
  <span class="punctuation">}</span>

  <span class="keyword">if</span><span class="punctuation">(</span>stringp<span class="punctuation">(</span>leadtab<span class="punctuation">))</span>
    leadindent=leadtab<span class="punctuation">;</span>
  <span class="keyword">else</span> <span class="keyword">if</span><span class="punctuation">(</span>intp<span class="punctuation">(</span>leadtab<span class="punctuation">))</span>
    <span class="keyword">if</span><span class="punctuation">(</span>leadtab &gt; <span class="number">0</span><span class="punctuation">)</span>
      leadindent=<span class="string">" "</span>*leadtab<span class="punctuation">;</span>
    <span class="keyword">else</span> <span class="keyword">if</span><span class="punctuation">(</span>leadtab &lt; <span class="number">0</span><span class="punctuation">)</span>
    <span class="punctuation">{</span>
      write<span class="punctuation">(</span>indent+<span class="string">".\n"</span><span class="punctuation">);</span>
      indent=indent<span class="punctuation">[</span>..<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>indent<span class="punctuation">)</span>+leadtab<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">];</span>
      write<span class="punctuation">(</span>indent+<span class="string">".\n"</span><span class="punctuation">);</span>
      indent2=text<span class="punctuation">[</span>..-leadtab<span class="number">-1</span><span class="punctuation">];</span> 
      text=text<span class="punctuation">[</span>-leadtab..<span class="punctuation">];</span>
    <span class="punctuation">}</span>
  <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"%^s%=*s%-=*s"</span>, indent, sizeof<span class="punctuation">(</span>indent2<span class="punctuation">)</span>, indent2, 
                                 width, leadindent+text<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">----------------------------------------------</span>
$ ./wrapdemo 
<span class="number">01234567890123456789</span>
    Folding and     
  splicing is the   
  work of an editor,
  not a mere        
  collection of     
  silicon and mobile
  electrons!        

<span class="comment-delimiter">// </span><span class="comment">merge multiple lines into one, then wrap one long line</span>
<span class="keyword">inherit</span> <span class="string">"wrapdemo.pike"</span><span class="punctuation">;</span>
wrap<span class="punctuation">(</span>replace<span class="punctuation">(</span>text, <span class="string">"\n"</span>, <span class="string">" "</span><span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">read stdin and split by paragraph,</span>
<span class="comment-delimiter">// </span><span class="comment">remove \n in paragraphs</span>
<span class="comment-delimiter">// </span><span class="comment">reformat</span>
<span class="comment-delimiter">// </span><span class="comment">add paragraph break</span>
<span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Stdio</span>.stdin-&gt;read<span class="punctuation">()</span>/<span class="string">"\n\n"</span><span class="punctuation">;;</span> <span class="type">string</span> para<span class="punctuation">)</span>
  write<span class="punctuation">(</span>wrap<span class="punctuation">(</span>replace<span class="punctuation">(</span>para, <span class="string">"\n"</span>, <span class="string">" "</span><span class="punctuation">))</span>+<span class="string">"\n\n"</span><span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">we need to escape the \ for this example, ironic, eh?</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> charlist=<span class="punctuation">({</span> <span class="string">"%"</span>, <span class="string">"\\"</span> <span class="punctuation">});</span> 
<span class="type">string</span> var=<span class="string">"some input % text with \\"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">backslash</span>
var=replace<span class="punctuation">(</span>var, charlist, <span class="string">"\\"</span>+charlist<span class="punctuation">[</span>*<span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">double</span>
var=replace<span class="punctuation">(</span>var, charlist, charlist<span class="punctuation">[</span>*<span class="punctuation">]</span>+charlist<span class="punctuation">[</span>*<span class="punctuation">]);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> line=<span class="string">" foo\n\t "</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> many=<span class="punctuation">({</span> <span class="string">" bar\n\t "</span>, <span class="string">" baz\t "</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">remove spaces and tabs</span>
line=<span class="constant">String</span>.trim_whites<span class="punctuation">(</span>line<span class="punctuation">);</span>
many=<span class="constant">String</span>.trim_whites<span class="punctuation">(</span>many<span class="punctuation">[</span>*<span class="punctuation">]);</span>

<span class="comment-delimiter">//</span><span class="comment">remove spaces, tabs, newlines and carriage returns</span>
line=<span class="constant">String</span>.trim_all_whites<span class="punctuation">(</span>line<span class="punctuation">);</span>
many=<span class="constant">String</span>.trim_all_whites<span class="punctuation">(</span>many<span class="punctuation">[</span>*<span class="punctuation">]);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">contributed by martin nilsson</span>

write<span class="punctuation">(</span><span class="string">"Lookup user: "</span><span class="punctuation">);</span>
<span class="type">string</span> user = <span class="constant">String</span>.soundex<span class="punctuation">(</span><span class="constant">Stdio</span>.<span class="constant">stdin</span>.gets<span class="punctuation">());</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>get_all_users<span class="punctuation">()</span>, <span class="type">array</span> u<span class="punctuation">)</span> 
<span class="punctuation">{</span>
  <span class="type">string</span> firstname=<span class="string">""</span>, lastname=<span class="string">""</span><span class="punctuation">;</span>
  sscanf<span class="punctuation">(</span>u<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span>, <span class="string">"%s %s,"</span>, firstname, lastname<span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span> user==<span class="constant">String</span>.soundex<span class="punctuation">(</span>u<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">])</span> ||
      user==<span class="constant">String</span>.soundex<span class="punctuation">(</span>firstname<span class="punctuation">)</span> ||
      user==<span class="constant">String</span>.soundex<span class="punctuation">(</span>lastname<span class="punctuation">)</span> <span class="punctuation">)</span>
    write<span class="punctuation">(</span><span class="string">"%s: %s %s\n"</span>, u<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, firstname, lastname<span class="punctuation">);</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Pike
</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>numbers.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Numbers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Strings"
HREF="strings.html"><LINK
REL="NEXT"
TITLE="Dates and Times"
HREF="datesandtimes.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NUMBERS"
>2. Numbers</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN73"
>Checking Whether a String Is a Valid Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> number=<span class="string">"123.3asdf"</span><span class="punctuation">;</span>

<span class="type">int</span>|<span class="type">float</span> realnumber= <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>number<span class="punctuation">;</span>  <span class="comment-delimiter">// </span><span class="comment">casting to int will throw away all</span>
                                    <span class="comment-delimiter">// </span><span class="comment">nonnumber parts</span>
<span class="type">string</span> rest<span class="punctuation">;</span>
<span class="punctuation">[</span>realnumber, rest<span class="punctuation">]</span> = array_sscanf<span class="punctuation">(</span>number, <span class="string">"%d%s"</span><span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">scan for an integer</span>
<span class="comment-delimiter">// </span><span class="comment">if rest contains anything but the empty string, then there was more than a</span>
<span class="comment-delimiter">// </span><span class="comment">number in the string</span>
<span class="comment-delimiter">// </span><span class="comment">use %f to scan for float, %x for hex or %o for octal</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN76"
>Comparing Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> same<span class="punctuation">(</span><span class="type">float</span> one, <span class="type">float</span> two, <span class="type">int</span> accuracy<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"%.*f"</span>, accuracy, one<span class="punctuation">)</span> == sprintf<span class="punctuation">(</span><span class="string">"%.*f"</span>, accuracy, two<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">int</span> wage=<span class="number">536</span><span class="punctuation">;</span>
<span class="type">int</span> week=<span class="number">40</span>*wage<span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"one week's wage is: $%.2f\n"</span>, week/<span class="number">100.0</span><span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN79"
>Rounding Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">float</span> unrounded=<span class="number">3.5</span><span class="punctuation">;</span>
<span class="type">string</span> rounded=sprintf<span class="punctuation">(</span><span class="string">"%.*f"</span>, accuracy, unrounded<span class="punctuation">);</span>

<span class="type">float</span> a=<span class="number">0.255</span><span class="punctuation">;</span>
<span class="type">string</span> b=sprintf<span class="punctuation">(</span><span class="string">"%.2f"</span>, a<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"Unrounded: %f\nRounded: %s\n"</span>, a, b<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"Unrounded: %f\nRounded: %.2f\n"</span>, a, a<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">dec to bin</span>
<span class="type">string</span> bin=sprintf<span class="punctuation">(</span><span class="string">"%b"</span>, <span class="number">5</span><span class="punctuation">);</span>

<span class="type">int</span> dec=array_sscanf<span class="punctuation">(</span><span class="string">"0000011111111111111"</span>, <span class="string">"%b"</span><span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">];</span> 
                <span class="comment-delimiter">// </span><span class="comment">array_sscanf returns an array</span>

<span class="type">int</span> num = array_sscanf<span class="punctuation">(</span><span class="string">"0110110"</span>, <span class="string">"%b"</span><span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">];</span>  <span class="comment-delimiter">// </span><span class="comment">num is 54</span>
<span class="type">string</span> binstr = sprintf<span class="punctuation">(</span><span class="string">"%b"</span>, <span class="number">54</span><span class="punctuation">);</span>           <span class="comment-delimiter">// </span><span class="comment">binstr is 110110</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN82"
>Converting Between Binary and Decimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">contributed by martin nilsson.</span>

<span class="type">string</span> dec2bin<span class="punctuation">(</span><span class="type">int</span> n<span class="punctuation">)</span> 
<span class="punctuation">{</span> 
  <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"%b"</span>,n<span class="punctuation">);</span> 
<span class="punctuation">}</span>

<span class="type">int</span> bin2dec<span class="punctuation">(</span><span class="type">string</span> n<span class="punctuation">)</span> 
<span class="punctuation">{</span> 
  <span class="keyword">return</span> array_sscanf<span class="punctuation">(</span>n, <span class="string">"%b"</span><span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">];</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN85"
>Operating on a Series of Integers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">foreach(enumerate(int count, int step, int start);; int val)</span>
<span class="comment-delimiter">// </span><span class="comment">{</span>
<span class="comment-delimiter">//   </span><span class="comment">// val is set to each of count integers starting at start</span>
<span class="comment-delimiter">// </span><span class="comment">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>enumerate<span class="punctuation">(</span>y-x+<span class="number">1</span>,<span class="number">1</span>,x<span class="punctuation">);;</span> <span class="type">int</span> val<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">val is set to every integer from X to Y, inclusive</span>
<span class="punctuation">}</span>

<span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i=x<span class="punctuation">;</span> i&lt;=y<span class="punctuation">;</span> i++<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">val is set to every integer from X to Y, inclusive</span>
<span class="punctuation">}</span>

<span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i=x<span class="punctuation">;</span> i&lt;=y<span class="punctuation">;</span> i+=<span class="number">7</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">val is set to every integer from X to Y, stepsize = 7</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>enumerate<span class="punctuation">(</span>y-x+<span class="number">1</span>,<span class="number">7</span>,x<span class="punctuation">);;</span> <span class="type">int</span> val<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">val is set to every integer from X to Y, stepsize = 7</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">----------------------------------------</span>
write<span class="punctuation">(</span><span class="string">"Infancy is: "</span><span class="punctuation">);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>enumerate<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">);;</span> <span class="type">int</span> val<span class="punctuation">)</span> 
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%d "</span>, val<span class="punctuation">);</span>
<span class="punctuation">}</span>
write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"Toddling is: %{%d %}\n"</span>, enumerate<span class="punctuation">(</span><span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span><span class="punctuation">));</span>

write<span class="punctuation">(</span><span class="string">"Childhood is: "</span><span class="punctuation">);</span>
<span class="keyword">for</span> <span class="punctuation">(</span><span class="type">int</span> i = <span class="number">5</span><span class="punctuation">;</span> i &lt;= <span class="number">12</span><span class="punctuation">;</span> i++<span class="punctuation">)</span> 
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%d "</span>, i<span class="punctuation">);</span>
<span class="punctuation">}</span>
write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Infancy is: 0 1 2 </span>
<span class="comment-delimiter">// </span><span class="comment">Toddling is: 3 4 </span>
<span class="comment-delimiter">// </span><span class="comment">Childhood is: 5 6 7 8 9 10 11 12 </span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN88"
>Working with Roman Numerals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> arabic<span class="punctuation">;</span>
<span class="type">string</span> roman = <span class="constant">String</span>.int2roman<span class="punctuation">(</span>arabic<span class="punctuation">);</span>        <span class="comment-delimiter">// </span><span class="comment">handles values up to 10000</span>

<span class="type">array</span> nums=enumerate<span class="punctuation">(</span><span class="number">10001</span><span class="punctuation">);</span>                
<span class="type">array</span> romans=<span class="constant">String</span>.int2roman<span class="punctuation">(</span>nums<span class="punctuation">[</span>*<span class="punctuation">]);</span>     
<span class="type">mapping</span> roman2int = mkmapping<span class="punctuation">(</span>romans, nums<span class="punctuation">);</span>                   

<span class="type">int</span> arabic = roman2int<span class="punctuation">[</span>roman<span class="punctuation">];</span>

<span class="comment-delimiter">//</span><span class="comment">------------------------------------------------</span>
<span class="type">string</span> roman_fifteen = <span class="constant">String</span>.int2roman<span class="punctuation">(</span><span class="number">15</span><span class="punctuation">);</span>    <span class="comment-delimiter">//  </span><span class="comment">"XV"</span>
write<span class="punctuation">(</span><span class="string">"Roman for fifteen is %s\n"</span>, roman_fifteen<span class="punctuation">);</span>

<span class="type">int</span> arabic_fifteen = roman2int<span class="punctuation">[</span>roman_fifteen<span class="punctuation">];</span>
write<span class="punctuation">(</span><span class="string">"Converted back, %s is %d\n"</span>, roman_fifteen, arabic_fifteen<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Roman for fifteen is XV</span>
<span class="comment-delimiter">// </span><span class="comment">Converted back, XV is 15</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN91"
>Generating Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> y,x<span class="punctuation">;</span>
<span class="type">int</span> rand = random<span class="punctuation">(</span>y-x+<span class="number">1</span><span class="punctuation">)</span>+x<span class="punctuation">;</span>

<span class="type">float</span> y,x<span class="punctuation">;</span>
<span class="type">float</span> rand = random<span class="punctuation">(</span>y-x+<span class="number">1</span><span class="punctuation">)</span>+x<span class="punctuation">;</span>

<span class="type">int</span> rand = random<span class="punctuation">(</span><span class="number">51</span><span class="punctuation">)</span>+<span class="number">25</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"%d\n"</span>, rand<span class="punctuation">);</span>

<span class="type">array</span> arr<span class="punctuation">;</span>
<span class="type">mixed</span> elt = arr<span class="punctuation">[</span>random<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>arr<span class="punctuation">))];</span>
<span class="type">mixed</span> elt = random<span class="punctuation">(</span>arr<span class="punctuation">);</span>

<span class="type">array</span> chars=<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@$%^&amp;*"</span>/<span class="string">""</span><span class="punctuation">;</span>
<span class="type">string</span> password = <span class="string">""</span><span class="punctuation">;</span>
<span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i=<span class="number">1</span><span class="punctuation">;</span> i&lt;=<span class="number">8</span><span class="punctuation">;</span> i++<span class="punctuation">)</span>
<span class="punctuation">{</span>
  password+=random<span class="punctuation">(</span>chars<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">string</span> password = random<span class="punctuation">((({</span>chars<span class="punctuation">})</span>*<span class="number">8</span><span class="punctuation">)[</span>*<span class="punctuation">])</span>*<span class="string">""</span><span class="punctuation">;</span>

<span class="type">string</span> password = random_string<span class="punctuation">(</span><span class="number">8</span><span class="punctuation">);</span>      <span class="comment-delimiter">// </span><span class="comment">creates an untypable string</span>

<span class="comment-delimiter">// </span><span class="comment">turn the string into something typable using the base64 charset</span>
<span class="type">string</span> password = <span class="constant">MIME</span>.encode_base64<span class="punctuation">(</span>random_string<span class="punctuation">(</span><span class="number">8</span><span class="punctuation">))[</span>..<span class="number">7</span><span class="punctuation">];</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN94"
>Generating Different Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>random_seed<span class="punctuation">(</span><span class="type">int</span> seed<span class="punctuation">);</span>
random_seed<span class="punctuation">((</span><span class="type">int</span><span class="punctuation">)</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN97"
>Making Numbers Even More Random</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Crypto.Random.random(int max)</span>
<span class="comment-delimiter">// </span><span class="comment">Crypto.Random.random_string(int length)</span>
<span class="comment-delimiter">// </span><span class="comment">Crypto.Random.blocking_random_string(int length)</span>
<span class="comment-delimiter">// </span><span class="comment">Crypto.Random.add_entropy(string random_data, int entropy)</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN100"
>Generating Biased Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">float</span> gaussian_rand<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">float</span> u1, u2, w, g1, g2<span class="punctuation">;</span>
  
  <span class="keyword">do</span>
  <span class="punctuation">{</span>
    u1 = <span class="number">2.0</span> * random<span class="punctuation">(</span><span class="number">1.0</span><span class="punctuation">)</span> - <span class="number">1.0</span><span class="punctuation">;</span> u2 = <span class="number">2.0</span> * random<span class="punctuation">(</span><span class="number">1.0</span><span class="punctuation">)</span> - <span class="number">1.0</span><span class="punctuation">;</span>
    w = u1 * u1 + u2 * u2<span class="punctuation">;</span>
  <span class="punctuation">}</span> <span class="keyword">while</span> <span class="punctuation">(</span>w &gt; <span class="number">1.0</span><span class="punctuation">);</span>
  
  w = sqrt<span class="punctuation">((</span><span class="number">-2.0</span> * log<span class="punctuation">(</span>w<span class="punctuation">))</span> / w<span class="punctuation">);</span> g2 = u1 * w<span class="punctuation">;</span> g1 = u2 * w<span class="punctuation">;</span>

  <span class="keyword">return</span> g1<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">float</span> mean = <span class="number">25.0</span>, sdev = <span class="number">2.0</span><span class="punctuation">;</span>
<span class="type">float</span> salary = gaussian_rand<span class="punctuation">()</span> * mean + sdev<span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"You have been hired at: %.2f\n"</span>, salary<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103"
>Doing Trigonometry in Degrees, not Radians</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">float</span> deg2rad<span class="punctuation">(</span><span class="type">float</span> deg<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>deg / <span class="number">180.0</span><span class="punctuation">)</span> * <span class="constant">Math</span>.pi<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">float</span> rad2deg<span class="punctuation">(</span><span class="type">float</span> rad<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>rad / <span class="constant">Math</span>.pi<span class="punctuation">)</span> * <span class="number">180.0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

write<span class="punctuation">(</span><span class="string">"%f\n"</span>, <span class="constant">Math</span>.convert_angle<span class="punctuation">(</span><span class="number">180</span>, <span class="string">"deg"</span>, <span class="string">"rad"</span><span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%f\n"</span>, deg2rad<span class="punctuation">(</span><span class="number">180.0</span><span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">float</span> degree_sin<span class="punctuation">(</span><span class="type">float</span> deg<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> sin<span class="punctuation">(</span>deg2rad<span class="punctuation">(</span>deg<span class="punctuation">));</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">float</span> rad = deg2rad<span class="punctuation">(</span><span class="number">380.0</span><span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%f\n"</span>, sin<span class="punctuation">(</span>rad<span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%f\n"</span>, degree_sin<span class="punctuation">(</span><span class="number">380.0</span><span class="punctuation">));</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN106"
>Calculating More Trigonometric Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">float</span> my_tan<span class="punctuation">(</span><span class="type">float</span> theta<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> sin<span class="punctuation">(</span>theta<span class="punctuation">)</span> / cos<span class="punctuation">(</span>theta<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">float</span> theta = <span class="number">3.7</span><span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"%f\n"</span>, my_tan<span class="punctuation">(</span>theta<span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%f\n"</span>, tan<span class="punctuation">(</span>theta<span class="punctuation">));</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN109"
>Taking Logarithms</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">float</span> value = <span class="number">100.0</span><span class="punctuation">;</span>

<span class="type">float</span> log_e = log<span class="punctuation">(</span>value<span class="punctuation">);</span>
<span class="type">float</span> log_10 = <span class="constant">Math</span>.log10<span class="punctuation">(</span>value<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">float</span> log_base<span class="punctuation">(</span><span class="type">float</span> base, <span class="type">float</span> value<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> log<span class="punctuation">(</span>value<span class="punctuation">)</span> / log<span class="punctuation">(</span>base<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">float</span> answer = log_base<span class="punctuation">(</span><span class="number">10.0</span>, <span class="number">10000.0</span><span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"log(10, 10,000) = %f\n"</span>, answer<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN112"
>Multiplying Matrices</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike offers a solid matrix implementation; highlights:</span>
<span class="comment-delimiter">// </span><span class="comment">* Operator overloading makes matrix operations succinct</span>
<span class="comment-delimiter">// </span><span class="comment">* Matrices may be of various types, thus allowing user to</span>
<span class="comment-delimiter">//   </span><span class="comment">choose between range representation and speed</span>
<span class="comment-delimiter">// </span><span class="comment">* Wide variety of operations available</span>

<span class="constant">Math</span>.Matrix a = <span class="constant">Math</span>.Matrix<span class="punctuation">(</span> <span class="punctuation">({</span> <span class="punctuation">({</span><span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span><span class="punctuation">})</span>, <span class="punctuation">({</span><span class="number">5</span>, <span class="number">9</span>, <span class="number">8</span><span class="punctuation">})</span>  <span class="punctuation">})</span> <span class="punctuation">)</span>,
            b = <span class="constant">Math</span>.Matrix<span class="punctuation">(</span> <span class="punctuation">({</span> <span class="punctuation">({</span><span class="number">4</span>, <span class="number">7</span><span class="punctuation">})</span>, <span class="punctuation">({</span><span class="number">9</span>, <span class="number">3</span><span class="punctuation">})</span>, <span class="punctuation">({</span><span class="number">8</span>, <span class="number">1</span><span class="punctuation">})</span> <span class="punctuation">})</span> <span class="punctuation">);</span>

<span class="constant">Math</span>.Matrix c = a * b<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="constant">Math</span>.Matrix t = c-&gt;transpose<span class="punctuation">();</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN115"
>Using Complex Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">@@INCOMPLETE@@</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN118"
>Converting Between Octal and Hexadecimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Like C, Pike supports decimal-alternate notations. Thus, for example,</span>
<span class="comment-delimiter">// </span><span class="comment">the integer value, 867, is expressable in literal form as:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//   </span><span class="comment">Hexadecimal -&gt; 0x363</span>
<span class="comment-delimiter">//   </span><span class="comment">Octal       -&gt; 01543</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">For effecting such conversions using strings there is 'sprintf' and</span>
<span class="comment-delimiter">// </span><span class="comment">'sscanf'.</span>

<span class="type">int</span> dec = <span class="number">867</span><span class="punctuation">;</span>
<span class="type">string</span> hex = sprintf<span class="punctuation">(</span><span class="string">"%x"</span>, dec<span class="punctuation">);</span>
<span class="type">string</span> oct = sprintf<span class="punctuation">(</span><span class="string">"%o"</span>, dec<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> dec<span class="punctuation">;</span>
<span class="type">string</span> hex = <span class="string">"363"</span><span class="punctuation">;</span> sscanf<span class="punctuation">(</span>hex, <span class="string">"%x"</span>, dec<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> dec<span class="punctuation">;</span>
<span class="type">string</span> oct = <span class="string">"1543"</span><span class="punctuation">;</span> sscanf<span class="punctuation">(</span>oct, <span class="string">"%o"</span>, dec<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">int</span> number<span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"Gimme a number in decimal, octal, or hex: "</span><span class="punctuation">);</span>
sscanf<span class="punctuation">(</span><span class="constant">Stdio</span>.stdin-&gt;gets<span class="punctuation">()</span>, <span class="string">"%D"</span>, number<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"%d %x %o\n"</span>, number, number, number<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN121"
>Putting Commas in Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> commify_series<span class="punctuation">(</span><span class="type">int</span> series<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> reverse<span class="punctuation">((</span>reverse<span class="punctuation">((</span><span class="type">string</span><span class="punctuation">)</span>series<span class="punctuation">)</span> / <span class="number">3.0</span><span class="punctuation">)</span> * <span class="string">","</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> hits = <span class="number">3452347</span><span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"Your website received %s accesses last month.\n"</span>, commify_series<span class="punctuation">(</span>hits<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> commify<span class="punctuation">(</span><span class="type">string</span> s<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">function</span> t = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> m<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> reverse<span class="punctuation">((</span>reverse<span class="punctuation">(</span>m<span class="punctuation">)</span> / <span class="number">3.0</span><span class="punctuation">)</span> * <span class="string">","</span><span class="punctuation">);</span> <span class="punctuation">};</span>
  <span class="keyword">return</span> <span class="constant">Regexp</span>.PCRE<span class="punctuation">(</span><span class="string">"([0-9]+)"</span><span class="punctuation">)</span>-&gt;replace<span class="punctuation">(</span>s, t<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> hits = <span class="number">3452347</span><span class="punctuation">;</span>
<span class="type">string</span> output = sprintf<span class="punctuation">(</span><span class="string">"Your website received %d accesses last month."</span>, hits<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"%s\n"</span>, commify<span class="punctuation">(</span>output<span class="punctuation">));</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN124"
>Printing Correct Plurals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> pluralise<span class="punctuation">(</span><span class="type">int</span> value, <span class="type">string</span> root, <span class="type">void</span>|<span class="type">string</span> singular_, <span class="type">void</span>|<span class="type">string</span> plural_<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> singular = singular_ ? singular_ : <span class="string">""</span><span class="punctuation">;</span>
  <span class="type">string</span> plural = plural_ ? plural_ : <span class="string">"s"</span><span class="punctuation">;</span>

  <span class="keyword">return</span> root + <span class="punctuation">(</span> <span class="punctuation">(</span>value &gt; <span class="number">1</span><span class="punctuation">)</span> ? plural : singular <span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> duration = <span class="number">1</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"It took %d %s\n"</span>, duration, pluralise<span class="punctuation">(</span>duration, <span class="string">"hour"</span><span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%d %s %s enough.\n"</span>, duration, pluralise<span class="punctuation">(</span>duration, <span class="string">"hour"</span><span class="punctuation">)</span>,
      pluralise<span class="punctuation">(</span>duration, <span class="string">""</span>, <span class="string">"is"</span>, <span class="string">"are"</span><span class="punctuation">));</span>

duration = <span class="number">5</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"It took %d %s\n"</span>, duration, pluralise<span class="punctuation">(</span>duration, <span class="string">"hour"</span><span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%d %s %s enough.\n"</span>, duration, pluralise<span class="punctuation">(</span>duration, <span class="string">"hour"</span><span class="punctuation">)</span>,
      pluralise<span class="punctuation">(</span>duration, <span class="string">""</span>, <span class="string">"is"</span>, <span class="string">"are"</span><span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Non-regexp implementation, uses the string-based, 'has_prefix'</span>
<span class="comment-delimiter">// </span><span class="comment">and 'replace' library functions</span>
<span class="type">string</span> plural<span class="punctuation">(</span><span class="type">string</span> singular<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">string</span><span class="punctuation">)</span> e2 =
    <span class="punctuation">([</span><span class="string">"ss"</span>:<span class="string">"sses"</span>, <span class="string">"ph"</span>:<span class="string">"phes"</span>, <span class="string">"sh"</span>:<span class="string">"shes"</span>, <span class="string">"ch"</span>:<span class="string">"ches"</span>,
      <span class="string">"ey"</span>:<span class="string">"eys"</span>, <span class="string">"ix"</span>:<span class="string">"ices"</span>, <span class="string">"ff"</span>:<span class="string">"ffs"</span><span class="punctuation">]);</span>

  <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">string</span><span class="punctuation">)</span> e1 =
    <span class="punctuation">([</span><span class="string">"z"</span>:<span class="string">"zes"</span>, <span class="string">"f"</span>:<span class="string">"ves"</span>, <span class="string">"y"</span>:<span class="string">"ies"</span>, <span class="string">"s"</span>:<span class="string">"ses"</span>, <span class="string">"x"</span>:<span class="string">"xes"</span><span class="punctuation">]);</span>

  <span class="keyword">foreach</span><span class="punctuation">(({</span>e2, e1<span class="punctuation">})</span>, <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">string</span><span class="punctuation">)</span> endings<span class="punctuation">)</span> 
  <span class="punctuation">{</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>indices<span class="punctuation">(</span>endings<span class="punctuation">)</span>, <span class="type">string</span> ending<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>has_suffix<span class="punctuation">(</span>singular, ending<span class="punctuation">))</span>
      <span class="punctuation">{</span>
        <span class="keyword">return</span> replace<span class="punctuation">(</span>singular, ending, endings<span class="punctuation">[</span>ending<span class="punctuation">]);</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>

  <span class="keyword">return</span> singular<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>aggregate<span class="punctuation">(</span><span class="string">"mess"</span>, <span class="string">"index"</span>, <span class="string">"leaf"</span>, <span class="string">"puppy"</span><span class="punctuation">)</span>, <span class="type">string</span> word<span class="punctuation">)</span>
    write<span class="punctuation">(</span><span class="string">"%6s -&gt; %s\n"</span>, word, plural<span class="punctuation">(</span>word<span class="punctuation">));</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN127"
>Program: Calculating Prime Factors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch02/bigfact.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">contributed by martin nilsson
</span>
<span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> n, <span class="type">array</span> args<span class="punctuation">)</span> 
<span class="punctuation">{</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>args<span class="punctuation">[</span><span class="number">1</span>..<span class="punctuation">]</span>, <span class="type">string</span> arg<span class="punctuation">)</span> 
  <span class="punctuation">{</span>
    <span class="type">mapping</span> r = <span class="punctuation">([]);</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Math</span>.factor<span class="punctuation">((</span><span class="type">int</span><span class="punctuation">)</span>arg<span class="punctuation">)</span>, <span class="type">int</span> f<span class="punctuation">)</span>
      r<span class="punctuation">[</span>f<span class="punctuation">]</span>++<span class="punctuation">;</span>
    write<span class="punctuation">(</span><span class="string">"%-10s"</span>, arg<span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>r<span class="punctuation">)</span>==<span class="number">1</span><span class="punctuation">)</span>
      write<span class="punctuation">(</span><span class="string">" PRIME"</span><span class="punctuation">);</span>
    <span class="keyword">else</span> 
    <span class="punctuation">{</span>
      <span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>r<span class="punctuation">))</span>, <span class="type">int</span> f<span class="punctuation">)</span> 
      <span class="punctuation">{</span>
        write<span class="punctuation">(</span><span class="string">" %d"</span>, f<span class="punctuation">);</span>
        <span class="keyword">if</span><span class="punctuation">(</span>r<span class="punctuation">[</span>f<span class="punctuation">]</span>&gt;<span class="number">1</span><span class="punctuation">)</span> write<span class="punctuation">(</span><span class="string">"**%d"</span>, r<span class="punctuation">[</span>f<span class="punctuation">]);</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>


</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Strings</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dates and Times</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>datesandtimes.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Dates and Times</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Numbers"
HREF="numbers.html"><LINK
REL="NEXT"
TITLE="Arrays"
HREF="arrays.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATESANDTIMES"
>3. Dates and Times</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN132"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike has an extensive Calendar module that provides all manners of</span>
<span class="comment-delimiter">// </span><span class="comment">manipulating dates and times.</span>
write<span class="punctuation">(</span><span class="string">"Today is day %d of the current year.\n"</span>, localtime<span class="punctuation">(</span>time<span class="punctuation">())</span>-&gt;yday+<span class="number">1</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Today is day 325 of the current year.</span>

write<span class="punctuation">(</span><span class="string">"Today is day %d of the current year.\n"</span>, <span class="constant">Calendar</span>.now<span class="punctuation">()</span>-&gt;year_day<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">Today is day 325 of the current year.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN135"
>Finding Today's Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> day, month, year<span class="punctuation">;</span>
<span class="type">mapping</span> now=localtime<span class="punctuation">(</span>time<span class="punctuation">());</span>
year  = now-&gt;year+<span class="number">1900</span><span class="punctuation">;</span>
month = now-&gt;mon+<span class="number">1</span><span class="punctuation">;</span>
day   = now-&gt;mday<span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"The current date is %04d %02d %02d\n"</span>, year, month, day<span class="punctuation">);</span>

<span class="type">object</span> now=<span class="constant">Calendar</span>.now<span class="punctuation">();</span>
year  = now-&gt;year_no<span class="punctuation">();</span>
month = now-&gt;month_no<span class="punctuation">();</span>
day   = now-&gt;month_day<span class="punctuation">();</span>

write<span class="punctuation">(</span><span class="string">"The current date is %04d %02d %02d\n"</span>, year, month, day<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"The current date is %04d %02d %02d\n"</span>, @<span class="keyword">lambda</span><span class="punctuation">(){</span> <span class="keyword">return</span> <span class="punctuation">({</span> now-&gt;year_no<span class="punctuation">()</span>, now-&gt;month_no<span class="punctuation">()</span>, now-&gt;month_day<span class="punctuation">()</span> <span class="punctuation">});</span> <span class="punctuation">}(</span><span class="constant">Calendar</span>.now<span class="punctuation">()));</span>
<span class="comment-delimiter">// </span><span class="comment">this is essentially the same as the respective perl code:</span>
<span class="comment-delimiter">// </span><span class="comment">lambda creates an anonymous function, which in this case takes one argument </span>
<span class="comment-delimiter">// </span><span class="comment">and returns an array. the array is the spliced into the arguments of write().</span>
<span class="comment-delimiter">// </span><span class="comment">if the goal is to get by without a temporary variable this is a rather</span>
<span class="comment-delimiter">// </span><span class="comment">pointless exercise, as there is still a temporary variable (in the function)</span>
<span class="comment-delimiter">// </span><span class="comment">and the temporary function on top of that. more interresting is the</span>
<span class="comment-delimiter">// </span><span class="comment">functional approach aspect.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN138"
>Converting DMYHMS to Epoch Seconds</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">dwim_time() handles most common date and time formats.</span>
<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"2:40:25 23.11.2004"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 CET)</span>
<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"2:40:25 23.11.2004"</span><span class="punctuation">)</span>-&gt;unix_time<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 1101174025</span>

<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"2:40:25 UTC 23.11.2004"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>

<span class="comment-delimiter">// </span><span class="comment">faster, because there is no need for guessing:</span>
<span class="constant">Calendar</span>.parse<span class="punctuation">(</span><span class="string">"%Y-%M-%D %h:%m:%s %z"</span>,<span class="string">"2004-11-23 2:40:25 UTC"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>

<span class="comment-delimiter">// </span><span class="comment">without parsing</span>
<span class="constant">Calendar</span>.Second<span class="punctuation">(</span><span class="number">2004</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="number">40</span>, <span class="number">25</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 CET)</span>

<span class="comment-delimiter">// </span><span class="comment">functional</span>
<span class="constant">Calendar</span>.Year<span class="punctuation">(</span><span class="number">2004</span><span class="punctuation">)</span>-&gt;month<span class="punctuation">(</span><span class="number">11</span><span class="punctuation">)</span>-&gt;day<span class="punctuation">(</span><span class="number">23</span><span class="punctuation">)</span>-&gt;hour<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span>-&gt;minute<span class="punctuation">(</span><span class="number">40</span><span class="punctuation">)</span>-&gt;second<span class="punctuation">(</span><span class="number">25</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 CET)</span>

<span class="constant">Calendar</span>.Day<span class="punctuation">(</span><span class="number">2004</span>, <span class="number">11</span>, <span class="number">23</span><span class="punctuation">)</span>-&gt;set_timezone<span class="punctuation">(</span><span class="string">"UTC"</span><span class="punctuation">)</span>-&gt;hour<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span>-&gt;minute<span class="punctuation">(</span><span class="number">40</span><span class="punctuation">)</span>-&gt;second<span class="punctuation">(</span><span class="number">25</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>

<span class="comment-delimiter">// </span><span class="comment">set a time today</span>
<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"2:40:25"</span><span class="punctuation">);</span>    
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 CET)</span>
<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"2:40:25 UTC"</span><span class="punctuation">);</span>           
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>

<span class="constant">Calendar</span>.parse<span class="punctuation">(</span><span class="string">"%h:%m:%s %z"</span>,<span class="string">"2:40:25 UTC"</span><span class="punctuation">);</span>                    
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>
<span class="constant">Calendar</span>.Day<span class="punctuation">()</span>-&gt;set_timezone<span class="punctuation">(</span><span class="string">"UTC"</span><span class="punctuation">)</span>-&gt;hour<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span>-&gt;minute<span class="punctuation">(</span><span class="number">40</span><span class="punctuation">)</span>-&gt;second<span class="punctuation">(</span><span class="number">25</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 UTC)</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN141"
>Converting Epoch Seconds to DMYHMS</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> unixtime=<span class="number">1101174025</span><span class="punctuation">;</span>
<span class="type">int</span> day, month, year<span class="punctuation">;</span>
<span class="type">mapping</span> then=localtime<span class="punctuation">(</span>unixtime<span class="punctuation">);</span>
year  = then-&gt;year+<span class="number">1900</span><span class="punctuation">;</span>
month = then-&gt;mon+<span class="number">1</span><span class="punctuation">;</span>
day   = then-&gt;mday<span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"Dateline: %02d:%02d:%02d-%04d/%02d/%02d\n"</span>, then-&gt;hour, then-&gt;min, then-&gt;sec, then-&gt;year+<span class="number">1900</span>, then-&gt;mon+<span class="number">1</span>, then-&gt;mday<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Dateline: 02:40:25-2004/11/23</span>

<span class="type">object</span> othen=<span class="constant">Calendar</span>.Second<span class="punctuation">(</span>unixtime<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 23 Nov 2004 2:40:25 CET)</span>

write<span class="punctuation">(</span><span class="string">"Dateline: %02d:%02d:%02d-%04d/%02d/%02d\n"</span>, othen-&gt;hour_no<span class="punctuation">()</span>, 
      othen-&gt;minute_no<span class="punctuation">()</span>, othen-&gt;second_no<span class="punctuation">()</span>, othen-&gt;year_no<span class="punctuation">()</span>, 
      othen-&gt;month_no<span class="punctuation">()</span>, othen-&gt;month_day<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">Dateline: 02:40:25-2004/11/23</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN144"
>Adding to or Subtracting from a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> days_offet=<span class="number">55</span><span class="punctuation">;</span>
<span class="type">int</span> hour_offset=<span class="number">2</span><span class="punctuation">;</span>
<span class="type">int</span> minute_offset=<span class="number">17</span><span class="punctuation">;</span>
<span class="type">int</span> second_offset=<span class="number">5</span><span class="punctuation">;</span>

<span class="type">object</span> then=<span class="constant">Calendar</span>.parse<span class="punctuation">(</span><span class="string">"%D/%M/%Y, %h:%m:%s %p"</span>,<span class="string">"18/Jan/1973, 3:45:50 pm"</span><span class="punctuation">)</span>
            +<span class="constant">Calendar</span>.Day<span class="punctuation">()</span>*days_offet
            +<span class="constant">Calendar</span>.Hour<span class="punctuation">()</span>*hour_offset
            +<span class="constant">Calendar</span>.Minute<span class="punctuation">()</span>*minute_offset
            +<span class="constant">Calendar</span>.Second<span class="punctuation">()</span>*second_offset<span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"Then is %s\n"</span>, then-&gt;format_ctime<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">Then is Wed Mar 14 18:02:55 1973</span>
write<span class="punctuation">(</span><span class="string">"To be precise: %d:%d:%d, %d/%d/%d\n"</span>, 
             then-&gt;hour_no<span class="punctuation">()</span>, then-&gt;minute_no<span class="punctuation">()</span>, then-&gt;second_no<span class="punctuation">()</span>,
             then-&gt;month_no<span class="punctuation">()</span>, then-&gt;month_day<span class="punctuation">()</span>, then-&gt;year_no<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">To be precise: 18:2:55, 3/14/1973</span>

<span class="type">int</span> years   = <span class="number">1973</span><span class="punctuation">;</span>
<span class="type">int</span> months  = <span class="number">1</span><span class="punctuation">;</span>
<span class="type">int</span> days    = <span class="number">18</span><span class="punctuation">;</span>
<span class="type">int</span> offset  = <span class="number">55</span><span class="punctuation">;</span>
<span class="type">object</span> then = <span class="constant">Calendar</span>.Day<span class="punctuation">(</span>years, months, days<span class="punctuation">)</span>+offset<span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"Nat was 55 days old on: %d/%d/%d\n"</span>, then-&gt;month_no<span class="punctuation">()</span>, then-&gt;month_day<span class="punctuation">()</span>,then-&gt;year_no<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">Nat was 55 days old on: 3/14/1973</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN147"
>Difference of Two Dates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> bree = <span class="number">361535725</span><span class="punctuation">;</span>         <span class="comment-delimiter">// </span><span class="comment">16 Jun 1981, 4:35:25</span>
<span class="type">int</span> nat  = <span class="number">96201950</span><span class="punctuation">;</span>          <span class="comment-delimiter">// </span><span class="comment">18 Jan 1973, 3:45:50</span>

<span class="type">int</span> difference = bree-nat<span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"There were %d seconds between Nat and Bree\n"</span>, difference<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">There were 265333775 seconds between Nat and Bree</span>

<span class="type">int</span> seconds =  difference                % <span class="number">60</span><span class="punctuation">;</span>
<span class="type">int</span> minutes = <span class="punctuation">(</span>difference / <span class="number">60</span><span class="punctuation">)</span>          % <span class="number">60</span><span class="punctuation">;</span>
<span class="type">int</span> hours   = <span class="punctuation">(</span>difference / <span class="punctuation">(</span><span class="number">60</span>*<span class="number">60</span><span class="punctuation">)</span> <span class="punctuation">)</span>    % <span class="number">24</span><span class="punctuation">;</span>
<span class="type">int</span> days    = <span class="punctuation">(</span>difference / <span class="punctuation">(</span><span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span><span class="punctuation">)</span> <span class="punctuation">)</span> % <span class="number">7</span><span class="punctuation">;</span>
<span class="type">int</span> weeks   =  difference / <span class="punctuation">(</span><span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span><span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"(%d weeks, %d days, %d:%d:%d)\n"</span>, weeks, days, hours, minutes, seconds<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">(438 weeks, 4 days, 23:49:35)</span>

<span class="type">object</span> bree = <span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"16 Jun 1981, 4:35:25"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Tue 16 Jun 1981 4:35:25 CEST)</span>
<span class="type">object</span> nat  = <span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"18 Jan 1973, 3:45:50"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Thu 18 Jan 1973 3:45:50 CET)</span>
<span class="type">object</span> difference = nat-&gt;range<span class="punctuation">(</span>bree<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Thu 18 Jan 1973 3:45:50 CET - Tue 16 Jun 1981 4:35:26 CEST)</span>

write<span class="punctuation">(</span><span class="string">"There were %d days between Nat and Bree\n"</span>, difference/<span class="constant">Calendar</span>.Day<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">There were 3071 days between Nat and Bree</span>

<span class="type">int</span> days=difference/<span class="constant">Calendar</span>.Day<span class="punctuation">();</span>
<span class="type">object</span> left=difference-&gt;add<span class="punctuation">(</span>days,<span class="constant">Calendar</span>.Day<span class="punctuation">)</span>-&gt;range<span class="punctuation">(</span>difference-&gt;end<span class="punctuation">());</span>

<span class="comment-delimiter">// </span><span class="comment">Calendar handles timezone differences, and since the range crosses from</span>
<span class="comment-delimiter">// </span><span class="comment">normal to daylight savings time, there is one day which has only 23 hours.</span>
<span class="comment-delimiter">// </span><span class="comment">by adding the number of days we effectively move the beginning of the range</span>
<span class="comment-delimiter">// </span><span class="comment">to the same day as the end, leaving us with a range that is less than a day</span>
<span class="comment-delimiter">// </span><span class="comment">long. when adding the days, the daylight savings switch will be taken into</span>
<span class="comment-delimiter">// </span><span class="comment">account.</span>

write<span class="punctuation">(</span><span class="string">"Bree came %d days, %d:%d:%d after Nat\n"</span>, 
                   days, 
                   <span class="punctuation">(</span>left/<span class="constant">Calendar</span>.Hour<span class="punctuation">())</span>%<span class="number">24</span>,
                   <span class="punctuation">(</span>left/<span class="constant">Calendar</span>.Minute<span class="punctuation">())</span>%<span class="number">60</span>,
                   <span class="punctuation">(</span>left/<span class="constant">Calendar</span>.Second<span class="punctuation">())</span>%<span class="number">60</span>,
                   <span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Bree came 3071 days, 0:49:36 after Nat</span>

<span class="comment-delimiter">// </span><span class="comment">the following is more accurate, taking into account that the days where</span>
<span class="comment-delimiter">// </span><span class="comment">daylight savings time is switched do not have 24, but 23 and 25 hours.</span>
<span class="comment-delimiter">// </span><span class="comment">thanks to mirar on the pike list for pointing this out and providing a</span>
<span class="comment-delimiter">// </span><span class="comment">correct solution.</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> breakdown_elapsed<span class="punctuation">(</span><span class="type">object</span> u, <span class="type">void</span>|<span class="type">array</span> on<span class="punctuation">)</span>
<span class="punctuation">{</span>  
  <span class="type">array</span> res=<span class="punctuation">({});</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>!on<span class="punctuation">)</span> on=<span class="punctuation">({</span>Day,Hour,Minute,Second<span class="punctuation">});</span>
  <span class="keyword">foreach</span> <span class="punctuation">(</span>on<span class="punctuation">;;</span><span class="type">program</span>|TimeRange p<span class="punctuation">)</span>
  <span class="punctuation">{</span>  
    <span class="keyword">if</span> <span class="punctuation">(</span>u==u-&gt;end<span class="punctuation">())</span> <span class="punctuation">{</span> res+=<span class="punctuation">({</span><span class="number">0</span><span class="punctuation">});</span> <span class="keyword">continue</span><span class="punctuation">;</span> <span class="punctuation">}</span>
    <span class="type">int</span> x=u/p<span class="punctuation">;</span>
    u=u-&gt;add<span class="punctuation">(</span>x,p<span class="punctuation">)</span>-&gt;range<span class="punctuation">(</span>u-&gt;end<span class="punctuation">());</span>
    res+=<span class="punctuation">({</span>x<span class="punctuation">});</span>
  <span class="punctuation">}</span>
  <span class="keyword">return</span> res<span class="punctuation">;</span>
<span class="punctuation">}</span>

write<span class="punctuation">(</span><span class="string">"Bree came %d days, %d:%d:%d after Nat\n"</span>,
      @breakdown_elapsed<span class="punctuation">(</span>difference<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">Bree came 3071 days, 0:49:36 after Nat</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN150"
>Day in a Week/Month/Year or Week Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span> day=localtime<span class="punctuation">(</span>time<span class="punctuation">());</span>
day-&gt;mday<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 2</span>
day-&gt;wday<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 4</span>
day-&gt;yday<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 336</span>

<span class="type">int</span> year=<span class="number">1981</span><span class="punctuation">;</span>
<span class="type">int</span> month=<span class="number">6</span><span class="punctuation">;</span>
<span class="type">int</span> day=<span class="number">16</span><span class="punctuation">;</span>
<span class="type">object</span> date<span class="punctuation">;</span>
date = <span class="constant">Calendar</span>.Day<span class="punctuation">(</span>year, month, day<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Day(Tue 16 Jun 1981)</span>

date-&gt;week_day<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 3</span>
date-&gt;week_no<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 24</span>
date-&gt;year_day<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 167</span>
write<span class="punctuation">(</span><span class="string">"%d/%d/%d was a %s\n"</span>, month, day, year, date-&gt;week_day_name<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">6/16/1981 was a Tuesday</span>

write<span class="punctuation">(</span><span class="string">"in the week number %d.\n"</span>, date-&gt;week_no<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">in the week number 25.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN153"
>Parsing Dates and Times from Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> date = <span class="string">"1998-06-03"</span><span class="punctuation">;</span>
<span class="type">int</span> yyyy<span class="punctuation">;</span>
<span class="type">int</span> mm<span class="punctuation">;</span>
<span class="type">int</span> dd<span class="punctuation">;</span>
<span class="punctuation">[</span>yyyy, mm, dd<span class="punctuation">]</span> = array_sscanf<span class="punctuation">(</span>date, <span class="string">"%d-%d-%d"</span><span class="punctuation">);</span>

<span class="type">object</span> day<span class="punctuation">;</span>
day=<span class="constant">Calendar</span>.dwim_day<span class="punctuation">(</span>date<span class="punctuation">);</span>
day=<span class="constant">Calendar</span>.parse<span class="punctuation">(</span><span class="string">"%Y-%M-%D"</span>, date<span class="punctuation">);</span>

day-&gt;unix_time<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 896824800</span>
day-&gt;year_no<span class="punctuation">();</span>                      
<span class="comment-delimiter">// </span><span class="comment">Result: 1998</span>
day-&gt;month_no<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 6</span>
day-&gt;month_day<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 3</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN156"
>Printing a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">object</span> now=<span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"Sun Sep 21 15:33:36 1997"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: Second(Sun 21 Sep 1997 15:33:36 CEST)</span>

now-&gt;format_ctime<span class="punctuation">();</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "Sun Sep 21 15:33:36 1997\n"</span>

<span class="comment-delimiter">// </span><span class="comment">there is no equivalent to scalar localtime</span>

now = <span class="constant">Calendar</span>.Second<span class="punctuation">(</span><span class="number">1973</span>, <span class="number">1</span>, <span class="number">18</span>, <span class="number">3</span>, <span class="number">45</span>, <span class="number">50</span><span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"strftime gives: %s %02d/%02d/%!2d\n"</span>, now-&gt;week_day_name<span class="punctuation">()</span>, 
        now-&gt;month_no<span class="punctuation">()</span>, now-&gt;month_day<span class="punctuation">()</span>, now-&gt;year_no<span class="punctuation">());</span>
<span class="comment-delimiter">// </span><span class="comment">strftime gives: Sunday 01/18/73</span>
<span class="comment-delimiter">// </span><span class="comment">pike doesn't have strftime, but hey.</span>

<span class="comment-delimiter">// </span><span class="comment">instead Calendar provides a large array of predefined formats:</span>

<span class="comment-delimiter">// </span><span class="comment">format_nice() and format_nicez() depend on the unit:</span>
now-&gt;format_nice<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"18 Jan 1973 3:45:50"</span>
now-&gt;week<span class="punctuation">()</span>-&gt;format_nice<span class="punctuation">();</span>   <span class="comment-delimiter">// </span><span class="comment">"w3 1973"</span>
now-&gt;format_nicez<span class="punctuation">();</span>          <span class="comment-delimiter">// </span><span class="comment">"18 Jan 1973 3:45:50 CET"</span>
now-&gt;hour<span class="punctuation">()</span>-&gt;format_nicez<span class="punctuation">();</span>  <span class="comment-delimiter">// </span><span class="comment">"18 Jan 1973 3:00 CET"</span>

<span class="comment-delimiter">// </span><span class="comment">others are unit independant.</span>
now-&gt;format_ext_time<span class="punctuation">();</span>       <span class="comment-delimiter">// </span><span class="comment">"Thursday, 18 January 1973 03:45:50"</span>
now-&gt;format_ext_ymd<span class="punctuation">();</span>        <span class="comment-delimiter">// </span><span class="comment">"Thursday, 18 January 1973"</span>
now-&gt;format_iso_time<span class="punctuation">();</span>       <span class="comment-delimiter">// </span><span class="comment">"1973-01-18 (Jan) -W03-4 (Thu) 03:45:50 UTC+1"</span>
now-&gt;format_iso_ymd<span class="punctuation">();</span>        <span class="comment-delimiter">// </span><span class="comment">"1973-01-18 (Jan) -W03-4 (Thu)"</span>
now-&gt;format_mod<span class="punctuation">();</span>            <span class="comment-delimiter">// </span><span class="comment">"03:45"</span>
now-&gt;format_month<span class="punctuation">();</span>          <span class="comment-delimiter">// </span><span class="comment">"1973-01"</span>
now-&gt;format_month_short<span class="punctuation">();</span>    <span class="comment-delimiter">// </span><span class="comment">"197301"</span>
now-&gt;format_mtime<span class="punctuation">();</span>          <span class="comment-delimiter">// </span><span class="comment">"1973-01-18 03:45"</span>
now-&gt;format_time<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"1973-01-18 03:45:50"</span>
now-&gt;format_time_short<span class="punctuation">();</span>     <span class="comment-delimiter">// </span><span class="comment">"19730118 03:45:50"</span>
now-&gt;format_time_xshort<span class="punctuation">();</span>    <span class="comment-delimiter">// </span><span class="comment">"730118 03:45:50"</span>
now-&gt;format_tod<span class="punctuation">();</span>            <span class="comment-delimiter">// </span><span class="comment">"03:45:50"</span>
now-&gt;format_tod_short<span class="punctuation">();</span>      <span class="comment-delimiter">// </span><span class="comment">"034550"</span>
now-&gt;format_todz<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"03:45:50 CET"</span>
now-&gt;format_todz_iso<span class="punctuation">();</span>       <span class="comment-delimiter">// </span><span class="comment">"03:45:50 UTC+1"</span>
now-&gt;format_week<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"1973-w3"</span>
now-&gt;format_week_short<span class="punctuation">();</span>     <span class="comment-delimiter">// </span><span class="comment">"1973w3"</span>
now-&gt;format_iso_week<span class="punctuation">();</span>       <span class="comment-delimiter">// </span><span class="comment">"1973-W03"</span>
now-&gt;format_iso_week_short<span class="punctuation">();</span> <span class="comment-delimiter">// </span><span class="comment">"197303"</span>
now-&gt;format_xtime<span class="punctuation">();</span>          <span class="comment-delimiter">// </span><span class="comment">"1973-01-18 03:45:50.000000"</span>
now-&gt;format_xtod<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"03:45:50.000000"</span>
now-&gt;format_ymd<span class="punctuation">();</span>            <span class="comment-delimiter">// </span><span class="comment">"1973-01-18"</span>
now-&gt;format_ymd_short<span class="punctuation">();</span>      <span class="comment-delimiter">// </span><span class="comment">"19730118"</span>
now-&gt;format_ymd_xshort<span class="punctuation">();</span>     <span class="comment-delimiter">// </span><span class="comment">"730118"</span>

now-&gt;format_ctime<span class="punctuation">();</span>          <span class="comment-delimiter">// </span><span class="comment">"Thu Jan 18 03:45:50 1973\n"</span>
now-&gt;format_smtp<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"Thu, 18 Jan 1973 3:45:50 +0100"</span>
now-&gt;format_http<span class="punctuation">();</span>           <span class="comment-delimiter">// </span><span class="comment">"Thu, 18 Jan 1973 02:45:50 GMT"</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN159"
>High-Resolution Timers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> t=time<span class="punctuation">();</span>                 <span class="comment-delimiter">// </span><span class="comment">current time in unixtime seconds</span>
<span class="type">float</span> t0=time<span class="punctuation">(</span>t<span class="punctuation">);</span>             <span class="comment-delimiter">// </span><span class="comment">higher precision time passed since t</span>
<span class="type">float</span> t1=time<span class="punctuation">(</span>t<span class="punctuation">);</span>
<span class="type">float</span> elapsed=t1-t0<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 0.009453</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------</span>
write<span class="punctuation">(</span><span class="string">"Press return when ready: "</span><span class="punctuation">);</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> before=<span class="constant">System</span>.gettimeofday<span class="punctuation">();</span>
<span class="constant">Stdio</span>.stdin-&gt;gets<span class="punctuation">();</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> after=<span class="constant">System</span>.gettimeofday<span class="punctuation">();</span>
<span class="type">int</span> elapsed_sec=after<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>-before<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>
<span class="type">int</span> elapsed_usec=after<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>-before<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="keyword">if</span><span class="punctuation">(</span>elapsed_usec&lt;<span class="number">0</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
  elapsed_sec--<span class="punctuation">;</span>
  elapsed_usec+=<span class="number">1000000</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

write<span class="punctuation">(</span><span class="string">"You took %d.%d seconds.\n"</span>, elapsed_sec, elapsed_usec<span class="punctuation">);</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------</span>
<span class="comment-delimiter">// </span><span class="comment">this is an expanded example compared to the one given for perl</span>
<span class="comment-delimiter">// </span><span class="comment">to allow comparison of different types.</span>
<span class="comment-delimiter">// </span><span class="comment">bignum are objects of the gmp library, which are seamlessly integrated with</span>
<span class="comment-delimiter">// </span><span class="comment">regular integers.</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">size values are adjusted so that each run takes about the same length.</span>
  gaugethis<span class="punctuation">(</span><span class="number">5000000</span>, <span class="number">100</span>, <span class="keyword">lambda</span><span class="punctuation">(){</span> <span class="keyword">return</span> random<span class="punctuation">(</span>pow<span class="punctuation">(</span><span class="number">2</span>,<span class="number">31</span><span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">);</span> <span class="punctuation">});</span>
               <span class="comment-delimiter">// </span><span class="comment">values to fit into a signed 32bit int.</span>
  gaugethis<span class="punctuation">(</span><span class="number">50000</span>, <span class="number">100</span>, <span class="keyword">lambda</span><span class="punctuation">(){</span> <span class="keyword">return</span> pow<span class="punctuation">(</span><span class="number">2</span>,<span class="number">64</span><span class="punctuation">)</span>+random<span class="punctuation">(</span>pow<span class="punctuation">(</span><span class="number">2</span>,<span class="number">64</span><span class="punctuation">));</span> <span class="punctuation">});</span>
               <span class="comment-delimiter">// </span><span class="comment">make sure values are bignum even in case 64bit ints are used.</span>
  gaugethis<span class="punctuation">(</span><span class="number">500000</span>, <span class="number">100</span>, <span class="keyword">lambda</span><span class="punctuation">(){</span> <span class="keyword">return</span> random_string<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">);</span> <span class="punctuation">});</span>
               <span class="comment-delimiter">// </span><span class="comment">might be interresting to compare longer strings too.</span>
<span class="punctuation">}</span>

<span class="type">void</span> gaugethis<span class="punctuation">(</span><span class="type">int</span> size, <span class="type">int</span> number_of_times, <span class="type">function</span> rand<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">array</span> gauged_times = <span class="punctuation">({});</span>
  <span class="type">float</span> average<span class="punctuation">;</span>

  <span class="type">int</span> swidth=sizeof<span class="punctuation">((</span><span class="type">string</span><span class="punctuation">)</span>size<span class="punctuation">);</span>
  <span class="type">int</span> nwidth=sizeof<span class="punctuation">((</span><span class="type">string</span><span class="punctuation">)</span>number_of_times<span class="punctuation">);</span>
  <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i&lt;number_of_times<span class="punctuation">;</span> i++<span class="punctuation">)</span>
  <span class="punctuation">{</span> 
    write<span class="punctuation">(</span><span class="string">"%*d: "</span>, nwidth, i<span class="punctuation">);</span>
    <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr=<span class="punctuation">({});</span>
    write<span class="punctuation">(</span><span class="string">"creating array: "</span><span class="punctuation">);</span>
    <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> j<span class="punctuation">;</span> j&lt;size<span class="punctuation">;</span> j++<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      arr += <span class="punctuation">({</span> rand<span class="punctuation">()</span> <span class="punctuation">});</span> 
    <span class="punctuation">}</span>
    write<span class="punctuation">(</span><span class="string">" sorting: "</span><span class="punctuation">);</span>

    <span class="type">float</span> gaugetime=gauge <span class="comment-delimiter">// </span><span class="comment">gauge measures cpu time, giving better results</span>
    <span class="punctuation">{</span> 
      arr=sort<span class="punctuation">(</span>arr<span class="punctuation">);</span>
    <span class="punctuation">};</span>
    gauged_times += <span class="punctuation">({</span> gaugetime <span class="punctuation">});</span>
    write<span class="punctuation">(</span><span class="string">" %f          \r"</span>, gaugetime<span class="punctuation">);</span>
  <span class="punctuation">}</span>
  average=`+<span class="punctuation">(</span>@gauged_times<span class="punctuation">)</span>/<span class="punctuation">(</span><span class="type">float</span><span class="punctuation">)</span>number_of_times<span class="punctuation">;</span>
  gauged_times=sort<span class="punctuation">(</span>gauged_times<span class="punctuation">);</span>

  write<span class="punctuation">(</span><span class="string">"average: %O, min: %O, max: %O                           \n"</span>, 
        average, gauged_times<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, gauged_times<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN162"
>Short Sleeps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> abort_on_signal=<span class="number">1</span><span class="punctuation">;</span>         <span class="comment-delimiter">// </span><span class="comment">if true, aport on signal</span>
sleep<span class="punctuation">(</span><span class="number">0.25</span>, abort_on_signal<span class="punctuation">);</span>

delay<span class="punctuation">(</span><span class="number">0.25</span><span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">uses busy-wait for accuracy,</span>
             <span class="comment-delimiter">// </span><span class="comment">may be interrupted by signal handlers</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN165"
>Program: hopdelta</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"Tue, 26 May 1998 23:57:38 -0400"</span><span class="punctuation">)</span>-&gt;distance<span class="punctuation">(</span>
    <span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span><span class="string">"Wed, 27 May 1998 05:04:03 +0100"</span><span class="punctuation">))</span>-&gt;format_elapsed<span class="punctuation">();</span>   
<span class="comment-delimiter">// </span><span class="comment">Result: "0:06:25"</span>

<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch03/hopdelta.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 3.11
</span><span class="comment-delimiter">// </span><span class="comment">hopdelta - feed mail header, produce lines
</span><span class="comment-delimiter">//            </span><span class="comment">showing delay at each hop.
</span><span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="constant">MIME</span>.Message        mail = <span class="constant">MIME</span>.Message<span class="punctuation">(</span><span class="constant">Stdio</span>.<span class="constant">stdin</span>.read<span class="punctuation">());</span>
  
  <span class="type">array</span>           received = reverse<span class="punctuation">(</span>mail-&gt;headers-&gt;received/<span class="string">"\0"</span><span class="punctuation">);</span>
  <span class="constant">Calendar</span>.Second lasttime = <span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span>mail-&gt;headers-&gt;date<span class="punctuation">);</span>

  <span class="type">array</span> delays=<span class="punctuation">({</span> <span class="punctuation">({</span> <span class="string">"Sender"</span>, <span class="string">"Recipient"</span>, <span class="string">"Time"</span>, <span class="string">"Delta"</span> <span class="punctuation">})</span> <span class="punctuation">});</span>
  delays+=<span class="punctuation">({</span> <span class="punctuation">({</span> mail-&gt;headers-&gt;from, 
                array_sscanf<span class="punctuation">(</span>received<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, <span class="string">"from %[^ ]"</span><span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">]</span>, 
                mail-&gt;headers-&gt;date, 
                <span class="string">""</span> 
          <span class="punctuation">})</span> <span class="punctuation">});</span>
          

  <span class="keyword">foreach</span><span class="punctuation">(</span>received<span class="punctuation">;;</span> <span class="type">string</span> hop<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">string</span> fromby, date<span class="punctuation">;</span>
    <span class="punctuation">[</span>fromby, date<span class="punctuation">]</span> = hop/<span class="string">";"</span><span class="punctuation">;</span>
    <span class="constant">Calendar</span>.Second thistime = <span class="constant">Calendar</span>.dwim_time<span class="punctuation">(</span>date<span class="punctuation">);</span>

    delays+= <span class="punctuation">({</span> array_sscanf<span class="punctuation">(</span>fromby, <span class="string">"from %[^ ]%*sby %[^ ]%*s"</span><span class="punctuation">)</span> + 
                <span class="punctuation">({</span> date, lasttime-&gt;distance<span class="punctuation">(</span>thistime<span class="punctuation">)</span>-&gt;format_elapsed<span class="punctuation">()</span> <span class="punctuation">})</span> 
             <span class="punctuation">});</span>

    lasttime=thistime<span class="punctuation">;</span>
  <span class="punctuation">}</span>

  write<span class="punctuation">(</span><span class="string">"%{%-=22s %-=22s %-=20s %=10s\n%}\n"</span>, delays<span class="punctuation">);</span>
  <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Numbers</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Arrays</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>arrays.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Arrays</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Dates and Times"
HREF="datesandtimes.html"><LINK
REL="NEXT"
TITLE="Hashes"
HREF="hashes.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="hashes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="ARRAYS"
>4. Arrays</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN170"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">nested arrays are supported</span>
<span class="type">array</span> flat = <span class="punctuation">({</span> <span class="string">"this"</span>, <span class="string">"that"</span>, <span class="string">"the"</span>, <span class="string">"other"</span> <span class="punctuation">});</span>
<span class="type">array</span> nested = <span class="punctuation">({</span> <span class="string">"this"</span>, <span class="string">"that"</span>, <span class="punctuation">({</span> <span class="string">"the"</span>, <span class="string">"other"</span> <span class="punctuation">})</span> <span class="punctuation">});</span>


<span class="type">array</span> tune = <span class="punctuation">({</span> <span class="string">"The"</span>, <span class="string">"Star-Spangled"</span>, <span class="string">"Banner"</span> <span class="punctuation">});</span>
tune<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "The"</span>
tune<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="comment-delimiter">// </span><span class="comment">Result: "Star-Spangled"</span>


<span class="comment-delimiter">// </span><span class="comment">the typing may be more specific</span>
<span class="comment-delimiter">// </span><span class="comment">only strings allowed in the array (thus no nesting!)</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> flat = <span class="punctuation">({</span> <span class="string">"this"</span>, <span class="string">"that"</span>, <span class="string">"the"</span>, <span class="string">"other"</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">allow one level of nesting</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">))</span> admit1 = <span class="punctuation">({</span> <span class="string">"this"</span>, <span class="string">"that"</span>, <span class="punctuation">({</span> <span class="string">"the"</span>, <span class="string">"other"</span> <span class="punctuation">})</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">the first level may only contain arrays, other levels may contain anything</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span> require1 <span class="punctuation">({</span> <span class="punctuation">({</span> <span class="string">"this"</span>, <span class="string">"that"</span> <span class="punctuation">})</span>, <span class="punctuation">({</span> <span class="string">"the"</span>, <span class="string">"other"</span> <span class="punctuation">})</span> <span class="punctuation">});</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN173"
>Specifying a List In Your Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">list</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> a = <span class="punctuation">({</span> <span class="string">"quick"</span>, <span class="string">"brown"</span>, <span class="string">"fox"</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">words</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> a = <span class="string">"Why are you teasing me?"</span>/<span class="string">" "</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">lines</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> lines = #<span class="string">"The boy stood on the burning deck,
It was as hot as glass."</span>/<span class="string">"\n"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">file</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> bigarray = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span><span class="string">"mydatafile"</span><span class="punctuation">)</span>/<span class="string">"\n"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">the quoting issues do not apply.</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> ships = <span class="string">"Ni&#241;a Pinta Santa Mar&#237;a"</span>/<span class="string">" "</span><span class="punctuation">;</span>         <span class="comment-delimiter">// </span><span class="comment">wrong</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> ships = <span class="punctuation">({</span> <span class="string">"Ni&#241;a"</span>, <span class="string">"Pinta"</span>, <span class="string">"Santa Mar&#237;a"</span> <span class="punctuation">});</span> <span class="comment-delimiter">// </span><span class="comment">right</span>

 </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN176"
>Printing a List with Commas</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch04/commify_series.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">chapter 4.2
</span><span class="comment-delimiter">// </span><span class="comment">commify_series - show proper comma insertion in list output
</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">))</span> lists =
  <span class="punctuation">({</span>
    <span class="punctuation">({</span> <span class="string">"just one thing"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"Mutt"</span>, <span class="string">"Jeff"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"Peter"</span>, <span class="string">"Paul"</span>, <span class="string">"Mary"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"To our parents"</span>, <span class="string">"Mother Theresa"</span>, <span class="string">"God"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"pastrami"</span>, <span class="string">"ham and cheese"</span>, <span class="string">"peanut butter and jelly"</span>, <span class="string">"tuna"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"recycle tired, old phrases"</span>, <span class="string">"ponder big, happy thoughts"</span> <span class="punctuation">})</span>,
    <span class="punctuation">({</span> <span class="string">"recycle tired, old phrases"</span>,
       <span class="string">"ponder big, happy thoughts"</span>,
       <span class="string">"sleep and dream peacefully"</span> <span class="punctuation">})</span>,
  <span class="punctuation">});</span>

<span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"The list is: %s.\n"</span>, commify_list<span class="punctuation">(</span>lists<span class="punctuation">[</span>*<span class="punctuation">])[</span>*<span class="punctuation">]);</span>
<span class="punctuation">}</span>

<span class="type">string</span> commify_list<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">switch</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>list<span class="punctuation">))</span>
  <span class="punctuation">{</span>
    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> list<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>
    <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"%s and %s"</span>, @list<span class="punctuation">);</span>
    <span class="keyword">default</span>: 
      <span class="type">string</span> seperator=<span class="string">","</span><span class="punctuation">;</span>
      <span class="type">int</span> count<span class="punctuation">;</span>
      <span class="keyword">while</span><span class="punctuation">(</span>count&lt;sizeof<span class="punctuation">(</span>list<span class="punctuation">)</span> &amp;&amp; search<span class="punctuation">(</span>list<span class="punctuation">[</span>count<span class="punctuation">]</span>, seperator<span class="punctuation">)</span>==<span class="number">-1</span><span class="punctuation">)</span>
        count++<span class="punctuation">;</span>
      <span class="keyword">if</span><span class="punctuation">(</span>count&lt;sizeof<span class="punctuation">(</span>list<span class="punctuation">))</span>
        seperator=<span class="string">";"</span><span class="punctuation">;</span>
      <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"%{%s"</span>+seperator+<span class="string">" %}and %s"</span>, 
                     list<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>list<span class="punctuation">)</span><span class="number">-2</span><span class="punctuation">]</span>, list<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN179"
>Changing Array Size</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">void</span> what_about_that_array<span class="punctuation">(</span><span class="type">array</span> list<span class="punctuation">)</span>
<span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"The array now has %d elements.\n"</span>, sizeof<span class="punctuation">(</span>list<span class="punctuation">));</span>
    write<span class="punctuation">(</span><span class="string">"The index of the last element is %d.\n"</span>, sizeof<span class="punctuation">(</span>list<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">);</span>
    write<span class="punctuation">(</span><span class="string">"Element #3 is %O.\n"</span>, list<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]);</span>
<span class="punctuation">}</span>

<span class="type">array</span> people = <span class="punctuation">({</span> <span class="string">"Crosby"</span>, <span class="string">"Stills"</span>, <span class="string">"Nash"</span>, <span class="string">"Young"</span> <span class="punctuation">});</span>
what_about_that_array<span class="punctuation">(</span>people<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">The array now has 4 elements.</span>
<span class="comment-delimiter">// </span><span class="comment">The index of the last element is 3.</span>
<span class="comment-delimiter">// </span><span class="comment">Element #3 is "Young".</span>

people=people<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>people<span class="punctuation">)</span><span class="number">-2</span><span class="punctuation">];</span>
what_about_that_array<span class="punctuation">(</span>people<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">The array now has 3 elements.</span>
<span class="comment-delimiter">// </span><span class="comment">The index of the last element is 2.</span>
<span class="comment-delimiter">// </span><span class="comment">Index 3 is out of array range -3..2.</span>

people+=allocate<span class="punctuation">(</span><span class="number">10001</span>-sizeof<span class="punctuation">(</span>people<span class="punctuation">));</span>
what_about_that_array<span class="punctuation">(</span>people<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">The array now has 10001 elements.</span>
<span class="comment-delimiter">// </span><span class="comment">The index of the last element is 10000.</span>
<span class="comment-delimiter">// </span><span class="comment">Element #3 is 0.</span>

<span class="type">array</span> people = <span class="punctuation">({</span> <span class="string">"Crosby"</span>, <span class="string">"Stills"</span>, <span class="string">"Nash"</span>, <span class="string">"Young"</span> <span class="punctuation">});</span> <span class="comment-delimiter">// </span><span class="comment">resetting the array</span>
people<span class="punctuation">[</span><span class="number">10000</span><span class="punctuation">]</span>=<span class="number">0</span><span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Index 10000 is out of array range -4..3.</span>
<span class="comment-delimiter">// </span><span class="comment">accessing a nonexisting index is always an error.</span>
<span class="comment-delimiter">// </span><span class="comment">arrays can not be enlarged this way.</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN182"
>Doing Something with Every Element in a List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;</span> <span class="type">int</span> index<span class="punctuation">;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">do something with item (and possibly index)</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>bad_users<span class="punctuation">;;</span> <span class="type">object</span> user<span class="punctuation">)</span>
<span class="punctuation">{</span>
  complain<span class="punctuation">(</span>user<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">for such simple cases pike provides a convenient automap feature:</span>
complain<span class="punctuation">(</span>bad_users<span class="punctuation">[</span>*<span class="punctuation">]);</span>
<span class="comment-delimiter">// </span><span class="comment">will do the same as the foreach above.</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>getenv<span class="punctuation">()));;</span> <span class="type">string</span> var<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s=%s\n"</span>, var, getenv<span class="punctuation">(</span>var<span class="punctuation">));</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">if you don't need an assurance that the indices are sorted (they most likely</span>
<span class="comment-delimiter">// </span><span class="comment">are sorted anyways) you may use:</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>getenv<span class="punctuation">();</span> <span class="type">string</span> var<span class="punctuation">;</span> <span class="type">string</span> value<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s=%s\n"</span>, var, value<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>all_users<span class="punctuation">;;</span> <span class="type">string</span> user<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> disk_space = get_usage<span class="punctuation">(</span>user<span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>disk_space &gt; MAX_QUOTA<span class="punctuation">)</span>
    complain<span class="punctuation">(</span>user<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">continue; to jump to the next</span>
<span class="comment-delimiter">// </span><span class="comment">break; to stop the loop</span>
<span class="comment-delimiter">// </span><span class="comment">redo can be done by doing a loop with the proper checks in the block</span>

<span class="type">object</span> pipe=<span class="constant">Stdio</span>.File<span class="punctuation">();</span>
<span class="constant">Process</span>.create_process<span class="punctuation">(({</span> <span class="string">"who"</span> <span class="punctuation">})</span>, <span class="punctuation">([</span> <span class="string">"stdout"</span>:pipe-&gt;pipe<span class="punctuation">()</span> <span class="punctuation">]));</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>pipe-&gt;line_iterator<span class="punctuation">();;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>search<span class="punctuation">(</span>line, <span class="string">"tchrist"</span><span class="punctuation">)</span>&gt;<span class="number">-1</span><span class="punctuation">)</span>
    write<span class="punctuation">(</span>line+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">object</span> fh=<span class="constant">Stdio</span>.File<span class="punctuation">(</span><span class="string">"somefile"</span><span class="punctuation">);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>fh-&gt;line_iterator<span class="punctuation">();</span> <span class="type">int</span> linenr<span class="punctuation">;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Process</span>.split_quoted_string<span class="punctuation">(</span>line<span class="punctuation">);;</span> <span class="type">string</span> word<span class="punctuation">)</span><span class="comment-delimiter">//</span><span class="comment">split on whitespace</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span>reverse<span class="punctuation">(</span>word<span class="punctuation">));</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>


<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> list = <span class="punctuation">({</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="punctuation">});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">int</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  item--<span class="punctuation">;</span>
<span class="punctuation">}</span>
write<span class="punctuation">(</span><span class="string">"%{%d %}\n"</span>, list<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 1 2 3 </span>

<span class="comment-delimiter">// </span><span class="comment">we can still use foreach instead of for, </span>
<span class="comment-delimiter">// </span><span class="comment">because foreach gives us the index as well:</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;</span> <span class="type">int</span> index<span class="punctuation">;)</span>
<span class="punctuation">{</span>
  list<span class="punctuation">[</span>index<span class="punctuation">]</span>--<span class="punctuation">;</span>
<span class="punctuation">}</span>
write<span class="punctuation">(</span><span class="string">"%{%d %}\n"</span>, list<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Result: 0 1 2</span>

<span class="type">array</span> a = <span class="punctuation">({</span> <span class="number">0.5</span>, <span class="number">3</span> <span class="punctuation">});</span>
<span class="type">array</span> b = <span class="punctuation">({</span> <span class="number">0</span>, <span class="number">1</span> <span class="punctuation">});</span>
<span class="comment-delimiter">// </span><span class="comment">foreach handles only one array so there is nothing to gain here. </span>
<span class="comment-delimiter">// </span><span class="comment">better use automap:</span>
<span class="type">array</span> a_ = a<span class="punctuation">[</span>*<span class="punctuation">]</span>*<span class="number">7</span><span class="punctuation">;</span>
<span class="type">array</span> b_ = b<span class="punctuation">[</span>*<span class="punctuation">]</span>*<span class="number">7</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"%{%O %}\n"</span>, a_+b_<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">3.500000 21 0 7</span>

<span class="type">string</span> scalar = <span class="string">" abc "</span><span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> list = <span class="punctuation">({</span> <span class="string">" a "</span>, <span class="string">" b "</span> <span class="punctuation">});</span>
<span class="type">mapping</span><span class="punctuation">(</span><span class="type">mixed</span>:<span class="type">string</span><span class="punctuation">)</span> hash = <span class="punctuation">([</span> <span class="string">"a"</span>:<span class="string">" a "</span>, <span class="string">"b"</span>:<span class="string">" b "</span> <span class="punctuation">]);</span>

scalar = <span class="constant">String</span>.trim_whites<span class="punctuation">(</span>scalar<span class="punctuation">);</span>
list = <span class="constant">String</span>.trim_whites<span class="punctuation">(</span>list<span class="punctuation">[</span>*<span class="punctuation">]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>hash<span class="punctuation">;</span> <span class="type">int</span> key<span class="punctuation">;)</span>
<span class="punctuation">{</span>
  hash<span class="punctuation">[</span>key<span class="punctuation">]</span>=<span class="constant">String</span>.trim_whites<span class="punctuation">(</span>hash<span class="punctuation">[</span>key<span class="punctuation">]);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN185"
>Iterating Over an Array by Reference</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">pike does not distinguish between arrays and array references </span>
<span class="comment-delimiter">// </span><span class="comment">(they are all references anyways) so this section does not apply</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN188"
>Extracting Unique Elements from a List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span> seen = <span class="punctuation">([]);</span>
<span class="type">array</span>   uniq = <span class="punctuation">({});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!seen<span class="punctuation">[</span>item<span class="punctuation">])</span>
    seen<span class="punctuation">[</span>item<span class="punctuation">]</span> = <span class="number">1</span><span class="punctuation">;</span>
  <span class="keyword">else</span>
    uniq += <span class="punctuation">({</span> item <span class="punctuation">});</span>
<span class="punctuation">}</span>


<span class="type">mapping</span> seen = <span class="punctuation">([]);</span>
<span class="type">array</span>   uniq = <span class="punctuation">({});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!seen<span class="punctuation">[</span>item<span class="punctuation">]</span>++<span class="punctuation">)</span>
    uniq += <span class="punctuation">({</span> item <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="type">mapping</span> seen = <span class="punctuation">([]);</span>
<span class="type">array</span>   uniq = <span class="punctuation">({});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!seen<span class="punctuation">[</span>item<span class="punctuation">]</span>++<span class="punctuation">)</span>
    some_func<span class="punctuation">(</span>item<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">the following is probably the most natural for pike</span>
<span class="type">mapping</span> seen = <span class="punctuation">([]);</span>
<span class="type">array</span>   uniq = <span class="punctuation">({});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  seen<span class="punctuation">[</span>item<span class="punctuation">]</span>++<span class="punctuation">;</span>
<span class="punctuation">}</span>
uniq = indices<span class="punctuation">(</span>seen<span class="punctuation">);</span>


<span class="comment-delimiter">// </span><span class="comment">not necessarily faster but shorter:</span>
<span class="type">array</span> uniq = indices<span class="punctuation">(({</span> list<span class="punctuation">[</span>*<span class="punctuation">]</span>,<span class="number">1</span> <span class="punctuation">}));</span>

<span class="comment-delimiter">// </span><span class="comment">also short, and preserving the originaal order:</span>
<span class="type">array</span> uniq = list&amp;indices<span class="punctuation">(({</span> list<span class="punctuation">[</span>*<span class="punctuation">]</span>,<span class="number">1</span> <span class="punctuation">}));</span>


<span class="type">object</span> pipe = <span class="constant">Stdio</span>.File<span class="punctuation">();</span>
<span class="constant">Process</span>.create_process<span class="punctuation">(({</span> <span class="string">"who"</span> <span class="punctuation">})</span>, <span class="punctuation">([</span> <span class="string">"stdout"</span>:pipe-&gt;pipe<span class="punctuation">()</span> <span class="punctuation">]));</span>
<span class="type">mapping</span> ucnt = <span class="punctuation">([]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>pipe-&gt;line_iterator<span class="punctuation">();;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  ucnt<span class="punctuation">[(</span>line/<span class="string">" "</span><span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">]]</span>++<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">array</span> users = sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>ucnt<span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"users logged in: %s\n"</span>, users*<span class="string">" "</span><span class="punctuation">);</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN191"
>Finding Elements in One Array but Not Another</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">one of pikes strenghts are operators.</span>
<span class="comment-delimiter">// </span><span class="comment">the following are the only idiomatic solutions to the problem</span>

<span class="type">array</span> A = <span class="punctuation">({</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> <span class="punctuation">});</span>
<span class="type">array</span> B = <span class="punctuation">({</span> <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> <span class="punctuation">});</span>
<span class="type">array</span> aonly = A-B<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: ({ 1 });</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN194"
>Computing Union, Intersection, or Difference of Unique Lists</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">array</span> a = <span class="punctuation">({</span> <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span> <span class="punctuation">});</span>
<span class="type">array</span> b = <span class="punctuation">({</span> <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">union:</span>
<span class="type">array</span> union = a|b<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">({ 1, 3, 5, 6, 7, 8, 2, 9 })</span>

<span class="comment-delimiter">// </span><span class="comment">intersection</span>
<span class="type">array</span> intersection = a&amp;b<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">({ 3, 5, 7 })</span>

<span class="comment-delimiter">// </span><span class="comment">difference</span>
<span class="type">array</span> difference = a-b<span class="punctuation">;</span> 
<span class="comment-delimiter">// </span><span class="comment">({ 1, 6, 8 })</span>

<span class="comment-delimiter">// </span><span class="comment">symetric difference</span>
<span class="type">array</span> symdiff= a^b<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">({ 1, 6, 8, 2, 9 })</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN197"
>Appending One Array to Another</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">join arrays</span>

<span class="comment-delimiter">// </span><span class="comment">appending to an array will always create a new array and pike is designed to</span>
<span class="comment-delimiter">// </span><span class="comment">handle this efficiently.</span>

<span class="type">array</span> members = <span class="punctuation">({</span> <span class="string">"Time"</span>, <span class="string">"Flies"</span> <span class="punctuation">});</span>
<span class="type">array</span> initiates = <span class="punctuation">({</span> <span class="string">"An"</span>, <span class="string">"Arrow"</span> <span class="punctuation">});</span>
members += initiates<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">members is now ({ "Time", "Flies", "An", "Arrow" })</span>

members = members<span class="punctuation">[</span>..<span class="number">1</span><span class="punctuation">]</span>+<span class="punctuation">({</span> <span class="string">"Like"</span> <span class="punctuation">})</span>+members<span class="punctuation">[</span><span class="number">2</span>..<span class="punctuation">];</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, members*<span class="string">" "</span><span class="punctuation">);</span>

members<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> = <span class="string">"Fruit"</span><span class="punctuation">;</span>
members = members<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>members<span class="punctuation">)</span><span class="number">-3</span><span class="punctuation">]</span>+<span class="punctuation">({</span> <span class="string">"A"</span>, <span class="string">"Banana"</span> <span class="punctuation">});</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, members*<span class="string">" "</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Time Flies Like An Arrow</span>
<span class="comment-delimiter">// </span><span class="comment">Fruit Flies Like A Banana</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN200"
>Reversing an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">almost any operation you do on the elements will add more overhead than</span>
<span class="comment-delimiter">// </span><span class="comment">reversing the array, if there is any possible optimization, pike will do it</span>
<span class="comment-delimiter">// </span><span class="comment">for you.</span>

<span class="type">array</span> reversed = reverse<span class="punctuation">(</span>arr<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">unless you were going to use for anyways then foreach(reverse( ...)) is</span>
<span class="comment-delimiter">// </span><span class="comment">preferable.</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>reverse<span class="punctuation">(</span>arr<span class="punctuation">);;</span> <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">do something with item</span>
<span class="punctuation">}</span>

<span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i=sizeof<span class="punctuation">(</span>arr<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">;</span> i&lt;=<span class="number">0</span><span class="punctuation">;</span> i--<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">so something with arr[i]</span>
<span class="punctuation">}</span>

<span class="type">array</span> ascending = sort<span class="punctuation">(</span>users<span class="punctuation">);</span>
<span class="type">array</span> descending = reverse<span class="punctuation">(</span>sort<span class="punctuation">(</span>users<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">reverse(sort()) is faster by a magnitude</span>
<span class="type">array</span> descending = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>users, <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
                                           <span class="punctuation">{</span> 
                                             <span class="keyword">return</span> a&lt;b<span class="punctuation">;</span> 
                                           <span class="punctuation">}</span>
                                   <span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN203"
>Processing Multiple Elements of an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">array</span> arr = <span class="punctuation">({</span> <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span> <span class="punctuation">});</span>
<span class="type">int</span> n=<span class="number">3</span><span class="punctuation">;</span>
<span class="type">array</span> front = arr<span class="punctuation">[</span>..n<span class="number">-1</span><span class="punctuation">];</span>
arr = arr<span class="punctuation">[</span>n..<span class="punctuation">];</span>

<span class="type">array</span> back = arr<span class="punctuation">[</span>sizeof<span class="punctuation">(</span>arr<span class="punctuation">)</span>-n..<span class="punctuation">];</span>
arr = arr<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>arr<span class="punctuation">)</span>-<span class="punctuation">(</span>n+<span class="number">1</span><span class="punctuation">)];</span>

<span class="comment-delimiter">// </span><span class="comment">since new arrays are created if elements are added or removed</span>
<span class="comment-delimiter">// </span><span class="comment">shift and pop are not usefull here.</span>

<span class="comment-delimiter">// </span><span class="comment">if you need shift and pop capabilities use the ADT classes:</span>

<span class="type">array</span> shift2<span class="punctuation">(</span><span class="constant">ADT</span>.Queue queue<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="punctuation">({</span> queue-&gt;read<span class="punctuation">()</span>, queue-&gt;read<span class="punctuation">()</span> <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="constant">ADT</span>.Queue friends = <span class="constant">ADT</span>.Queue<span class="punctuation">(</span><span class="string">"Peter"</span>, <span class="string">"Paul"</span>, <span class="string">"Mary"</span>, <span class="string">"Jim"</span>, <span class="string">"Tim"</span><span class="punctuation">);</span>
<span class="type">string</span> <span class="keyword">this</span>, that<span class="punctuation">;</span>
<span class="punctuation">[</span><span class="keyword">this</span>, that<span class="punctuation">]</span> = shift2<span class="punctuation">(</span>friends<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">this contains Peter, that has Paul, and</span>
<span class="comment-delimiter">// </span><span class="comment">friends has Mary, Jim, and Tim</span>

<span class="constant">ADT</span>.Stack beverages = <span class="constant">ADT</span>.Stack<span class="punctuation">();</span>
beverages-&gt;set_stack<span class="punctuation">(({</span> <span class="string">"Dew"</span>, <span class="string">"Jolt"</span>, <span class="string">"Cola"</span>, <span class="string">"Sprite"</span>, <span class="string">"Fresca"</span> <span class="punctuation">}));</span>
<span class="type">array</span> pair = beverages-&gt;pop<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">implementing pop2 would gain nothing here</span>
<span class="comment-delimiter">// </span><span class="comment">pair[0] contains Sprite, pair[1] has Fresca,</span>
<span class="comment-delimiter">// </span><span class="comment">and beverages has (Dew, Jolt, Cola)</span>


<span class="comment-delimiter">// </span><span class="comment">to be able to shift and pop on the same list use the following:</span>

<span class="type">array</span> shift2<span class="punctuation">(</span><span class="constant">ADT</span>.CircularList list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="punctuation">({</span> list-&gt;pop_front<span class="punctuation">()</span>, list-&gt;pop_front<span class="punctuation">()</span> <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="type">array</span> pop2<span class="punctuation">(</span><span class="constant">ADT</span>.CircularList list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> reverse<span class="punctuation">(</span> <span class="punctuation">({</span> list-&gt;pop_back<span class="punctuation">()</span>, list-&gt;pop_back<span class="punctuation">()</span> <span class="punctuation">})</span> <span class="punctuation">);</span>
<span class="punctuation">}</span>
  
<span class="constant">ADT</span>.CircularList friends = <span class="constant">ADT</span>.CircularList<span class="punctuation">(</span> <span class="punctuation">({</span><span class="string">"Peter"</span>, <span class="string">"Paul"</span>, <span class="string">"Mary"</span>, <span class="string">"Jim"</span>, <span class="string">"Tim"</span><span class="punctuation">})</span> <span class="punctuation">);</span>
<span class="type">string</span> <span class="keyword">this</span>, that<span class="punctuation">;</span>
<span class="punctuation">[</span><span class="keyword">this</span>, that<span class="punctuation">]</span> = shift2<span class="punctuation">(</span>friends<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">this contains Peter, that has Paul, and</span>
<span class="comment-delimiter">// </span><span class="comment">friends has Mary, Jim, and Tim</span>

<span class="constant">ADT</span>.CircularList beverages = <span class="constant">ADT</span>.CircularList<span class="punctuation">(</span> <span class="punctuation">({</span> <span class="string">"Dew"</span>, <span class="string">"Jolt"</span>, <span class="string">"Cola"</span>, <span class="string">"Sprite"</span>, <span class="string">"Fresca"</span> <span class="punctuation">})</span> <span class="punctuation">);</span>
<span class="type">array</span> pair = pop2<span class="punctuation">(</span>beverates<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">pair[0] contains Sprite, pair[1] has Fresca,</span>
<span class="comment-delimiter">// </span><span class="comment">and beverages has (Dew, Jolt, Cola)</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN206"
>Finding the First List Element That Passes a Test</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mixed</span> match = search<span class="punctuation">(</span>arr, element<span class="punctuation">);</span>

<span class="type">int</span> test<span class="punctuation">(</span><span class="type">mixed</span> element<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>element<span class="punctuation">)</span>==<span class="number">5</span><span class="punctuation">)</span>
    <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span>
  <span class="keyword">else</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">mixed</span> match = <span class="constant">Array</span>.search_array<span class="punctuation">(</span>arr, test<span class="punctuation">);</span>

<span class="keyword">if</span><span class="punctuation">(</span>match != <span class="number">-1</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">do something with arr[match]</span>
<span class="punctuation">}</span>
<span class="keyword">else</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">do something else</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">another convenient way if you do many tests on the same list,</span>
<span class="comment-delimiter">// </span><span class="comment">and you do not care for the position is:</span>

<span class="keyword">if</span><span class="punctuation">(</span> <span class="punctuation">(</span><span class="type">multiset</span><span class="punctuation">)</span>arr<span class="punctuation">[</span>element<span class="punctuation">]</span> <span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">found</span>
<span class="punctuation">}</span>
<span class="keyword">else</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">not found</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN209"
>Finding All Elements in an Array Matching Certain Criteria</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">array</span> matching=<span class="punctuation">({});</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>list<span class="punctuation">;;</span> <span class="type">mixed</span> element<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>test<span class="punctuation">(</span>element<span class="punctuation">))</span>
    matching+=<span class="punctuation">({</span> element <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="type">array</span> matching = map<span class="punctuation">(</span>list, test<span class="punctuation">)</span>-<span class="punctuation">({</span> <span class="number">0</span> <span class="punctuation">});</span>
<span class="type">array</span> matching = test<span class="punctuation">(</span>list<span class="punctuation">[</span>*<span class="punctuation">])</span>-<span class="punctuation">({</span> <span class="number">0</span> <span class="punctuation">});</span> 
<span class="comment-delimiter">// </span><span class="comment">apply test() on each element in list, collect the results, and remove</span>
<span class="comment-delimiter">// </span><span class="comment">results that are 0.</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN212"
>Sorting an Array Numerically</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">since pike has different types for strings and numbers, ints and floats are</span>
<span class="comment-delimiter">// </span><span class="comment">of course sorted numerically </span>
<span class="comment-delimiter">// </span><span class="comment">(sort() is destructive, the original array is changed)</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> unsorted = ...<span class="punctuation">;</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> sorted = sort<span class="punctuation">(</span>unsorted<span class="punctuation">);</span>


<span class="comment-delimiter">// </span><span class="comment">but suppose you want to sort an array of strings by their numeric value then</span>
<span class="comment-delimiter">// </span><span class="comment">things get a bit more interresting:</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> unsorted = <span class="punctuation">({</span> <span class="string">"123asdf"</span>, <span class="string">"3poiu"</span>, <span class="string">"23qwert"</span>, <span class="string">"3ayxcv"</span> <span class="punctuation">});</span>

sort<span class="punctuation">((</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">))</span>unsorted, unsorted<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">unsorted is now sorted.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN215"
>Sorting a List by Computable Field</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">array</span> unordered<span class="punctuation">;</span>
<span class="type">int</span> compare<span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">return comparison of a and b</span>
<span class="punctuation">}</span>
<span class="type">array</span> ordered = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>unordered, compare<span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">int</span> compute<span class="punctuation">(</span><span class="type">mixed</span> element<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">return computation from element</span>
<span class="punctuation">}</span>
<span class="type">array</span> precomputed = map<span class="punctuation">(</span>unordered, compute<span class="punctuation">);</span>
sort<span class="punctuation">(</span>precomputed, unordered<span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">will destructively sort unordered in the same</span>
<span class="type">array</span> ordered = unordered<span class="punctuation">;</span>    <span class="comment-delimiter">// </span><span class="comment">manner as precomputed.</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
sort<span class="punctuation">(</span>map<span class="punctuation">(</span>unordered, compute<span class="punctuation">)</span>, unordered<span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">without a temp variable</span>
sort<span class="punctuation">(</span>compute<span class="punctuation">(</span>unordered<span class="punctuation">[</span>*<span class="punctuation">])</span>, unordered<span class="punctuation">);</span>   <span class="comment-delimiter">// </span><span class="comment">using the automap operator</span>
                                          <span class="comment-delimiter">// </span><span class="comment">both get compiled to the same code</span>


<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> ordered = sort<span class="punctuation">(</span>employees, <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
                                <span class="punctuation">{</span> 
                                  <span class="keyword">return</span> a-&gt;name &gt; b-&gt;name<span class="punctuation">;</span>
                                <span class="punctuation">}</span>
                    <span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Array</span>.sort_array<span class="punctuation">(</span>employees, 
                         <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">){</span> <span class="keyword">return</span> a-&gt;name &gt; b-&gt;name<span class="punctuation">;</span> <span class="punctuation">})</span>
        <span class="punctuation">;;</span> <span class="type">mixed</span> employee<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s earns $%d\n"</span>, employee-&gt;name, employee-&gt;salary<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> ordered_employees = 
        <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>employees, 
                         <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">){</span> <span class="keyword">return</span> a-&gt;name &gt; b-&gt;name<span class="punctuation">;</span> <span class="punctuation">});</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>ordered_employees<span class="punctuation">;;</span> <span class="type">mixed</span> employee<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s earns $%d\n"</span>, employee-&gt;name, employee-&gt;salary<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">mapping</span> bonus<span class="punctuation">;</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>ordered_employees<span class="punctuation">;;</span> <span class="type">mixed</span> employee<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">you are not supposed to use the social security number as an id</span>
  <span class="keyword">if</span><span class="punctuation">(</span>bonus<span class="punctuation">[</span>employee-&gt;id<span class="punctuation">])</span>  
    write<span class="punctuation">(</span><span class="string">"%s got a bonus!\n"</span>, employee-&gt;name<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> sorted = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>employees, 
                                <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
                                <span class="punctuation">{</span>
                                  <span class="keyword">if</span><span class="punctuation">(</span>a-&gt;name!=b-&gt;name<span class="punctuation">)</span>
                                    <span class="keyword">return</span> <span class="punctuation">(</span>a-&gt;name &lt; b-&gt;name<span class="punctuation">)</span>
                                  <span class="keyword">return</span> <span class="punctuation">(</span>b-&gt;age &lt; a-&gt;age<span class="punctuation">);</span>
                                <span class="punctuation">}</span>
                               <span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span> users = <span class="constant">System</span>.get_all_users<span class="punctuation">();</span>

sort<span class="punctuation">(</span>users<span class="punctuation">);</span> 
<span class="comment-delimiter">// </span><span class="comment">System.get_all_users() returns an array of arrays, with the name as the</span>
<span class="comment-delimiter">// </span><span class="comment">first element in each inner array, sort handles multidimensional arrays, so</span>
<span class="comment-delimiter">// </span><span class="comment">we can skip creating our own sort function.</span>

<span class="comment-delimiter">// </span><span class="comment">if we wanted to sort on something else one could rearrange the array:</span>
<span class="type">array</span> user<span class="punctuation">;</span>
<span class="keyword">while</span><span class="punctuation">(</span>user=<span class="constant">System</span>.getpwent<span class="punctuation">())</span>
<span class="punctuation">{</span>
  users += <span class="punctuation">({</span> user<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span>, user <span class="punctuation">});</span>
<span class="punctuation">}</span>
<span class="constant">System</span>.endpwent<span class="punctuation">();</span>
sort<span class="punctuation">(</span>users<span class="punctuation">);</span>  <span class="comment-delimiter">// </span><span class="comment">now we are sorting by uid.</span>

<span class="comment-delimiter">// </span><span class="comment">alternative:</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span> users = <span class="constant">System</span>.get_all_users<span class="punctuation">();</span>
sort<span class="punctuation">(</span>users<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">2</span><span class="punctuation">]</span>, users<span class="punctuation">);</span>

write<span class="punctuation">(</span>users<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">0</span><span class="punctuation">]</span>*<span class="string">"\n"</span><span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> names<span class="punctuation">;</span>
<span class="type">array</span> sorted = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>names, <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
                                       <span class="punctuation">{</span>
                                         <span class="keyword">return</span> a<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> &lt; b<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
                                       <span class="punctuation">}</span>
                               <span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">faster:</span>
sort<span class="punctuation">(</span>names<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">1</span><span class="punctuation">]</span>, names<span class="punctuation">);</span>
sorted=names<span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> strings<span class="punctuation">;</span>
<span class="type">array</span> sorted = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>strings, <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
                                       <span class="punctuation">{</span>
                                         <span class="keyword">return</span> sizeof<span class="punctuation">(</span>a<span class="punctuation">)</span> &lt; sizeof<span class="punctuation">(</span>b<span class="punctuation">);</span>
                                       <span class="punctuation">}</span>
                               <span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">faster:</span>
sort<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>strings<span class="punctuation">[</span>*<span class="punctuation">])</span>, strings<span class="punctuation">);</span>
sorted=strings<span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> strings<span class="punctuation">;</span>
<span class="type">array</span> temp = map<span class="punctuation">(</span>strings, sizeof<span class="punctuation">);</span>
sort<span class="punctuation">(</span>temp, strings<span class="punctuation">);</span> 
<span class="type">array</span> sorted = strings<span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> strings<span class="punctuation">;</span>
sort<span class="punctuation">(</span>map<span class="punctuation">(</span>strings, sizeof<span class="punctuation">)</span>, strings<span class="punctuation">);</span>   <span class="comment-delimiter">// </span><span class="comment">pick one</span>
sort<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>strings<span class="punctuation">[</span>*<span class="punctuation">])</span>, strings<span class="punctuation">);</span>
sorted=strings<span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> fields<span class="punctuation">;</span>
<span class="type">array</span> temp = map<span class="punctuation">(</span>fields, array_sscanf, <span class="string">"%*s%d%*s"</span><span class="punctuation">);</span>
sort<span class="punctuation">(</span>temp, fields<span class="punctuation">);</span>
<span class="type">array</span> sorted_fields=fields<span class="punctuation">;</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
sort<span class="punctuation">(</span>array_sscanf<span class="punctuation">(</span>fields<span class="punctuation">[</span>*<span class="punctuation">]</span>, <span class="string">"%*s%d%*s"</span><span class="punctuation">)</span>, fields<span class="punctuation">);</span>
<span class="type">array</span> sorted_fields=fields<span class="punctuation">;</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">array</span> passwd_lines = <span class="punctuation">(</span><span class="constant">Stdio</span>.read_file<span class="punctuation">(</span><span class="string">"/etc/passwd"</span><span class="punctuation">)</span>/<span class="string">"\n"</span><span class="punctuation">)</span>-<span class="punctuation">({</span><span class="string">""</span><span class="punctuation">});</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">)</span> passwd = passwd_lines<span class="punctuation">[</span>*<span class="punctuation">]</span>/<span class="string">":"</span><span class="punctuation">;</span>

<span class="type">int</span> compare<span class="punctuation">(</span><span class="type">mixed</span> a, <span class="type">mixed</span> b<span class="punctuation">)</span>
<span class="punctuation">{</span> 
  <span class="keyword">if</span><span class="punctuation">(</span>a<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span>!=b<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">])</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>a<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span>&lt;<span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>b<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">];</span>
  <span class="keyword">if</span><span class="punctuation">(</span>a<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span>!=b<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">])</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>a<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span>&lt;<span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>b<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">];</span>
  <span class="keyword">return</span> a<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>&lt;b<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">];</span>
<span class="punctuation">}</span>

<span class="type">array</span> sorted_passwd = <span class="constant">Array</span>.sort_array<span class="punctuation">(</span>passwd, compare<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">alternatively the following uses the builtin sort</span>
sort<span class="punctuation">(</span> passwd<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">0</span><span class="punctuation">]</span>, passwd<span class="punctuation">);</span>
sort<span class="punctuation">(</span> <span class="punctuation">((</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">))</span>passwd<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">2</span><span class="punctuation">])</span>, passwd<span class="punctuation">);</span>
sort<span class="punctuation">(</span> <span class="punctuation">((</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">))</span>passwd<span class="punctuation">[</span>*<span class="punctuation">][</span><span class="number">3</span><span class="punctuation">])</span>, passwd<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN218"
>Implementing a Circular List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="constant">ADT</span>.CircularList circular<span class="punctuation">;</span>
circular-&gt;push_front<span class="punctuation">(</span>circular-&gt;pop_back<span class="punctuation">());</span>
circular-&gt;push_back<span class="punctuation">(</span>circular-&gt;pop_front<span class="punctuation">());</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="type">mixed</span> grab_and_rotate<span class="punctuation">(</span><span class="constant">ADT</span>.CircularList list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mixed</span> element = list-&gt;pop_front<span class="punctuation">();</span>
  list-&gt;push_back<span class="punctuation">(</span>element<span class="punctuation">);</span>
  <span class="keyword">return</span> element<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="constant">ADT</span>.CircularList processes = <span class="constant">ADT</span>.CircularList<span class="punctuation">(</span> <span class="punctuation">({</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> <span class="punctuation">})</span> <span class="punctuation">);</span>
<span class="keyword">while</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> process = grab_and_rotate<span class="punctuation">(</span>processes<span class="punctuation">);</span>
  write<span class="punctuation">(</span><span class="string">"Handling process %d\n"</span>, process<span class="punctuation">);</span>
  sleep<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN221"
>Randomizing an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">array</span> arr<span class="punctuation">;</span>
<span class="constant">Array</span>.shuffle<span class="punctuation">(</span>arr<span class="punctuation">);</span>  <span class="comment-delimiter">// </span><span class="comment">this uses the fisher-yates shuffle</span>


<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">being creative with the algorithm, this is not as memory efficient,</span>
<span class="comment-delimiter">// </span><span class="comment">but it shows the utility of multisets.</span>
<span class="type">array</span> set_shuffle<span class="punctuation">(</span><span class="type">array</span> list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">multiset</span> elements=<span class="punctuation">(</span><span class="type">multiset</span><span class="punctuation">)</span>list<span class="punctuation">;</span>
  list=<span class="punctuation">({});</span>                     <span class="comment-delimiter">// </span><span class="comment">reset the list</span>
  <span class="keyword">while</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>elements<span class="punctuation">))</span>        <span class="comment-delimiter">// </span><span class="comment">while we still have elements left</span>
  <span class="punctuation">{</span>
    <span class="type">mixed</span> pick=random<span class="punctuation">(</span>elements<span class="punctuation">);</span> <span class="comment-delimiter">// </span><span class="comment">pick a random element</span>
    list+=<span class="punctuation">({</span> pick <span class="punctuation">});</span>            <span class="comment-delimiter">// </span><span class="comment">add it to the new list</span>
    elements<span class="punctuation">[</span>pick<span class="punctuation">]</span>--<span class="punctuation">;</span>            <span class="comment-delimiter">// </span><span class="comment">remove the element we picked</span>
  <span class="punctuation">}</span>
  <span class="keyword">return</span> list<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">array</span> list<span class="punctuation">;</span>
list=set_shuffle<span class="punctuation">(</span>list<span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>

<span class="keyword">inherit</span> <span class="string">"mjd_permute"</span><span class="punctuation">;</span>
<span class="type">int</span> permutations = factorial<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>list<span class="punctuation">));</span>
<span class="type">array</span> shuffle = list<span class="punctuation">[</span>n2perm<span class="punctuation">(</span>random<span class="punctuation">(</span>permutations<span class="punctuation">)</span>+<span class="number">1</span>, sizeof<span class="punctuation">(</span>list<span class="punctuation">))[</span>*<span class="punctuation">]];</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>

<span class="type">void</span> naive_shuffle<span class="punctuation">(</span><span class="type">array</span> list<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i=<span class="number">0</span><span class="punctuation">;</span> i&lt;sizeof<span class="punctuation">(</span>list<span class="punctuation">);</span> i++<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">int</span> j=random<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>list<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">);</span>
    <span class="punctuation">[</span> list<span class="punctuation">[</span>i<span class="punctuation">]</span>, list<span class="punctuation">[</span>j<span class="punctuation">]</span> <span class="punctuation">]</span> = <span class="punctuation">({</span> list<span class="punctuation">[</span>j<span class="punctuation">]</span>, list<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="punctuation">});</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN224"
>Program: words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch04/words">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">section 4.18 example 4.2
</span><span class="comment-delimiter">// </span><span class="comment">words - gather lines, present in columns
</span>
<span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span> words=<span class="constant">Stdio</span>.<span class="constant">stdin</span>.read<span class="punctuation">()</span>/<span class="string">"\n"</span><span class="punctuation">;</span>   <span class="comment-delimiter">// </span><span class="comment">get all input
</span>  <span class="type">int</span> maxlen=sort<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>words<span class="punctuation">[</span>*<span class="punctuation">]))[</span><span class="number">-1</span><span class="punctuation">];</span> <span class="comment-delimiter">// </span><span class="comment">sort by size and pick the largest
</span>  maxlen++<span class="punctuation">;</span>                              <span class="comment-delimiter">// </span><span class="comment">add space
</span>
  <span class="comment-delimiter">// </span><span class="comment">get boundaries, this should be portable
</span>  <span class="type">int</span> cols = <span class="constant">Stdio</span>.stdout-&gt;tcgetattr<span class="punctuation">()</span>-&gt;columns/maxlen<span class="punctuation">;</span>
  <span class="type">int</span> rows = <span class="punctuation">(</span>sizeof<span class="punctuation">(</span>words<span class="punctuation">)</span>/cols<span class="punctuation">)</span> + <span class="number">1</span><span class="punctuation">;</span>

  <span class="type">string</span> mask=<span class="string">"%{%-"</span>+maxlen+<span class="string">"s%}\n"</span><span class="punctuation">;</span>     <span class="comment-delimiter">// </span><span class="comment">compute format
</span>
  words=<span class="constant">Array</span>.transpose<span class="punctuation">(</span>words/rows<span class="punctuation">);</span>     <span class="comment-delimiter">// </span><span class="comment">split into groups as large as the
</span>                                         <span class="comment-delimiter">// </span><span class="comment">number of rows and then transpose
</span>  write<span class="punctuation">(</span>mask, words<span class="punctuation">[</span>*<span class="punctuation">]);</span>                 <span class="comment-delimiter">// </span><span class="comment">apply mask to each group
</span><span class="punctuation">}</span>


</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN227"
>Program: permute</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">int</span> factorial<span class="punctuation">(</span><span class="type">int</span> n<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> s=<span class="number">1</span><span class="punctuation">;</span>
  <span class="keyword">while</span><span class="punctuation">(</span>n<span class="punctuation">)</span>
    s*=n--<span class="punctuation">;</span>
  <span class="keyword">return</span> s<span class="punctuation">;</span>
<span class="punctuation">}</span>
write<span class="punctuation">(</span><span class="string">"%d\n"</span>, factorial<span class="punctuation">(</span><span class="number">500</span><span class="punctuation">));</span>
<span class="comment-delimiter">// </span><span class="comment">TODO: provide a short example using Array.permute()</span>
<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch04/permute.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>

<span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">string</span> line<span class="punctuation">;</span>
  <span class="keyword">while</span><span class="punctuation">(</span>line=<span class="constant">Stdio</span>.stdin-&gt;gets<span class="punctuation">())</span>
  <span class="punctuation">{</span>
    permute<span class="punctuation">(</span>line/<span class="string">" "</span><span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">void</span> permute<span class="punctuation">(</span><span class="type">array</span> items, <span class="type">array</span>|<span class="type">void</span> perms<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!perms<span class="punctuation">)</span>
    perms=<span class="punctuation">({});</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!sizeof<span class="punctuation">(</span>items<span class="punctuation">))</span>
    write<span class="punctuation">((</span>perms*<span class="string">" "</span><span class="punctuation">)</span>+<span class="string">"\n"</span><span class="punctuation">);</span>
  <span class="keyword">else</span>
  <span class="punctuation">{</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>items<span class="punctuation">;</span> <span class="type">int</span> i<span class="punctuation">;)</span>
    <span class="punctuation">{</span>
      <span class="type">array</span> newitems=items<span class="punctuation">[</span>..i<span class="number">-1</span><span class="punctuation">]</span>+items<span class="punctuation">[</span>i+<span class="number">1</span>..<span class="punctuation">];</span>
      <span class="type">array</span> newperms=items<span class="punctuation">[</span>i..i<span class="punctuation">]</span>+perms<span class="punctuation">;</span>
      permute<span class="punctuation">(</span>newitems, newperms<span class="punctuation">);</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-------------------------------------------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch04/mjd_permute.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>

<span class="type">mapping</span> fact=<span class="punctuation">([</span> <span class="number">1</span>:<span class="number">1</span> <span class="punctuation">]);</span>

<span class="type">int</span> factorial<span class="punctuation">(</span><span class="type">int</span> n<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!fact<span class="punctuation">[</span>n<span class="punctuation">])</span>
    fact<span class="punctuation">[</span>n<span class="punctuation">]</span>=n*factorial<span class="punctuation">(</span>n<span class="number">-1</span><span class="punctuation">);</span>
  <span class="keyword">return</span> fact<span class="punctuation">[</span>n<span class="punctuation">];</span>
<span class="punctuation">}</span>

<span class="type">array</span> n2pat<span class="punctuation">(</span><span class="type">int</span> N, <span class="type">int</span> len<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> i=<span class="number">1</span><span class="punctuation">;</span>
  <span class="type">array</span> pat=<span class="punctuation">({});</span>

  <span class="keyword">while</span><span class="punctuation">(</span>i &lt;= len<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    pat += <span class="punctuation">({</span> N%i <span class="punctuation">});</span>
    N/=i<span class="punctuation">;</span>
    i++<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="keyword">return</span> pat<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">array</span> pat2perm<span class="punctuation">(</span><span class="type">array</span> pat<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">array</span> source=indices<span class="punctuation">(</span>pat<span class="punctuation">);</span>
  <span class="type">array</span> perm=<span class="punctuation">({});</span>
  <span class="keyword">while</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>pat<span class="punctuation">))</span>
  <span class="punctuation">{</span>
    perm += <span class="punctuation">({</span> source<span class="punctuation">[</span>pat<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]]</span> <span class="punctuation">});</span>
    source = source<span class="punctuation">[</span>..pat<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]</span><span class="number">-1</span><span class="punctuation">]</span>+source<span class="punctuation">[</span>pat<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]</span>+<span class="number">1</span>..<span class="punctuation">];</span>
    pat=pat<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>pat<span class="punctuation">)</span><span class="number">-2</span><span class="punctuation">];</span>
  <span class="punctuation">}</span>
  <span class="keyword">return</span> perm<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">array</span> n2perm<span class="punctuation">(</span><span class="type">int</span> N, <span class="type">int</span> len<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> pat2perm<span class="punctuation">(</span>n2pat<span class="punctuation">(</span>N, len<span class="punctuation">));</span>
<span class="punctuation">}</span>

<span class="type">void</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span> data<span class="punctuation">;</span>
  <span class="keyword">while</span><span class="punctuation">(</span>data=<span class="constant">Stdio</span>.stdin-&gt;gets<span class="punctuation">()</span>/<span class="string">" "</span><span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">int</span> num_permutations = factorial<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>data<span class="punctuation">));</span>
    <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i&lt;num_permutations<span class="punctuation">;</span> i++<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      <span class="type">array</span> permutation = data<span class="punctuation">[</span>n2perm<span class="punctuation">(</span>i, sizeof<span class="punctuation">(</span>data<span class="punctuation">))[</span>*<span class="punctuation">]];</span>
      write<span class="punctuation">(</span>permutation*<span class="string">" "</span>+<span class="string">"\n"</span><span class="punctuation">);</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="hashes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Dates and Times</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Hashes</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>hashes.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Hashes</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Arrays"
HREF="arrays.html"><LINK
REL="NEXT"
TITLE="Pattern Matching"
HREF="patternmatching.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="HASHES"
>5. Hashes</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN232"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">creating a mapping from arrays</span>
<span class="type">mapping</span> age = mkmapping<span class="punctuation">(</span> <span class="punctuation">({</span> <span class="string">"Nat"</span>, <span class="string">"Jules"</span>, <span class="string">"Josh"</span>, <span class="punctuation">})</span>, <span class="punctuation">({</span> <span class="number">24</span>, <span class="number">25</span>, <span class="number">17</span> <span class="punctuation">})</span> <span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">initialize one index at a time</span>
<span class="type">mapping</span> age = <span class="punctuation">([]);</span>
age<span class="punctuation">[</span><span class="string">"Nat"</span><span class="punctuation">]</span> = <span class="number">24</span><span class="punctuation">;</span>
age<span class="punctuation">[</span><span class="string">"Jules"</span><span class="punctuation">]</span> = <span class="number">25</span><span class="punctuation">;</span>
age<span class="punctuation">[</span><span class="string">"Josh"</span><span class="punctuation">]</span> = <span class="number">17</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">if your index names are valid identifiers:</span>
age-&gt;Nat = <span class="number">24</span><span class="punctuation">;</span>
age-&gt;Jules = <span class="number">25</span><span class="punctuation">;</span>
age-&gt;Josh = <span class="number">17</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">the traditional way to initialize mappings</span>
<span class="type">mapping</span> age = <span class="punctuation">([</span> <span class="string">"Nat"</span>:<span class="number">24</span>, <span class="string">"Jules"</span>:<span class="number">25</span>, <span class="string">"Josh"</span>:<span class="number">17</span> <span class="punctuation">]);</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> food_color = <span class="punctuation">([</span> 
                                      <span class="string">"Apple"</span>:<span class="string">"red"</span>,
                                      <span class="string">"Banana"</span>:<span class="string">"yellow"</span>,
                                      <span class="string">"Lemon"</span>:<span class="string">"yellow"</span>,
                                      <span class="string">"Carrot"</span>:<span class="string">"orange"</span>
                                     <span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">a index may be of any type</span>
<span class="type">mapping</span> any = <span class="punctuation">([</span> <span class="string">"1"</span>:<span class="string">"a string"</span>, <span class="number">1</span>:<span class="string">"an int"</span>, <span class="number">1.0</span>:<span class="string">"a float"</span> <span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">you may use other types too, but be aware that they are matched by</span>
<span class="comment-delimiter">// </span><span class="comment">reference, and not by value.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN235"
>Adding an Element to a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="type">mapping</span><span class="punctuation">[</span><span class="type">mixed</span><span class="punctuation">]</span> = <span class="type">mixed</span><span class="punctuation">;</span>
<span class="type">mapping</span>-&gt;<span class="type">string</span> = <span class="type">mixed</span><span class="punctuation">;</span>  <span class="comment-delimiter">//</span><span class="comment">any string that is a valid identifier</span>

<span class="comment-delimiter">// </span><span class="comment">food_color as per section 5.0</span>
food_color-&gt;Raspberry = <span class="string">"pink"</span><span class="punctuation">;</span>
write<span class="punctuation">(</span><span class="string">"Known foods:\n"</span><span class="punctuation">);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>food_color<span class="punctuation">;</span> <span class="type">string</span> food<span class="punctuation">;</span> <span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span>food+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Lemon</span>
<span class="comment-delimiter">// </span><span class="comment">Banana</span>
<span class="comment-delimiter">// </span><span class="comment">Apple</span>
<span class="comment-delimiter">// </span><span class="comment">Carrot</span>
<span class="comment-delimiter">// </span><span class="comment">Raspberry</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN238"
>Testing for the Presence of a Key in a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">an undefined value in a mapping gets turned to 0.</span>
<span class="comment-delimiter">// </span><span class="comment">assigning 0 as a value is allowed and will not remove the index.</span>
<span class="comment-delimiter">// </span><span class="comment">checking for the index will of course return 0 and be interpreted as false.</span>
<span class="comment-delimiter">// </span><span class="comment">to check if the index is really there, use zero_type()</span>

<span class="keyword">if</span><span class="punctuation">(</span>!zero_type<span class="punctuation">(</span><span class="type">mapping</span>-&gt;index<span class="punctuation">))</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">it exists</span>
<span class="punctuation">}</span>
<span class="keyword">else</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">it doesn't</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">food_color as per section 5.0</span>
<span class="keyword">foreach</span><span class="punctuation">(</span> <span class="punctuation">({</span> <span class="string">"Banana"</span>, <span class="string">"Milk"</span> <span class="punctuation">})</span> <span class="punctuation">;;</span> <span class="type">string</span> name<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!zero_type<span class="punctuation">(</span>food_color<span class="punctuation">[</span>name<span class="punctuation">]))</span>
    write<span class="punctuation">(</span><span class="string">"%s is a food.\n"</span>, name<span class="punctuation">);</span>
  <span class="keyword">else</span>
    write<span class="punctuation">(</span><span class="string">"%s is a drink.\n"</span>, name<span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Banana is a food.</span>
<span class="comment-delimiter">// </span><span class="comment">Milk is a drink.</span>

<span class="comment-delimiter">// </span><span class="comment">---------------------------------------------------------</span>
<span class="type">mapping</span> age = <span class="punctuation">([</span> <span class="string">"Toddler"</span>:<span class="number">3</span>, 
                 <span class="string">"Unborn"</span>:<span class="number">0</span>, 
                 <span class="string">"Newborn"</span>:<span class="number">0.0</span>, 
                 <span class="string">"Phantasm"</span>:UNDEFINED <span class="punctuation">]);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span> <span class="punctuation">({</span> <span class="string">"Toddler"</span>, <span class="string">"Unborn"</span>, <span class="string">"Newborn"</span>, <span class="string">"Phantasm"</span>, <span class="string">"Relic"</span> <span class="punctuation">});;</span> <span class="type">string</span> thing<span class="punctuation">)</span> 
<span class="punctuation">{</span>
    write<span class="punctuation">(</span>thing+<span class="string">":"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>!zero_type<span class="punctuation">(</span>age<span class="punctuation">[</span>thing<span class="punctuation">]))</span>
      write<span class="punctuation">(</span><span class="string">" Exists"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>age<span class="punctuation">[</span>thing<span class="punctuation">])</span>
      write<span class="punctuation">(</span><span class="string">" True"</span><span class="punctuation">);</span>
    write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Toddler: Exists True</span>
<span class="comment-delimiter">// </span><span class="comment">Unborn: Exists</span>
<span class="comment-delimiter">// </span><span class="comment">Newborn: Exists True</span>
<span class="comment-delimiter">// </span><span class="comment">Phantasm: Exists</span>
<span class="comment-delimiter">// </span><span class="comment">Relic:</span>

<span class="comment-delimiter">// </span><span class="comment">age-&gt;Toddler exists, because zero_type() is only true if the index is not in</span>
<span class="comment-delimiter">// </span><span class="comment">the mapping. it is true because the value is not 0.</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Unborn exists, but is false because 0 is false</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Newborn exists and is true, because 0.0 is not false</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Phantasm exists and is false, like Unborn</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Relic does not exist</span>

<span class="comment-delimiter">// </span><span class="comment">we can not test for defined. UNDEFINED is a special value used internally by</span>
<span class="comment-delimiter">// </span><span class="comment">the compiler. it gets converted to 0 as soon as it is assigned in a mapping</span>

<span class="comment-delimiter">// </span><span class="comment">however we can create something equivalent that can be treated like any</span>
<span class="comment-delimiter">// </span><span class="comment">other value, except that it is false:</span>

<span class="keyword">class</span> <span class="function-name">Nil</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">this is a minimal example. </span>
  <span class="comment-delimiter">// </span><span class="comment">a more complete one would also handle casting</span>

  <span class="type">int</span> `!<span class="punctuation">()</span> <span class="punctuation">{</span><span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;}</span>
  <span class="type">string</span> _sprintf<span class="punctuation">()</span> <span class="punctuation">{</span><span class="keyword">return</span> <span class="string">"Nil"</span><span class="punctuation">;}</span>

  <span class="comment-delimiter">// </span><span class="comment">we could have this function externally, but this is more convenient</span>
  <span class="type">int</span> defined<span class="punctuation">(</span><span class="type">mixed</span> var<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="keyword">return</span> !zero_type<span class="punctuation">(</span>var<span class="punctuation">)</span> &amp;&amp; var!=<span class="keyword">this</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

Nil NIL = Nil<span class="punctuation">();</span>                    <span class="comment-delimiter">// </span><span class="comment">create an instance so we can use it</span>
<span class="type">function</span> defined = NIL-&gt;defined<span class="punctuation">;</span>  <span class="comment-delimiter">// </span><span class="comment">just for symetry</span>
 
<span class="type">mapping</span> age = <span class="punctuation">([</span> <span class="string">"Toddler"</span>:<span class="number">3</span>, 
                 <span class="string">"Unborn"</span>:<span class="number">0</span>, 
                 <span class="string">"Phantasm"</span>:NIL <span class="punctuation">]);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span> <span class="punctuation">({</span> <span class="string">"Toddler"</span>, <span class="string">"Unborn"</span>, <span class="string">"Phantasm"</span>, <span class="string">"Relic"</span> <span class="punctuation">});;</span> <span class="type">string</span> thing<span class="punctuation">)</span> 
<span class="punctuation">{</span>
    write<span class="punctuation">(</span>thing+<span class="string">":"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>!zero_type<span class="punctuation">(</span>age<span class="punctuation">[</span>thing<span class="punctuation">]))</span>
      write<span class="punctuation">(</span><span class="string">" Exists"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>defined<span class="punctuation">(</span>age<span class="punctuation">[</span>thing<span class="punctuation">]))</span>
      write<span class="punctuation">(</span><span class="string">" Defined"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>age<span class="punctuation">[</span>thing<span class="punctuation">])</span>
      write<span class="punctuation">(</span><span class="string">" True"</span><span class="punctuation">);</span>
    write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Toddler: Exists Defined True</span>
<span class="comment-delimiter">// </span><span class="comment">Unborn: Exists Defined</span>
<span class="comment-delimiter">// </span><span class="comment">Phantasm: Exists</span>
<span class="comment-delimiter">// </span><span class="comment">Relic:</span>
 
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Toddler exists, because zero_type() is only true if the index is not in</span>
<span class="comment-delimiter">// </span><span class="comment">the mapping. it is defined because it exists an is not NIL. </span>
<span class="comment-delimiter">// </span><span class="comment">it is true because the value is not 0.</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Unborn exists, and is defined, but is false because 0 is false</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Phantasm exists, is not defined because it is NIL, </span>
<span class="comment-delimiter">// </span><span class="comment">it is not true because NIL is false.</span>
<span class="comment-delimiter">// </span><span class="comment">age-&gt;Relic does not exist, it is not defined even though it is not NIL</span>
<span class="comment-delimiter">// </span><span class="comment">because it doesn't exist. it is also not true, because it does not exist.</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------------------------------</span>
<span class="type">mapping</span> size = <span class="punctuation">([]);</span>
<span class="type">string</span> filename<span class="punctuation">;</span>
<span class="keyword">while</span><span class="punctuation">(</span>filename = <span class="constant">Stdio</span>.stdin-&gt;gets<span class="punctuation">())</span>
<span class="punctuation">{</span>
  filename -= <span class="string">"\n"</span><span class="punctuation">;</span>
  <span class="keyword">if</span><span class="punctuation">(</span>size<span class="punctuation">[</span>filename<span class="punctuation">])</span>                <span class="comment-delimiter">// </span><span class="comment">wrong</span>
    <span class="keyword">continue</span><span class="punctuation">;</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!zero_type<span class="punctuation">(</span>size<span class="punctuation">[</span>filename<span class="punctuation">]))</span>    <span class="comment-delimiter">// </span><span class="comment">right</span>
    <span class="keyword">continue</span>
  <span class="type">object</span> stat = file_stat<span class="punctuation">(</span>filename<span class="punctuation">)</span>  
  <span class="keyword">if</span><span class="punctuation">(</span>stat<span class="punctuation">)</span>
    size<span class="punctuation">[</span>filename<span class="punctuation">]</span> = stat-&gt;size<span class="punctuation">;</span>
  <span class="keyword">else</span>
    size<span class="punctuation">[</span>filename<span class="punctuation">]</span> = <span class="number">-1</span><span class="punctuation">;</span> <span class="comment-delimiter">// </span><span class="comment">since sizes can't be negative, this will do.</span>
                         <span class="comment-delimiter">// </span><span class="comment">if -1 is a valid value, use NIL</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN241"
>Deleting from a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">users occasionally may get the idea that mapping[index]=0; may remove index</span>
<span class="comment-delimiter">// </span><span class="comment">from mapping. the normal way to remove a index from a mapping is to</span>
<span class="comment-delimiter">// </span><span class="comment">subtract: mapping -= ([ index:0 ]); the following shall demonstrate the</span>
<span class="comment-delimiter">// </span><span class="comment">difference between subtracting a index and assigning 0 to it.</span>

<span class="comment-delimiter">// </span><span class="comment">food_color as per section 5.0</span>
<span class="type">void</span> print_foods<span class="punctuation">()</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"Foods:%{ %s%}\n"</span>, indices<span class="punctuation">(</span>food_color<span class="punctuation">));</span>
  write<span class="punctuation">(</span><span class="string">"Values: "</span><span class="punctuation">);</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>food_color<span class="punctuation">;</span> <span class="type">string</span> food<span class="punctuation">;</span> <span class="type">string</span> color<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="keyword">if</span><span class="punctuation">(</span>color<span class="punctuation">)</span>
      write<span class="punctuation">(</span>color+<span class="string">" "</span><span class="punctuation">);</span>
    <span class="keyword">else</span>
      write<span class="punctuation">(</span><span class="string">"(no value) "</span><span class="punctuation">);</span>
  <span class="punctuation">}</span>
  write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

write<span class="punctuation">(</span><span class="string">"Initially:\n"</span><span class="punctuation">);</span>
print_foods<span class="punctuation">();</span>

write<span class="punctuation">(</span><span class="string">"\nWith Banana set to 0\n"</span><span class="punctuation">);</span>
food_color-&gt;Banana = <span class="number">0</span><span class="punctuation">;</span>
print_foods<span class="punctuation">();</span>

write<span class="punctuation">(</span><span class="string">"\nWith Banana deleted\n"</span><span class="punctuation">);</span>
food_color -= <span class="punctuation">([</span> <span class="string">"Banana"</span>:<span class="string">"the value is irrelevant"</span> <span class="punctuation">]);</span>
print_foods<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">Initially:</span>
<span class="comment-delimiter">// </span><span class="comment">Foods: Lemon Banana Apple Carrot</span>
<span class="comment-delimiter">// </span><span class="comment">Values: yellow yellow red orange</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">With Banana set to 0</span>
<span class="comment-delimiter">// </span><span class="comment">Foods: Banana Lemon Apple Carrot</span>
<span class="comment-delimiter">// </span><span class="comment">Values: (no value) yellow red orange </span>
<span class="comment-delimiter">//  </span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">With Banana deleted</span>
<span class="comment-delimiter">// </span><span class="comment">Foods: Lemon Carrot Apple</span>
<span class="comment-delimiter">// </span><span class="comment">Values: yellow orange red</span>

<span class="comment-delimiter">// </span><span class="comment">you can also subtract multiple indices:</span>
food_color -= <span class="punctuation">([</span> <span class="string">"Banana"</span>:<span class="number">0</span>, <span class="string">"Apple"</span>:<span class="number">0</span>, <span class="string">"Cabbage"</span>:<span class="number">0</span> <span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">note that subtracting a mapping from another creates a new mapping.</span>
<span class="comment-delimiter">// </span><span class="comment">thus any references you have to a mapping will be broken.</span>
<span class="comment-delimiter">// </span><span class="comment">in most cases this is what you want anyways. if it is not, you can also</span>
<span class="comment-delimiter">// </span><span class="comment">remove indices using m_delete();</span>

m_delete<span class="punctuation">(</span>food_color, <span class="string">"Banana"</span><span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN244"
>Traversing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="keyword">foreach</span><span class="punctuation">(</span> <span class="type">mapping</span><span class="punctuation">;</span> type index<span class="punctuation">;</span> type value<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">//</span><span class="comment">do something with index and value</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">food_color as per 5.0</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>food_color<span class="punctuation">;</span> <span class="type">string</span> food<span class="punctuation">;</span> <span class="type">string</span> color<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s is %s.\n"</span>, food, color<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Banana is yellow.</span>
<span class="comment-delimiter">// </span><span class="comment">Lemon is yellow.</span>
<span class="comment-delimiter">// </span><span class="comment">Carrot is orange.</span>
<span class="comment-delimiter">// </span><span class="comment">Apple is red.</span>


<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>food_color<span class="punctuation">));;</span> <span class="type">string</span> food<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s is %s.\n"</span>, food, food_color<span class="punctuation">[</span>food<span class="punctuation">]);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Apple is red.</span>
<span class="comment-delimiter">// </span><span class="comment">Banana is yellow.</span>
<span class="comment-delimiter">// </span><span class="comment">Carrot is orange.</span>
<span class="comment-delimiter">// </span><span class="comment">Lemon is yellow.</span>

<span class="comment-delimiter">// </span><span class="comment">since pike does not have any equivalent to each() its problems do not apply</span>

<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch05/countfrom.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">countfrom - count number of messages from each sender
</span>
<span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">object</span> file<span class="punctuation">;</span>
  <span class="type">mapping</span> from = <span class="punctuation">([]);</span>

  <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>argv<span class="punctuation">)</span>&gt;<span class="number">1</span><span class="punctuation">)</span>
    file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>, <span class="string">"r"</span><span class="punctuation">);</span>
  <span class="keyword">else</span>
    file = <span class="constant">Stdio</span>.stdin<span class="punctuation">;</span>

  
  <span class="keyword">foreach</span><span class="punctuation">(</span>file<span class="punctuation">;</span> <span class="type">int</span> count<span class="punctuation">;</span> <span class="type">string</span> line<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">array</span> email = array_sscanf<span class="punctuation">(</span>line, <span class="string">"From: %s"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>email<span class="punctuation">))</span>
      from<span class="punctuation">[</span>email<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]]</span>++<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  write<span class="punctuation">(</span><span class="string">"end\n"</span><span class="punctuation">);</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>from<span class="punctuation">));;</span> <span class="type">string</span> person<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"%s: %d\n"</span>, person, from<span class="punctuation">[</span>person<span class="punctuation">]);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN247"
>Printing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">perls problems and solutions do not apply to pike</span>
<span class="comment-delimiter">// </span><span class="comment">here are a few ways to print a mapping:</span>
<span class="comment-delimiter">// </span><span class="comment">food_color as per 5.0</span>

<span class="comment-delimiter">// </span><span class="comment">debugging style</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, food_color<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">([ /* 4 elements */</span>
<span class="comment-delimiter">//   </span><span class="comment">"Apple": "red",</span>
<span class="comment-delimiter">//   </span><span class="comment">"Banana": "yellow",</span>
<span class="comment-delimiter">//   </span><span class="comment">"Carrot": "orange",</span>
<span class="comment-delimiter">//   </span><span class="comment">"Lemon": "yellow"</span>
<span class="comment-delimiter">// </span><span class="comment">])</span>

<span class="comment-delimiter">// </span><span class="comment">one element at a time:</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>food_color<span class="punctuation">;</span> <span class="type">string</span> food<span class="punctuation">;</span> <span class="type">string</span> color<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s is %s\n"</span>, food, color<span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Lemon is yellow</span>
<span class="comment-delimiter">// </span><span class="comment">Carrot is orange</span>
<span class="comment-delimiter">// </span><span class="comment">Banana is yellow</span>
<span class="comment-delimiter">// </span><span class="comment">Apple is red</span>

<span class="comment-delimiter">// </span><span class="comment">with the help of an array</span>
write<span class="punctuation">(</span><span class="string">"%{%s is %s\n%}"</span>, sort<span class="punctuation">((</span><span class="type">array</span><span class="punctuation">)</span>food_color<span class="punctuation">));</span>
<span class="comment-delimiter">// </span><span class="comment">Apple is red</span>
<span class="comment-delimiter">// </span><span class="comment">Banana is yellow</span>
<span class="comment-delimiter">// </span><span class="comment">Carrot is orange</span>
<span class="comment-delimiter">// </span><span class="comment">Lemon is yellow</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN250"
>Retrieving from a Hash in Insertion Order</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">for this we need to first create an OrderedMapping class.</span>
<span class="comment-delimiter">// </span><span class="comment">work for this is in progress</span>
<span class="comment-delimiter">// </span><span class="comment">@@INCOMPLETE@@</span>
<span class="comment-delimiter">// </span><span class="comment">@@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN253"
>Hashes with Multiple Values Per Key</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">))</span> ttys = <span class="punctuation">([]);</span>

<span class="type">object</span> pipe = <span class="constant">Stdio</span>.File<span class="punctuation">();</span>
<span class="constant">Process</span>.create_process<span class="punctuation">(({</span> <span class="string">"who"</span> <span class="punctuation">})</span>, <span class="punctuation">([</span> <span class="string">"stdout"</span>:pipe-&gt;pipe<span class="punctuation">()</span> <span class="punctuation">]));</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>pipe-&gt;line_iterator<span class="punctuation">();;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">array</span> tty=<span class="punctuation">(</span>line/<span class="string">" "</span><span class="punctuation">)</span>-<span class="punctuation">({</span> <span class="string">""</span> <span class="punctuation">});</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!ttys<span class="punctuation">[</span>tty<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]])</span>
    ttys<span class="punctuation">[</span>tty<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]]</span> = <span class="punctuation">({</span> tty<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">});</span>
  <span class="keyword">else</span>
    ttys<span class="punctuation">[</span>tty<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]]</span> += <span class="punctuation">({</span> tty<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>ttys<span class="punctuation">));;</span> <span class="type">string</span> user<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s: %{%s %}\n"</span>, user, ttys<span class="punctuation">[</span>user<span class="punctuation">]);</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>ttys<span class="punctuation">));;</span> <span class="type">string</span> user<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s: %d ttys.\n"</span>, user, sizeof<span class="punctuation">(</span>ttys<span class="punctuation">[</span>user<span class="punctuation">]));</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>ttys<span class="punctuation">[</span>user<span class="punctuation">];;</span> <span class="type">string</span> tty<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">object</span> stat = file_stat<span class="punctuation">(</span><span class="string">"/dev/"</span>+tty<span class="punctuation">);</span>
    <span class="type">string</span> user<span class="punctuation">;</span>
    <span class="keyword">if</span><span class="punctuation">(</span>stat<span class="punctuation">)</span>
      user = getpwuid<span class="punctuation">(</span>stat-&gt;uid<span class="punctuation">)[</span><span class="number">0</span><span class="punctuation">];</span>
    <span class="keyword">else</span>
      user = <span class="string">"(not available)"</span><span class="punctuation">;</span>
    write<span class="punctuation">(</span><span class="string">"\t%s (owned by %s)\n"</span>, tty, user<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">mapping</span> multihash_delete<span class="punctuation">(</span><span class="type">mapping</span> hash, <span class="type">mixed</span> key, <span class="type">mixed</span> value<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>arrayp<span class="punctuation">(</span>hash<span class="punctuation">[</span>key<span class="punctuation">]))</span>
    hash<span class="punctuation">[</span>key<span class="punctuation">]</span>-=<span class="punctuation">({</span> value <span class="punctuation">});</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!sizeof<span class="punctuation">(</span>hash<span class="punctuation">[</span>key<span class="punctuation">]))</span>
    m_delete<span class="punctuation">(</span>hash, key<span class="punctuation">);</span>
  <span class="keyword">return</span> hash<span class="punctuation">;</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN256"
>Inverting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">search for a value in a mapping</span>
<span class="type">mapping</span> lookup<span class="punctuation">;</span>
<span class="type">mixed</span> value<span class="punctuation">;</span>
<span class="type">mixed</span> key = search<span class="punctuation">(</span>lookup, value<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">transposing: (this will break if there are multiple occurances of a value)</span>
<span class="type">mapping</span> lookup<span class="punctuation">;</span>
<span class="type">mapping</span> reverse = mkmapping<span class="punctuation">(</span>values<span class="punctuation">(</span>lookup<span class="punctuation">)</span>, indices<span class="punctuation">(</span>lookup<span class="punctuation">));</span>
<span class="comment-delimiter">//</span><span class="comment">----------------------------------------------------------</span>
<span class="type">mapping</span> surname = <span class="punctuation">([</span> <span class="string">"Mickey"</span>:<span class="string">"Mantle"</span>, <span class="string">"Babe"</span>:<span class="string">"Ruth"</span> <span class="punctuation">]);</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, search<span class="punctuation">(</span>surname, <span class="string">"Mantle"</span><span class="punctuation">));</span>
<span class="comment-delimiter">// </span><span class="comment">Mikey</span>

<span class="comment-delimiter">// </span><span class="comment">with a transposed mapping (only worth doing if you'd have to search a lot)</span>
<span class="type">mapping</span> first_name = mkmapping<span class="punctuation">(</span>values<span class="punctuation">(</span>surname<span class="punctuation">)</span>, indices<span class="punctuation">(</span>surname<span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, first_name-&gt;Mantle<span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">Mikey</span>
<span class="comment-delimiter">//</span><span class="comment">----------------------------------------------------------</span>
<span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch05/foodfind.html">download the following standalone program</a></font>
#!/usr/bin/pike</span>

<span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>argc &lt; <span class="number">2</span><span class="punctuation">)</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"usage: foodfind food_or_color\n"</span><span class="punctuation">);</span>
  <span class="punctuation">}</span>

  <span class="type">string</span> given = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
  <span class="type">mapping</span> color = <span class="punctuation">([</span> <span class="string">"Apple"</span>:<span class="string">"red"</span>,
                     <span class="string">"Banana"</span>:<span class="string">"yellow"</span>,
                     <span class="string">"Lemon"</span>:<span class="string">"yellow"</span>,
                     <span class="string">"Carrot"</span>:<span class="string">"orange"</span>
                  <span class="punctuation">]);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>color<span class="punctuation">[</span>given<span class="punctuation">])</span>
    write<span class="punctuation">(</span><span class="string">"%s is a food with color %s\n"</span>, given, color<span class="punctuation">[</span>given<span class="punctuation">]);</span>
    
  <span class="type">string</span> food = search<span class="punctuation">(</span>color, given<span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>food<span class="punctuation">)</span>
    write<span class="punctuation">(</span><span class="string">"%s is a food with color %s\n"</span>, food, given<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">search will only find one value, 
</span><span class="comment-delimiter">// </span><span class="comment">but it can be given a place where it should start searching
</span>
  <span class="type">array</span> foods = <span class="punctuation">({</span> search<span class="punctuation">(</span>color, given<span class="punctuation">)</span> <span class="punctuation">});</span>
  food = <span class="number">0</span><span class="punctuation">;</span>
  <span class="keyword">while</span><span class="punctuation">(</span>food = search<span class="punctuation">(</span>color, given, foods<span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">]))</span>
  <span class="punctuation">{</span> 
    foods += <span class="punctuation">({</span> food <span class="punctuation">});</span>
  <span class="punctuation">}</span>
  write<span class="punctuation">(</span><span class="string">"%{%s %}were %s foods.\n"</span>, foods, given<span class="punctuation">);</span>

<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">----------------------------------------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">food_color as per 5.0</span>
<span class="type">mapping</span> foods_with_color = <span class="punctuation">([]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>food_color<span class="punctuation">;</span> <span class="type">string</span> food<span class="punctuation">;</span> <span class="type">string</span> color<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!foods_with_color<span class="punctuation">[</span>color<span class="punctuation">])</span>
    foods_with_color<span class="punctuation">[</span>color<span class="punctuation">]</span> = <span class="punctuation">({</span> food <span class="punctuation">});</span>
  <span class="keyword">else</span>
    foods_with_color<span class="punctuation">[</span>color<span class="punctuation">]</span> += <span class="punctuation">({</span> food <span class="punctuation">});</span>
<span class="punctuation">}</span>

write<span class="punctuation">(</span><span class="string">"%{%s %}were yellow foods.\n"</span>, foods_with_color-&gt;yellow<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN259"
>Sorting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span> hash<span class="punctuation">;</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>hash<span class="punctuation">));;</span> <span class="type">mixed</span> key<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mixed</span> value = hash<span class="punctuation">[</span>key<span class="punctuation">];</span>
  <span class="comment-delimiter">// </span><span class="comment">do something with key, value</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>sort<span class="punctuation">(</span>indices<span class="punctuation">(</span>food_color<span class="punctuation">));;</span> <span class="type">string</span> food<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s is %s.\n"</span>, food, food_color<span class="punctuation">[</span>food<span class="punctuation">]);</span>
<span class="punctuation">}</span>

<span class="type">array</span> foods = indices<span class="punctuation">(</span>food_color<span class="punctuation">);</span>
sort<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>values<span class="punctuation">(</span>food_color<span class="punctuation">)[</span>*<span class="punctuation">])</span>, foods<span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>foods<span class="punctuation">;;</span> <span class="type">string</span> food<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s is %s.\n"</span>, food, food_color<span class="punctuation">[</span>food<span class="punctuation">]);</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN262"
>Merging Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">the natural way to merge two mappings is to use + or |</span>
<span class="comment-delimiter">// </span><span class="comment">for mappings both operations are equivalent.</span>
<span class="type">mapping</span> A, B<span class="punctuation">;</span>
<span class="type">mapping</span> merged = A + B<span class="punctuation">;</span>
<span class="type">mapping</span> merged = A | B<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">if an index is in both mappings, the value will be taken from the second</span>
<span class="comment-delimiter">// </span><span class="comment">one. </span>

<span class="type">mapping</span> drink_color = <span class="punctuation">([</span> <span class="string">"Milk"</span>:<span class="string">"white"</span>,
                         <span class="string">"Tomato juice"</span>:<span class="string">"red"</span> <span class="punctuation">]);</span>

<span class="type">mapping</span> ingested_color = drink_color + food_color<span class="punctuation">;</span>

<span class="comment-delimiter">//  </span><span class="comment">Result: ([ /* 6 elements */</span>
<span class="comment-delimiter">//             </span><span class="comment">"Apple": "red",</span>
<span class="comment-delimiter">//             </span><span class="comment">"Banana": "yellow",</span>
<span class="comment-delimiter">//             </span><span class="comment">"Carrot": "orange",</span>
<span class="comment-delimiter">//             </span><span class="comment">"Lemon": "yellow",</span>
<span class="comment-delimiter">//             </span><span class="comment">"Milk": "white",</span>
<span class="comment-delimiter">//             </span><span class="comment">"Tomato juice": "red"</span>
<span class="comment-delimiter">//           </span><span class="comment">])</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN265"
>Finding Common or Different Keys in Two Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">create a mapping where indices are in both A and B</span>
<span class="type">mapping</span> both = A &amp; B<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">in A or B, but not in both</span>
<span class="type">mapping</span> one = A ^ B<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">in A, but not in B</span>
<span class="type">mapping</span> exA = A - B<span class="punctuation">;</span>

<span class="type">mapping</span> citrus_color = <span class="punctuation">([</span> <span class="string">"Lemon"</span>:<span class="string">"yellow"</span>,
                          <span class="string">"Orange"</span>:<span class="string">"orange"</span>,
                          <span class="string">"Lime"</span>:<span class="string">"green"</span> 
                       <span class="punctuation">]);</span>

<span class="type">array</span> non_citrus = indices<span class="punctuation">(</span>food_color - citrus_color<span class="punctuation">);</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN268"
>Hashing References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">this problem does not apply to pike</span>
<span class="comment-delimiter">// </span><span class="comment">any value may be used as an index, if you get an object reference from</span>
<span class="comment-delimiter">// </span><span class="comment">anywhere, if will work, if the index in the mapping is actually the same</span>
<span class="comment-delimiter">// </span><span class="comment">object.</span>
<span class="comment-delimiter">// </span><span class="comment">however note that the same value is not the same reference:</span>
<span class="type">array</span> a = <span class="punctuation">({</span> <span class="number">1</span>,<span class="number">2</span> <span class="punctuation">});</span>
<span class="type">array</span> b = <span class="punctuation">({</span> <span class="number">1</span>,<span class="number">2</span> <span class="punctuation">});</span>
<span class="type">mapping</span> m = <span class="punctuation">([</span> a:<span class="string">"a"</span> <span class="punctuation">]);</span>
m<span class="punctuation">[</span>b<span class="punctuation">];</span>  
<span class="comment-delimiter">// </span><span class="comment">Result: 0 (b will not be found.)</span>
m<span class="punctuation">[</span>b<span class="punctuation">]</span>=<span class="string">"b"</span><span class="punctuation">;</span>
m<span class="punctuation">;</span>
<span class="comment-delimiter">// </span><span class="comment">Result: ([ ({ 1, 2 }): "a",</span>
<span class="comment-delimiter">//            </span><span class="comment">({ 1, 2 }): "b"</span>
<span class="comment-delimiter">//           </span><span class="comment">])</span>
<span class="comment-delimiter">// </span><span class="comment">this looks as if the mapping has the same index twice</span>
<span class="comment-delimiter">// </span><span class="comment">but since they are references this is not the case.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN271"
>Presizing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">this problem does not apply to pike</span>
<span class="comment-delimiter">// </span><span class="comment">pike uses a smart preallocation algorythm that will avoid the need to</span>
<span class="comment-delimiter">// </span><span class="comment">allocate memory everytime an element is added</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN274"
>Finding the Most Common Anything</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span> count = <span class="punctuation">([]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>ARRAY<span class="punctuation">;;</span> <span class="type">mixed</span> element<span class="punctuation">)</span>
<span class="punctuation">{</span>
    count<span class="punctuation">[</span>element<span class="punctuation">]</span>++<span class="punctuation">;</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN277"
>Representing Relationships Between Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span> father = <span class="punctuation">([</span> <span class="string">"Cain"</span>:<span class="string">"Adam"</span>,
                    <span class="string">"Abel"</span>:<span class="string">"Adam"</span>,
                    <span class="string">"Seth"</span>:<span class="string">"Adam"</span>,
                    <span class="string">"Enoch"</span>:<span class="string">"Cain"</span>,
                    <span class="string">"Irad"</span>:<span class="string">"Enoch"</span>,
                    <span class="string">"Mehujael"</span>:<span class="string">"Irad"</span>,
                    <span class="string">"Methusael"</span>:<span class="string">"Mehujael"</span>,
                    <span class="string">"Lamech"</span>:<span class="string">"Methusael"</span>,
                    <span class="string">"Jabal"</span>:<span class="string">"Lamech"</span>,
                    <span class="string">"Jubal"</span>:<span class="string">"Lamech"</span>,
                    <span class="string">"Tubalcain"</span>:<span class="string">"Lamech"</span>,
                    <span class="string">"Enos"</span>:<span class="string">"Seth"</span> 
                 <span class="punctuation">]);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Stdio</span>.stdin<span class="punctuation">;;</span> <span class="type">string</span> name<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">do</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"%s "</span>, name<span class="punctuation">);</span>
  <span class="punctuation">}</span> <span class="keyword">while</span><span class="punctuation">(</span>name = father<span class="punctuation">[</span>name<span class="punctuation">]);</span>
  write<span class="punctuation">(</span><span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">mapping</span> children = <span class="punctuation">([]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>father<span class="punctuation">;</span> <span class="type">string</span> k<span class="punctuation">;</span> <span class="type">string</span> v<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!children<span class="punctuation">[</span>v<span class="punctuation">])</span>
    children<span class="punctuation">[</span>v<span class="punctuation">]</span> = <span class="punctuation">({</span> k <span class="punctuation">});</span>
  <span class="keyword">else</span>
    children<span class="punctuation">[</span>v<span class="punctuation">]</span> += <span class="punctuation">({</span> k <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Stdio</span>.stdin<span class="punctuation">;;</span> <span class="type">string</span> name<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"%s begat %s.\n"</span>, name, <span class="punctuation">(</span>children<span class="punctuation">[</span>name<span class="punctuation">]</span>||<span class="punctuation">({</span> <span class="string">"nobody"</span> <span class="punctuation">}))</span>*<span class="string">", "</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------------------------------</span>

<span class="type">mapping</span> includes = <span class="punctuation">([]);</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>files, <span class="type">string</span> file<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> F = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>file<span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!F<span class="punctuation">)</span>
    werror<span class="punctuation">(</span><span class="string">"Couldn't read %s; skipping.\n"</span>, file<span class="punctuation">);</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>F/<span class="string">"\n"</span><span class="punctuation">;;</span> <span class="type">string</span> line<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">array</span> included = array_sscanf<span class="punctuation">(</span>line, <span class="string">"%*[ \t]#include%*[ \t]%*[&lt;\"]%s%*[&gt;\"]%*[ \t]"</span><span class="punctuation">);</span>
    <span class="keyword">if</span><span class="punctuation">(</span>sizeof<span class="punctuation">(</span>included<span class="punctuation">))</span>
    <span class="punctuation">{</span>
      <span class="keyword">if</span><span class="punctuation">(</span>!includes<span class="punctuation">[</span>included<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]])</span>
        includes<span class="punctuation">[</span>included<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]]</span> = <span class="punctuation">({</span> file <span class="punctuation">});</span>
      <span class="keyword">else</span>
        includes<span class="punctuation">[</span>included<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]]</span> += <span class="punctuation">({</span> file <span class="punctuation">});</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------------------------------</span>

<span class="type">array</span> uniq = `|<span class="punctuation">(</span> @values<span class="punctuation">(</span>includes<span class="punctuation">)</span> <span class="punctuation">);</span>
<span class="type">array</span> include_free = sort<span class="punctuation">(</span> uniq - indices<span class="punctuation">(</span>includes<span class="punctuation">)</span> <span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">values(includes) is an array of arrays.</span>
<span class="comment-delimiter">// </span><span class="comment">@ splices values(includes) as arguments into `|()</span>
<span class="comment-delimiter">// </span><span class="comment">`|() is a function that represents the | operator: a|b|c is `|(a,b,c)</span>
<span class="comment-delimiter">// </span><span class="comment">| on arrays creates a new array with elements in a or b</span>
<span class="comment-delimiter">// </span><span class="comment">the resulting array is unique as long as each array only has unique elements</span>
<span class="comment-delimiter">// </span><span class="comment">from the uniq array we remove all those that are used as indices in the</span>
<span class="comment-delimiter">// </span><span class="comment">includes mapping.</span>
<span class="comment-delimiter">// </span><span class="comment">at last we sort the remaining list.</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN280"
>Program: dutree</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment"><font size="-1"><a href="https://pleac.sourceforge.net/include/pike/ch05/dutree">download the following standalone program</a></font>
#!/usr/bin/pike</span>
<span class="comment-delimiter">// </span><span class="comment">dutree - print sorted indented rendition of du output
</span><span class="comment-delimiter">// </span><span class="comment">as a slight deviation from the perl version, the sizes are still in one
</span><span class="comment-delimiter">// </span><span class="comment">column, to make it more readable.
</span>
<span class="type">array</span> input<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> args<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mapping</span> Dirsize=<span class="punctuation">([]);</span>
  <span class="type">mapping</span> Kids=<span class="punctuation">([]);</span>

  <span class="type">object</span> pipe = <span class="constant">Stdio</span>.File<span class="punctuation">();</span>
  <span class="constant">Process</span>.create_process<span class="punctuation">(({</span> <span class="string">"du"</span> <span class="punctuation">})</span>+args, <span class="punctuation">([</span> <span class="string">"stdout"</span>:pipe-&gt;pipe<span class="punctuation">()</span> <span class="punctuation">]));</span>

  <span class="type">string</span> name<span class="punctuation">;</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>pipe-&gt;line_iterator<span class="punctuation">();;</span> <span class="type">string</span> line<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">int</span> size<span class="punctuation">;</span>
    <span class="punctuation">[</span>size, name<span class="punctuation">]</span> = array_sscanf<span class="punctuation">(</span>line, <span class="string">"%d%*[ \t]%s"</span><span class="punctuation">);</span>
    Dirsize<span class="punctuation">[</span>name<span class="punctuation">]</span> = size<span class="punctuation">;</span>
    <span class="type">array</span> path = name/<span class="string">"/"</span><span class="punctuation">;</span>
    <span class="type">string</span> parent = path<span class="punctuation">[</span>..sizeof<span class="punctuation">(</span>path<span class="punctuation">)</span><span class="number">-2</span><span class="punctuation">]</span>*<span class="string">"/"</span><span class="punctuation">;</span>
    <span class="keyword">if</span><span class="punctuation">(</span>!Kids<span class="punctuation">[</span>parent<span class="punctuation">])</span>
      Kids<span class="punctuation">[</span>parent<span class="punctuation">]</span> = <span class="punctuation">({</span> name <span class="punctuation">});</span>
    <span class="keyword">else</span>
      Kids<span class="punctuation">[</span>parent<span class="punctuation">]</span> += <span class="punctuation">({</span> name <span class="punctuation">});</span>
  <span class="punctuation">}</span>
  <span class="keyword">return</span> <span class="punctuation">({</span> name, Dirsize, Kids <span class="punctuation">});</span>
<span class="punctuation">}</span>

<span class="type">void</span> getdots<span class="punctuation">(</span><span class="type">string</span> root, <span class="type">mapping</span> Dirsize, <span class="type">mapping</span> Kids<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> size, cursize<span class="punctuation">;</span>
  size = cursize = Dirsize<span class="punctuation">[</span>root<span class="punctuation">];</span>
  <span class="keyword">if</span><span class="punctuation">(</span>Kids<span class="punctuation">[</span>root<span class="punctuation">])</span>
  <span class="punctuation">{</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>Kids<span class="punctuation">[</span>root<span class="punctuation">];;</span> <span class="type">string</span> kid<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      cursize -= Dirsize<span class="punctuation">[</span>kid<span class="punctuation">];</span> 
      getdots<span class="punctuation">(</span>kid, Dirsize, Kids<span class="punctuation">);</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
  <span class="keyword">else</span>
    Kids<span class="punctuation">[</span>root<span class="punctuation">]</span> = <span class="punctuation">({});</span>

  <span class="keyword">if</span><span class="punctuation">(</span>size != cursize<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">string</span> dot = root+<span class="string">"/."</span><span class="punctuation">;</span>    
    Dirsize<span class="punctuation">[</span>dot<span class="punctuation">]</span> = cursize<span class="punctuation">;</span>
    Kids<span class="punctuation">[</span>root<span class="punctuation">]</span> += <span class="punctuation">({</span> dot <span class="punctuation">});</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">void</span> output<span class="punctuation">(</span><span class="type">string</span> root, <span class="type">mapping</span> Dirsize, <span class="type">mapping</span> Kids, 
            <span class="type">int</span> width, <span class="type">void</span>|<span class="type">string</span> prefix<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!prefix<span class="punctuation">)</span>
    prefix=<span class="string">""</span><span class="punctuation">;</span>
  <span class="type">string</span> path = <span class="punctuation">(</span>root/<span class="string">"/"</span><span class="punctuation">)[</span><span class="number">-1</span><span class="punctuation">];</span>
  <span class="type">int</span> size = Dirsize<span class="punctuation">[</span>root<span class="punctuation">];</span>
  write<span class="punctuation">(</span><span class="string">"%*d %s%s\n"</span>, width, size, prefix, path<span class="punctuation">);</span>
  prefix += <span class="string">"|"</span> + <span class="string">" "</span>*<span class="punctuation">(</span>sizeof<span class="punctuation">(</span>path<span class="punctuation">)</span><span class="number">-1</span><span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>Kids<span class="punctuation">[</span>root<span class="punctuation">])</span>
  <span class="punctuation">{</span>
    <span class="type">array</span> kids = Kids<span class="punctuation">[</span>root<span class="punctuation">];</span>
    <span class="comment-delimiter">// </span><span class="comment">get the dirsize for each kid and sort by that
</span>    sort<span class="punctuation">(</span>Dirsize<span class="punctuation">[</span>kids<span class="punctuation">[</span>*<span class="punctuation">]]</span>, kids<span class="punctuation">);</span> 
    
    <span class="comment-delimiter">// </span><span class="comment">make the output for each kid
</span>    output<span class="punctuation">(</span>kids<span class="punctuation">[</span>*<span class="punctuation">]</span>, Dirsize, Kids, width, prefix<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">void</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mapping</span> Dirsize<span class="punctuation">;</span>
  <span class="type">mapping</span> Kids<span class="punctuation">;</span>
  <span class="type">string</span> topdir<span class="punctuation">;</span>

  <span class="punctuation">[</span> topdir, Dirsize, Kids <span class="punctuation">]</span> = input<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span>..<span class="punctuation">]);</span>
  getdots<span class="punctuation">(</span>topdir, Dirsize, Kids<span class="punctuation">);</span>
  output<span class="punctuation">(</span>topdir, Dirsize, Kids, sizeof<span class="punctuation">((</span><span class="type">string</span><span class="punctuation">)</span>sort<span class="punctuation">(</span>values<span class="punctuation">(</span>Dirsize<span class="punctuation">))[</span><span class="number">-1</span><span class="punctuation">]));</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Arrays</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Pattern Matching</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>patternmatching.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Pattern Matching</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Hashes"
HREF="hashes.html"><LINK
REL="NEXT"
TITLE="File Access"
HREF="fileaccess.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="hashes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="fileaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PATTERNMATCHING"
>6. Pattern Matching</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN285"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN288"
>Copying and Substituting Simultaneously</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">@@INCOMPLETE@@</span>

<span class="comment-delimiter">// </span><span class="comment">by Scott McCoy [tag at cpan.org] </span>

 <span class="comment-delimiter">/* </span><span class="comment">Copying and Substituting Simultaniously */</span>
dst = Regexp<span class="punctuation">(</span><span class="string">"this"</span><span class="punctuation">)</span>-&gt;replace<span class="punctuation">(</span>src, <span class="string">"that"</span><span class="punctuation">);</span>
 <span class="comment-delimiter">/* </span><span class="comment">Copying and replacing...Same thing */</span>
dst = Regexp<span class="punctuation">(</span><span class="string">"this"</span><span class="punctuation">)</span>-&gt;replace<span class="punctuation">(</span>src, <span class="string">"that"</span><span class="punctuation">);</span>
 <span class="comment-delimiter">/* </span><span class="comment">Strip to basename */</span>
 <span class="comment-delimiter">// </span><span class="comment">Note this is best done with string manipulation functions, regexp here is</span>
 <span class="comment-delimiter">// </span><span class="comment">wasteful.  Same is true in perl.</span>
dst = Regexp<span class="punctuation">(</span><span class="string">"^.*/"</span><span class="punctuation">)</span>-&gt;replace<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, <span class="string">""</span><span class="punctuation">);</span>

<span class="type">string</span> capword = Regexp<span class="punctuation">(</span><span class="string">"[a-z]+"</span><span class="punctuation">)</span>-&gt;replace
        <span class="punctuation">(</span><span class="string">"foo.bar"</span>, 
            <span class="keyword">lambda</span> <span class="punctuation">(</span><span class="type">string</span> c<span class="punctuation">)</span> <span class="punctuation">{</span> 
                c<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> = upper_case<span class="punctuation">(</span>c<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]);</span> 
                <span class="keyword">return</span> c<span class="punctuation">;</span> 
            <span class="punctuation">}</span> <span class="punctuation">);</span>

<span class="comment-delimiter">/* </span><span class="comment">For the captured substitution, I'll have to figure out PCRE. */</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN291"
>Matching Letters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN294"
>Matching Words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN297"
>Commenting Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN300"
>Finding the Nth Occurrence of a Match</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN303"
>Matching Multiple Lines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN306"
>Reading Records with a Pattern Separator</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN309"
>Extracting a Range of Lines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN312"
>Matching Shell Globs as Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN315"
>Speeding Up Interpolated Matches</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN318"
>Testing for a Valid Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN321"
>Honoring Locale Settings in Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN324"
>Approximate Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN327"
>Matching from Where the Last Pattern Left Off</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN330"
>Greedy and Non-Greedy Matches</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN333"
>Detecting Duplicate Words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN336"
>Expressing AND, OR, and NOT in a Single Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN339"
>Matching Multiple-Byte Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN342"
>Matching a Valid Mail Address</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN345"
>Matching Abbreviations</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN348"
>Program: urlify</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN351"
>Program: tcgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN354"
>Regular Expression Grabbag</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="hashes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="fileaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Hashes</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>File Access</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>fileaccess.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>File Access</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Pattern Matching"
HREF="patternmatching.html"><LINK
REL="NEXT"
TITLE="File Contents"
HREF="filecontents.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="patternmatching.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="FILEACCESS"
>7. File Access</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN359"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">if you are going to read the whole file, the most common way is to use </span>
<span class="comment-delimiter">// </span><span class="comment">Stdio.read_file()</span>

<span class="type">string</span> INPUT = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span><span class="string">"/usr/local/widgets/data"</span><span class="punctuation">);</span>
<span class="keyword">if</span><span class="punctuation">(</span>!INPUT<span class="punctuation">)</span>
<span class="punctuation">{</span>
  werror<span class="punctuation">(</span><span class="string">"Couldn't open /usr/local/widgets/data for reading\n"</span><span class="punctuation">);</span>
  exit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>INPUT/<span class="string">"\n"</span><span class="punctuation">;;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>search<span class="punctuation">(</span>line, <span class="string">"blue"</span><span class="punctuation">)</span>!=<span class="number">-1</span><span class="punctuation">)</span>
    write<span class="punctuation">(</span>line+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">if you need more control over the process you can get a filehandle with</span>
<span class="comment-delimiter">// </span><span class="comment">Stdio.File()</span>

<span class="constant">Stdio</span>.File INPUT = <span class="constant">Stdio</span>.File<span class="punctuation">(</span><span class="string">"/usr/local/widgets/data"</span>, <span class="string">"r"</span><span class="punctuation">);</span>
<span class="keyword">if</span><span class="punctuation">(</span>!INPUT<span class="punctuation">)</span>
<span class="punctuation">{</span>
  werror<span class="punctuation">(</span><span class="string">"Couldn't open /usr/local/widgets/data for reading\n"</span><span class="punctuation">);</span>
  exit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>INPUT-&gt;line_iterator<span class="punctuation">();;</span> <span class="type">string</span> line<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>search<span class="punctuation">(</span>line, <span class="string">"blue"</span><span class="punctuation">)</span>!=<span class="number">-1</span><span class="punctuation">)</span>
    write<span class="punctuation">(</span>line+<span class="string">"\n"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
INPUT-&gt;close<span class="punctuation">();</span>

<span class="comment-delimiter">//</span><span class="comment">---------------------------------------------------------</span>

<span class="keyword">foreach</span><span class="punctuation">(</span><span class="constant">Stdio</span>.stdin<span class="punctuation">;;</span> <span class="type">string</span> line<span class="punctuation">)</span>            <span class="comment-delimiter">// </span><span class="comment">reads from STDIN</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span><span class="punctuation">(</span>!sizeof<span class="punctuation">(</span>array_sscanf<span class="punctuation">(</span>line, <span class="string">"%*s%d"</span><span class="punctuation">)))</span>
    werror<span class="punctuation">(</span><span class="string">"No digit found.\n"</span><span class="punctuation">);</span>              <span class="comment-delimiter">// </span><span class="comment">writes to STDERR</span>
  write<span class="punctuation">(</span><span class="string">"Read: %s\n"</span>, line<span class="punctuation">);</span>                  <span class="comment-delimiter">// </span><span class="comment">writes ot STDOUT</span>
<span class="punctuation">}</span>
<span class="constant">Stdio</span>.stdout-&gt;close<span class="punctuation">()</span> || werror<span class="punctuation">(</span><span class="string">"couldn't close STDOUT\n"</span><span class="punctuation">)</span> &amp;&amp; exit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">just as with Stdio.read_file(), there are convenience functions for writing:</span>
<span class="comment-delimiter">// </span><span class="comment">Stdio.write_file() and Stdio.append_file()</span>

<span class="constant">Stdio</span>.File logfile = <span class="constant">Stdio</span>.File<span class="punctuation">(</span><span class="string">"/tmp/log"</span>, <span class="string">"w"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">access modes are "r" for reading, "w" for writing and "a" for append</span>
<span class="comment-delimiter">// </span><span class="comment">default mode is "rw"</span>

<span class="comment-delimiter">// </span><span class="comment">to read a line you may use Stdio.File()-&gt;gets() or get a line_iterator() and</span>
<span class="comment-delimiter">// </span><span class="comment">read lines from it.</span>

<span class="type">object</span> LOGFILE = logfile-&gt;line_iterator<span class="punctuation">();</span>
<span class="keyword">do</span>
<span class="punctuation">{</span>
  <span class="type">string</span> line=LOGFILE-&gt;value<span class="punctuation">();</span>
<span class="punctuation">}</span>
<span class="keyword">while</span><span class="punctuation">(</span>LOGFILE-&gt;next<span class="punctuation">())</span>
logfile-&gt;close<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">or use foreach as shown above.</span>

<span class="comment-delimiter">// </span><span class="comment">write() is actually a shortcut for Stdio.stdout-&gt;write()</span>
<span class="comment-delimiter">// </span><span class="comment">you could get yourself a different shortcut by assigning that to a variable:</span>

<span class="type">function</span> write = logfile-&gt;write<span class="punctuation">;</span>     <span class="comment-delimiter">//  </span><span class="comment">switch to LOGFILE for write();</span>
write<span class="punctuation">(</span><span class="string">"Countdown initiated ...\n"</span><span class="punctuation">);</span>
write = <span class="constant">Stdio</span>.stdout-&gt;write<span class="punctuation">;</span>         <span class="comment-delimiter">//  </span><span class="comment">return to stdout</span>
write<span class="punctuation">(</span><span class="string">"You have 30 seconds to reach minimum safety distance.\n"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Stdio.File is unbuffered. a buffered version is provided by Stdio.FILE</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN362"
>Opening a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">use Stdio.read_file(), Stdio.write_file() and Stdio.append_file() for</span>
<span class="comment-delimiter">// </span><span class="comment">convenience, or Stdio.File for precision and to get a filehandle.</span>

<span class="type">string</span> path<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">open file for reading</span>
<span class="type">string</span> file = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>path<span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"r"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">open file for writing, create new file if needed, or else truncate old file</span>
<span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>path, <span class="string">"content"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wc"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">same with setting access permissions</span>
<span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>path, <span class="string">"content"</span>, <span class="number">0600</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wc"</span>, <span class="number">0600</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">open file for writing, create new file, file must not exist</span>
<span class="keyword">if</span><span class="punctuation">(</span>!file_stat<span class="punctuation">(</span>path<span class="punctuation">))</span>
  <span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>path, <span class="string">"content"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wcx"</span><span class="punctuation">);</span>

<span class="keyword">if</span><span class="punctuation">(</span>!file_stat<span class="punctuation">(</span>path<span class="punctuation">))</span>
  <span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>path, <span class="string">"content"</span>, <span class="number">0600</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wcx"</span>, <span class="number">0600</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">open file for appending, create if necessary</span>
<span class="constant">Stdio</span>.append_file<span class="punctuation">(</span>path, <span class="string">"content"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wac"</span><span class="punctuation">);</span>

<span class="constant">Stdio</span>.append_file<span class="punctuation">(</span>path, <span class="string">"content"</span>, <span class="number">0600</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wac"</span>, <span class="number">0600</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">open file for appending, file must exist</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"wacx"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">open file for update, file must exist</span>
<span class="type">string</span> file = <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>path<span class="punctuation">);</span>
<span class="type">string</span> updated = file+<span class="string">"foo"</span>  <span class="comment-delimiter">// </span><span class="comment">update contents of file</span>
<span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>path, updated<span class="punctuation">);</span>

<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path<span class="punctuation">);</span>          <span class="comment-delimiter">// </span><span class="comment">this is the default operation</span>

<span class="comment-delimiter">// </span><span class="comment">open file for update, file must not exist</span>
<span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"rwcx"</span><span class="punctuation">);</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN365"
>Opening Files with Unusual Filenames</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">since the filename is contained in a string, this problem does not apply</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN368"
>Expanding Tildes in Filenames</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> filename<span class="punctuation">;</span>

<span class="keyword">if</span><span class="punctuation">(</span>filename<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> == <span class="string">"~"</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> user, path, home<span class="punctuation">;</span>
  <span class="punctuation">[</span> user, path <span class="punctuation">]</span> = array_sscanf<span class="punctuation">(</span>filename, <span class="string">"~%[^/]%s"</span><span class="punctuation">);</span>
  <span class="keyword">if</span><span class="punctuation">(</span>user == <span class="string">""</span><span class="punctuation">)</span>
    home = getenv<span class="punctuation">(</span><span class="string">"HOME"</span><span class="punctuation">)</span> || getenv<span class="punctuation">(</span><span class="string">"LOGDIR"</span><span class="punctuation">)</span> || getpwuid<span class="punctuation">(</span>geteuid<span class="punctuation">())[</span><span class="number">5</span><span class="punctuation">];</span>
  <span class="keyword">else</span>
    home = getpwnam<span class="punctuation">(</span>user<span class="punctuation">)[</span><span class="number">5</span><span class="punctuation">];</span>
  filename = home+path<span class="punctuation">;</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN371"
>Making Perl Report Filenames in Errors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> path = <span class="string">"/tmp/fooo"</span><span class="punctuation">;</span>
<span class="type">mixed</span> error = <span class="keyword">catch</span>
<span class="punctuation">{</span>
  <span class="constant">Stdio</span>.File file = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>path, <span class="string">"r"</span><span class="punctuation">);</span>
<span class="punctuation">};</span>

<span class="keyword">if</span><span class="punctuation">(</span>error<span class="punctuation">)</span>
<span class="punctuation">{</span>
  werror<span class="punctuation">(</span><span class="string">"Couldn't open %s for reading:\n"</span>, path<span class="punctuation">);</span>
  werror<span class="punctuation">(</span>error<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]);</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">// </span><span class="comment">Couldn't open /tmp/fooo for reading: </span>
<span class="comment-delimiter">// </span><span class="comment">Failed to open "/tmp/fooo" mode "r" : No such file or directory</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN374"
>Creating Temporary Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="constant">Stdio</span>.File fh<span class="punctuation">;</span>
<span class="type">string</span> name<span class="punctuation">;</span>
<span class="keyword">do</span>
<span class="punctuation">{</span>
  name = <span class="string">"/tmp/"</span>+<span class="constant">MIME</span>.encode_base64<span class="punctuation">(</span>random_string<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">));</span>
  fh = <span class="constant">Stdio</span>.File<span class="punctuation">(</span>name, <span class="string">"rwcx"</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="keyword">while</span><span class="punctuation">(</span>!fh<span class="punctuation">)</span>

atexit<span class="punctuation">(</span><span class="keyword">lambda</span><span class="punctuation">(){</span> fh-&gt;close<span class="punctuation">();</span> rm<span class="punctuation">(</span>name<span class="punctuation">);</span> <span class="punctuation">});</span>


<span class="comment-delimiter">// </span><span class="comment">if you don't really need the file to be on disk (or if /tmp is a ramdisk)</span>
<span class="comment-delimiter">// </span><span class="comment">but you need an object that behaves like a file, then use Stdio.FakeFile</span>

fh = <span class="constant">Stdio</span>.FakeFile<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">and use fh like any other filehandle.</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN377"
>Storing Files Inside Your Program Text</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">since the usual way to handle files is to read them into a string, then just</span>
<span class="comment-delimiter">// </span><span class="comment">assign your data to a string and work from there:</span>

<span class="type">string</span> data = <span class="string">"your data goes here"</span><span class="punctuation">;</span>


<span class="comment-delimiter">// </span><span class="comment">or for convenient multiline data:</span>

<span class="type">string</span> data = #<span class="string">"your data goes here
and here
and ends here"</span><span class="punctuation">;</span>


<span class="comment-delimiter">// </span><span class="comment">or use Stdio.FakeFile for a Stdio.File compatible interface</span>
<span class="comment-delimiter">// </span><span class="comment">see 7.5</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------------------------------------------</span>

<span class="type">object</span> stat = file_stat<span class="punctuation">(</span>__FILE__<span class="punctuation">);</span>
<span class="type">int</span> raw_time = stat-&gt;ctime<span class="punctuation">;</span>
<span class="type">int</span> size     = stat-&gt;size<span class="punctuation">;</span>
<span class="type">int</span> kilosize = size/<span class="number">1024</span><span class="punctuation">;</span>

write<span class="punctuation">(</span><span class="string">"&lt;P&gt;Script size is %dk\n"</span>, kilosize<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"&lt;P&gt;Last script update: %s\n"</span>, <span class="constant">Calendar</span>.Second<span class="punctuation">(</span>raw_time<span class="punctuation">)</span>-&gt;format_nicez<span class="punctuation">());</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN380"
>Writing a Filter</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN383"
>Modifying a File in Place with Temporary File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN386"
>Modifying a File in Place with -i Switch</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN389"
>Modifying a File in Place Without a Temporary File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN392"
>Locking a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN395"
>Flushing Output</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN398"
>Reading from Many Filehandles Without Blocking</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN401"
>Doing Non-Blocking I/O</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN404"
>Determining the Number of Bytes to Read</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN407"
>Storing Filehandles in Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN410"
>Caching Open Output Filehandles</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN413"
>Printing to Many Filehandles Simultaneously</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN416"
>Opening and Closing File Descriptors by Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN419"
>Copying Filehandles</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN422"
>Program: netlock</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN425"
>Program: lockarea</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="patternmatching.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Pattern Matching</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>File Contents</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>filecontents.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>File Contents</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Access"
HREF="fileaccess.html"><LINK
REL="NEXT"
TITLE="Directories"
HREF="directories.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="fileaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="directories.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="FILECONTENTS"
>8. File Contents</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN430"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN433"
>Reading Lines with Continuation Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN436"
>Counting Lines (or Paragraphs or Records) in a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Does not check file existence but return a correct value with empty (size=0) files</span>
<span class="comment-delimiter">// </span><span class="comment">Does count paragraphs correctly (does not count empty lines (\n\n))</span>
<span class="type">int</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="type">int</span> count=<span class="number">0</span><span class="punctuation">;</span>
    <span class="type">object</span> f = <span class="constant">Stdio</span>.FILE<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>f-&gt;line_iterator<span class="punctuation">(</span>f<span class="punctuation">);</span> <span class="type">int</span> number<span class="punctuation">;</span> <span class="type">string</span> paragraph<span class="punctuation">)</span> <span class="punctuation">{</span>
        count++<span class="punctuation">;</span>
        <span class="comment-delimiter">// </span><span class="comment">write(number+" "+paragraph+"\n");</span>
    <span class="punctuation">}</span>
    write<span class="punctuation">(</span><span class="string">"number of paragraphs= "</span>+count+<span class="string">"\n"</span><span class="punctuation">);</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN439"
>Processing Every Word in a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN442"
>Reading a File Backwards by Line or Paragraph</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN445"
>Trailing a Growing File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN448"
>Picking a Random Line from a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN451"
>Randomizing All Lines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN454"
>Reading a Particular Line in a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN457"
>Processing Variable-Length Text Fields</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN460"
>Removing the Last Line of a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN463"
>Processing Binary Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN466"
>Using Random-Access I/O</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN469"
>Updating a Random-Access File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN472"
>Reading a String from a Binary File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN475"
>Reading Fixed-Length Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN478"
>Reading Configuration Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN481"
>Testing a File for Trustworthiness</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN484"
>Program: tailwtmp</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN487"
>Program: tctee</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN490"
>Program: laston</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="fileaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="directories.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Access</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Directories</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>directories.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Directories</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Contents"
HREF="filecontents.html"><LINK
REL="NEXT"
TITLE="Subroutines"
HREF="subroutines.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DIRECTORIES"
>9. Directories</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN495"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="constant">Stdio</span>.Stat entry<span class="punctuation">;</span>

entry = file_stat<span class="punctuation">(</span><span class="string">"/bin/vi"</span><span class="punctuation">);</span>
entry = file_stat<span class="punctuation">(</span><span class="string">"/usr/bin"</span><span class="punctuation">);</span>
entry = file_stat<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="constant">Stdio</span>.Stat entry<span class="punctuation">;</span> <span class="type">int</span> ctime, size<span class="punctuation">;</span>

entry = file_stat<span class="punctuation">(</span><span class="string">"/bin/vi"</span><span class="punctuation">);</span>
ctime = entry-&gt;ctime<span class="punctuation">;</span>
size = entry-&gt;size<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">A routine detecting whether a file is a 'text' file doesn't appear</span>
<span class="comment-delimiter">// </span><span class="comment">to exist, so have implemented the following [crude] function(s)</span>
<span class="comment-delimiter">// </span><span class="comment">which search for a LF / NEWLINE in the file:</span>

<span class="comment-delimiter">// </span><span class="comment">Usable with any file</span>
<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> containsText<span class="punctuation">(</span><span class="constant">Stdio</span>.File file<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> c<span class="punctuation">;</span>
  <span class="keyword">while</span> <span class="punctuation">((</span>c = file-&gt;read<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">))</span> != NULL<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="punctuation">(</span>c == NEWLINE<span class="punctuation">)</span> &amp;&amp; <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Alternate version, expects a buffered file [usually containing text]</span>
<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> containsText<span class="punctuation">(</span><span class="constant">Stdio</span>.FILE file<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> c<span class="punctuation">;</span>
  <span class="keyword">while</span> <span class="punctuation">((</span>c = file-&gt;getchar<span class="punctuation">())</span> != EOF<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="punctuation">(</span>c == LF<span class="punctuation">)</span> &amp;&amp; <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Yet another alternative - this time we cheat and use the *NIX 'file'</span>
<span class="comment-delimiter">// </span><span class="comment">utility :) !</span>

<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> isTextFile<span class="punctuation">(</span><span class="type">string</span> filename<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> chop<span class="punctuation">(</span><span class="constant">Process</span>.popen<span class="punctuation">(</span><span class="string">"file -bN "</span> + filename<span class="punctuation">)</span>, <span class="number">1</span><span class="punctuation">)</span>  == <span class="string">"ASCII text"</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

containsText<span class="punctuation">(</span><span class="constant">Stdio</span>.File<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]))</span> || write<span class="punctuation">(</span><span class="string">"File %s doesn't have any text in it\n"</span>, argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>

isTextFile<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">])</span> || write<span class="punctuation">(</span><span class="string">"File %s doesn't have any text in it\n"</span>, argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="constant">Filesystem</span>.Traversion dirtree = <span class="constant">Filesystem</span>.Traversion<span class="punctuation">(</span><span class="string">"/usr/bin"</span><span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>dirtree<span class="punctuation">;</span> <span class="type">string</span> dir<span class="punctuation">;</span> <span class="type">string</span> file<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"Inside %s is something called %s\n"</span>, chop<span class="punctuation">(</span>dir, <span class="number">1</span><span class="punctuation">)</span>, file<span class="punctuation">);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN498"
>Getting and Setting Timestamps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> filename = <span class="string">"example.txt"</span><span class="punctuation">;</span>

<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>filename<span class="punctuation">);</span>
<span class="type">int</span> readtime = fs-&gt;atime, writetime = fs-&gt;mtime<span class="punctuation">;</span>

<span class="constant">System</span>.utime<span class="punctuation">(</span>filename, readtime, writetime<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="keyword">constant</span> <span class="variable-name">SECONDS_PER_DAY</span> = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span><span class="punctuation">;</span>

<span class="type">string</span> filename = <span class="string">"example.txt"</span><span class="punctuation">;</span>

<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>filename<span class="punctuation">);</span>
<span class="type">int</span> atime = fs-&gt;atime, mtime = fs-&gt;mtime<span class="punctuation">;</span>

atime -= <span class="number">7</span> * SECONDS_PER_DAY<span class="punctuation">;</span> mtime -= <span class="number">7</span> * SECONDS_PER_DAY<span class="punctuation">;</span>

<span class="constant">System</span>.utime<span class="punctuation">(</span>filename, atime, mtime<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

argc != <span class="number">1</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" filename"</span><span class="punctuation">);</span>

<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
<span class="type">int</span> atime = fs-&gt;atime, mtime = fs-&gt;mtime<span class="punctuation">;</span>

<span class="constant">Process</span>.system<span class="punctuation">(</span>getenv<span class="punctuation">(</span><span class="string">"EDITOR"</span><span class="punctuation">)</span> || <span class="string">"vi"</span> + <span class="string">" "</span> + argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>

<span class="type">mixed</span> result = <span class="keyword">catch</span> <span class="punctuation">{</span> <span class="constant">System</span>.utime<span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>, atime, mtime<span class="punctuation">);</span> <span class="punctuation">};</span>
<span class="punctuation">(</span>result == OK<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Error updating timestamp on file, %s!\n"</span>, argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN501"
>Deleting a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> filename = <span class="string">"..."</span><span class="punctuation">;</span>

rm<span class="punctuation">(</span>filename<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Can't delete, %s!\n"</span>, filename<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> rmAll<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filelist<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">mixed</span> result = <span class="keyword">catch</span>
  <span class="punctuation">{</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>filelist, <span class="type">string</span> filename<span class="punctuation">)</span> <span class="punctuation">{</span> rm<span class="punctuation">(</span>filename<span class="punctuation">)</span> || <span class="keyword">throw</span><span class="punctuation">(</span>PROBLEM<span class="punctuation">);</span> <span class="punctuation">}</span>
  <span class="punctuation">};</span>
  
  <span class="keyword">return</span> result == OK<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filelist = <span class="punctuation">({</span><span class="string">"/tmp/x"</span>, <span class="string">"/tmp/y"</span>, <span class="string">"/tmp/z"</span><span class="punctuation">});</span>

rmAll<span class="punctuation">(</span>filelist<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Can't delete all files in array!\n"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">void</span> die<span class="punctuation">(</span><span class="type">string</span> msg, <span class="type">void</span>|<span class="type">int</span><span class="punctuation">(</span><span class="number">1</span>..<span class="number">256</span><span class="punctuation">)</span> rc<span class="punctuation">)</span> <span class="punctuation">{</span> werror<span class="punctuation">(</span>msg + NEWLINE<span class="punctuation">);</span> exit<span class="punctuation">(</span>rc ? rc : PROBLEM<span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> filename = <span class="string">"..."</span><span class="punctuation">;</span>

rm<span class="punctuation">(</span>filename<span class="punctuation">)</span> || die<span class="punctuation">(</span><span class="string">"Can't delete "</span> + filename<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filelist = <span class="punctuation">({</span><span class="string">"/tmp/x"</span>, <span class="string">"/tmp/y"</span>, <span class="string">"/tmp/z"</span><span class="punctuation">});</span>

<span class="type">int</span> deleted, count = sizeof<span class="punctuation">(</span>filelist<span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>filelist, <span class="type">string</span> filename<span class="punctuation">)</span> <span class="punctuation">{</span> rm<span class="punctuation">(</span>filename<span class="punctuation">)</span> &amp;&amp; ++deleted<span class="punctuation">;</span> <span class="punctuation">}</span>

<span class="punctuation">(</span>deleted == count<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Could only delete %d of %d files\n"</span>, deleted, count<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN504"
>Copying or Moving a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> oldfile = <span class="string">"/tmp/old"</span>, newfile = <span class="string">"/tmp/new"</span><span class="punctuation">;</span>

<span class="constant">Stdio</span>.cp<span class="punctuation">(</span>oldfile, newfile<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Error copying file\n"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> oldfile = <span class="string">"/tmp/old"</span>, newfile = <span class="string">"/tmp/new"</span><span class="punctuation">;</span>

<span class="type">mixed</span> result = <span class="keyword">catch</span> <span class="punctuation">{</span> <span class="constant">Stdio</span>.write_file<span class="punctuation">(</span>newfile, <span class="constant">Stdio</span>.read_file<span class="punctuation">(</span>oldfile<span class="punctuation">));</span> <span class="punctuation">};</span>

<span class="punctuation">(</span>result == OK<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Problem copying file %s to file %s\n"</span>, oldfile, newfile<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Note: This is a cross between, 'Process.system', which displays</span>
<span class="comment-delimiter">// </span><span class="comment">output on stdout, and, 'Process.popen', which does not display</span>
<span class="comment-delimiter">// </span><span class="comment">output [it returns it as a string] but does not return the status</span>
<span class="comment-delimiter">// </span><span class="comment">code</span>
<span class="type">int</span> system<span class="punctuation">(</span><span class="type">string</span> cmd<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="constant">Stdio</span>.File fout = <span class="constant">Stdio</span>.File<span class="punctuation">()</span>, ferr = <span class="constant">Stdio</span>.File<span class="punctuation">();</span>
  <span class="constant">Stdio</span>.File pout = fout-&gt;pipe<span class="punctuation">(</span><span class="constant">Stdio</span>.PROP_IPC<span class="punctuation">)</span>,
             perr = ferr-&gt;pipe<span class="punctuation">(</span><span class="constant">Stdio</span>.PROP_IPC<span class="punctuation">);</span>

  <span class="type">int</span> rc = <span class="constant">Process</span>.spawn<span class="punctuation">(</span>cmd, <span class="number">0</span>, pout, perr<span class="punctuation">)</span>-&gt;wait<span class="punctuation">();</span>

  pout-&gt;close<span class="punctuation">();</span> destruct<span class="punctuation">(</span>pout<span class="punctuation">);</span> fout-&gt;close<span class="punctuation">();</span> destruct<span class="punctuation">(</span>fout<span class="punctuation">);</span>
  perr-&gt;close<span class="punctuation">();</span> destruct<span class="punctuation">(</span>perr<span class="punctuation">);</span> ferr-&gt;close<span class="punctuation">();</span> destruct<span class="punctuation">(</span>ferr<span class="punctuation">);</span>

  <span class="keyword">return</span> rc<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> unixFileCopy<span class="punctuation">(</span><span class="type">string</span> oldfile, <span class="type">string</span> newfile<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> cmd = <span class="string">"cp --force --reply=yes "</span> + oldfile + <span class="string">" "</span> + newfile<span class="punctuation">;</span>
  <span class="keyword">return</span> system<span class="punctuation">(</span>cmd<span class="punctuation">)</span> == OK<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> vmsFileCopy<span class="punctuation">(</span><span class="type">string</span> oldfile, <span class="type">string</span> newfile<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> cmd = <span class="string">"copy "</span> + oldfile + <span class="string">" "</span> + newfile<span class="punctuation">;</span>
  <span class="keyword">return</span> system<span class="punctuation">(</span>cmd<span class="punctuation">)</span> == OK<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> oldfile = <span class="string">"/tmp/old"</span>, newfile = <span class="string">"/tmp/new"</span><span class="punctuation">;</span>

unixFileCopy<span class="punctuation">(</span>oldfile, newfile<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Problem copying file %s to file %s\n"</span>, oldfile, newfile<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> oldfile = <span class="string">"/tmp/old"</span>, newfile = <span class="string">"/tmp/new"</span><span class="punctuation">;</span>

mv<span class="punctuation">(</span>oldfile, newfile<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Problem moving / renaming file %s to file %s\n"</span>, oldfile, newfile<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN507"
>Recognizing Two Names for the Same File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">mapping</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>:<span class="type">int</span><span class="punctuation">)</span> seen = <span class="punctuation">([]);</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">void</span> do_my_thing<span class="punctuation">(</span><span class="type">string</span> filename<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>filename<span class="punctuation">);</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr = aggregate<span class="punctuation">(</span>fs-&gt;inode, fs-&gt;dev<span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">Could do this [apply a lambda assigned to variable 'p']:</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">//    </span><span class="comment">... || (p(arr), seen[arr] = 1);</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">//    </span><span class="comment">function p = lambda(array(int) arr) { ... };</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">// </span><span class="comment">to process a file that has not previously been seen</span>
  
  <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> &amp;&amp; <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> += <span class="number">1</span><span class="punctuation">))</span> || <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> = <span class="number">1</span><span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="keyword">constant</span> <span class="variable-name">SEP</span> = <span class="string">":"</span><span class="punctuation">;</span> <span class="type">mapping</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>:<span class="type">string</span><span class="punctuation">)</span> seen = <span class="punctuation">([]);</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> files = <span class="punctuation">({</span><span class="string">"f1.txt"</span>, <span class="string">"f2.txt"</span>, <span class="string">"f3.txt"</span><span class="punctuation">});</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>files, <span class="type">string</span> filename<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>filename<span class="punctuation">);</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr = aggregate<span class="punctuation">(</span>fs-&gt;inode, fs-&gt;dev<span class="punctuation">);</span>
  <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> &amp;&amp; <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> += <span class="punctuation">(</span>SEP + filename<span class="punctuation">)))</span> || <span class="punctuation">(</span>seen<span class="punctuation">[</span>arr<span class="punctuation">]</span> = filename<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">))</span> idxarr = indices<span class="punctuation">(</span>seen<span class="punctuation">);</span> sort<span class="punctuation">(</span>idxarr<span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>idxarr, <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> inodev<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>seen<span class="punctuation">[</span>inodev<span class="punctuation">]</span> / SEP, <span class="type">string</span> filename<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="comment-delimiter">// </span><span class="comment">... do stuff with each filename ...</span>
    write<span class="punctuation">(</span><span class="string">"%s\n"</span>, filename<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN510"
>Processing All Files in a Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> dirname = <span class="string">"..."</span><span class="punctuation">;</span> <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> DIR = get_dir<span class="punctuation">(</span>dirname<span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>DIR, <span class="type">string</span> filename<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> path = dirname + <span class="string">"/"</span> + filename<span class="punctuation">;</span>
  <span class="comment-delimiter">// </span><span class="comment">... do something with 'path' ...</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> dirname = <span class="string">"/usr/local/bin"</span><span class="punctuation">;</span> <span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> DIR = get_dir<span class="punctuation">(</span>dirname<span class="punctuation">);</span>

DIR || die<span class="punctuation">(</span><span class="string">"Can't open "</span> + dirname<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"Text files in %s are:\n"</span>, dirname<span class="punctuation">);</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>DIR, <span class="type">string</span> filename<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> path = dirname + <span class="string">"/"</span> + filename<span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">'isTextFile' defined in an earlier section</span>
  isTextFile<span class="punctuation">(</span>path<span class="punctuation">)</span> &amp;&amp; write<span class="punctuation">(</span><span class="string">"%s\n"</span>, filename<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">'.' and '..' don't show up in a 'get_dir'-generated array</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> plain_files<span class="punctuation">(</span><span class="type">string</span> dirname<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">'filter' procedure</span>
  <span class="type">function</span> fp =
    <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> filename, <span class="type">string</span> dirname<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      <span class="comment-delimiter">// </span><span class="comment">'isTextFile' defined in an earlier section</span>
      <span class="keyword">return</span> !has_prefix<span class="punctuation">(</span>filename, <span class="string">"."</span><span class="punctuation">)</span> &amp;&amp; isTextFile<span class="punctuation">(</span>dirname + <span class="string">"/"</span> + filename<span class="punctuation">);</span>
    <span class="punctuation">};</span>

  <span class="comment-delimiter">// </span><span class="comment">'map' procedure</span>
  <span class="type">function</span> mp =
    <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> filename, <span class="type">string</span> dirname<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      <span class="keyword">return</span> dirname + <span class="string">"/"</span> + filename<span class="punctuation">;</span>
    <span class="punctuation">};</span>

  <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> paths = map<span class="punctuation">(</span>filter<span class="punctuation">(</span>get_dir<span class="punctuation">(</span>dirname<span class="punctuation">)</span>, fp, dirname<span class="punctuation">)</span>, mp, dirname<span class="punctuation">);</span>

  sort<span class="punctuation">(</span>paths<span class="punctuation">);</span>

  <span class="keyword">return</span> paths<span class="punctuation">;</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN513"
>Globbing, or Getting a List of Filenames Matching a Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">A 'glob' workalike that filters using regular expressions</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Note: Pike offers many non-regexp-based string pattern matching</span>
<span class="comment-delimiter">// </span><span class="comment">functions [e.g. 'has_prefix' and other 'has_...' functions,</span>
<span class="comment-delimiter">// </span><span class="comment">'search', etc]. These are preferable in many situations as they are</span>
<span class="comment-delimiter">// </span><span class="comment">much faster than regexprs. However, code shown here mostly uses</span>
<span class="comment-delimiter">// </span><span class="comment">regexprs in order to better match the Perl examples</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> grep<span class="punctuation">(</span><span class="type">string</span> regexp, <span class="type">string</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> arr<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>stringp<span class="punctuation">(</span>arr<span class="punctuation">))</span> <span class="keyword">return</span> <span class="constant">Regexp</span>.match<span class="punctuation">(</span>regexp, arr<span class="punctuation">);</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>arrayp<span class="punctuation">(</span>arr<span class="punctuation">))</span>
  <span class="punctuation">{</span>
    <span class="type">function</span> fp =
      <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> filename, <span class="type">string</span> regexp<span class="punctuation">)</span>
      <span class="punctuation">{</span>
        <span class="keyword">return</span> <span class="constant">Regexp</span>.match<span class="punctuation">(</span>regexp, filename<span class="punctuation">);</span>
      <span class="punctuation">};</span>

    <span class="keyword">return</span> filter<span class="punctuation">(</span>arr, fp, regexp<span class="punctuation">);</span>
  <span class="punctuation">}</span>

  <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> dirname = <span class="string">"..."</span><span class="punctuation">;</span>
<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filenames = glob<span class="punctuation">(</span><span class="string">"*.c"</span>, get_dir<span class="punctuation">(</span>dirname<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">string</span> dirname = <span class="string">"..."</span><span class="punctuation">;</span>
<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filenames = grep<span class="punctuation">(</span><span class="string">"\.c$"</span>, get_dir<span class="punctuation">(</span>dirname<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">string</span> dirname = <span class="string">"..."</span><span class="punctuation">;</span>
<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filenames = grep<span class="punctuation">(</span><span class="string">"\.[CHch]$"</span>, get_dir<span class="punctuation">(</span>dirname<span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> dirname = <span class="string">"..."</span><span class="punctuation">;</span>
<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> dir = get_dir<span class="punctuation">(</span>dirname<span class="punctuation">);</span>

dir || die<span class="punctuation">(</span><span class="string">"Couldn't open "</span> + dirname + <span class="string">" for reading"</span><span class="punctuation">);</span>

<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Note: Pike arrays are immutable, so we use a mapping to emulate</span>
<span class="comment-delimiter">// </span><span class="comment">mutable arrays by using a numeric index as the key :)</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="type">mapping</span><span class="punctuation">(</span><span class="type">int</span>:<span class="type">string</span><span class="punctuation">)</span> files = <span class="punctuation">([]);</span> <span class="type">int</span> idx = <span class="number">-1</span><span class="punctuation">;</span> <span class="type">string</span> path<span class="punctuation">;</span>    

<span class="keyword">foreach</span><span class="punctuation">(</span>dir, <span class="type">string</span> file<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>!grep<span class="punctuation">(</span><span class="string">"\.[CHch]$"</span>, file<span class="punctuation">))</span> <span class="keyword">continue</span><span class="punctuation">;</span>
  path = dirname + <span class="string">"/"</span> + file<span class="punctuation">;</span>
  isTextFile<span class="punctuation">(</span>path<span class="punctuation">)</span> &amp;&amp; <span class="punctuation">(</span>files<span class="punctuation">[</span>++idx<span class="punctuation">]</span> = path<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Note: Traverse a mapping-based, emulated array in index order:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//  </span><span class="comment">foreach(sort(indices(files)), int i)</span>
<span class="comment-delimiter">//  </span><span class="comment">{</span>
<span class="comment-delimiter">//    </span><span class="comment">write("%d -&gt; %s\n", i, files[i]); </span>
<span class="comment-delimiter">//  </span><span class="comment">}</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN516"
>Processing All Files in a Directory Recursively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Routine inspired by library function, 'Stdio.recursive_rm'. A little</span>
<span class="comment-delimiter">// </span><span class="comment">extra code helped make it more generally useful</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="type">void</span>|<span class="type">mixed</span> process_directory<span class="punctuation">(</span><span class="type">string</span> path, <span class="type">function</span><span class="punctuation">(</span><span class="type">string</span>, <span class="type">mixed</span> ... : <span class="type">void</span>|<span class="type">mixed</span><span class="punctuation">)</span> op, <span class="type">mixed</span> ... extra_args<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="constant">Stdio</span>.Stat file = file_stat<span class="punctuation">(</span>path, <span class="number">1</span><span class="punctuation">);</span> <span class="keyword">if</span> <span class="punctuation">(</span>!file<span class="punctuation">)</span> <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>file-&gt;isdir<span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> files = get_dir<span class="punctuation">(</span>path<span class="punctuation">))</span>
      <span class="keyword">foreach</span><span class="punctuation">(</span>files, <span class="type">string</span> file<span class="punctuation">)</span>
        process_directory<span class="punctuation">(</span>path + <span class="string">"/"</span> + file, op, @extra_args<span class="punctuation">);</span>

  <span class="keyword">return</span> op<span class="punctuation">(</span>path, @extra_args<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> dirlist = <span class="punctuation">({</span> <span class="string">"/tmp/d1"</span>, <span class="string">"/tmp/d2"</span>, <span class="string">"/tmp/d3"</span> <span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">Do something with each directory in the list</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>dirlist, <span class="type">string</span> dir<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Delete directory [if empty]     -&gt; rm(dir); </span>
  <span class="comment-delimiter">// </span><span class="comment">Make it the 'current directory' -&gt; cd(dir);</span>
  <span class="comment-delimiter">// </span><span class="comment">Get list of files it contains   -&gt; array(string) filelist = get_dir(dir);</span>
  <span class="comment-delimiter">// </span><span class="comment">Get directory metadata          -&gt; Stdio.Stat ds = file_stat(dir);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> dirlist = <span class="punctuation">({</span> <span class="string">"/tmp/d1"</span>, <span class="string">"/tmp/d2"</span>, <span class="string">"/tmp/d3"</span> <span class="punctuation">});</span>

<span class="type">function</span> pf =
  <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> path<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="comment-delimiter">// </span><span class="comment">... do something to the file or directory ...</span>
    write<span class="punctuation">(</span><span class="string">"%s\n"</span>, path<span class="punctuation">);</span>
  <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">For each directory in the list ...</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>dirlist, <span class="type">string</span> dir<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filelist = get_dir<span class="punctuation">(</span>dir<span class="punctuation">);</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>!filelist<span class="punctuation">)</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"%s does not exist\n"</span>, dir<span class="punctuation">);</span> <span class="keyword">continue</span><span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>sizeof<span class="punctuation">(</span>filelist<span class="punctuation">)</span> == <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"%s is empty\n"</span>, dir<span class="punctuation">);</span> <span class="keyword">continue</span><span class="punctuation">;</span> <span class="punctuation">}</span>

  <span class="comment-delimiter">// </span><span class="comment">For each file / directory in the directory ...</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>filelist, <span class="type">string</span> filename<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="comment-delimiter">// </span><span class="comment">Apply function to process the file / directory</span>
    pf<span class="punctuation">(</span>dir + <span class="string">"/"</span> + filename<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Special steps need to be taken in above routines to distinguish </span>
<span class="comment-delimiter">// </span><span class="comment">between files and directories. Easiest to abstract out directory</span>
<span class="comment-delimiter">// </span><span class="comment">traversal into a single routine [so allowing for recursive traversal</span>
<span class="comment-delimiter">// </span><span class="comment">of entire tree], and have it apply a lambda to each file</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> dirlist = <span class="punctuation">({</span> <span class="string">"/tmp/d1"</span>, <span class="string">"/tmp/d2"</span>, <span class="string">"/tmp/d3"</span> <span class="punctuation">});</span>

<span class="type">function</span> pf =
  <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> path<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="comment-delimiter">// </span><span class="comment">... do something to the file or directory ...</span>
    write<span class="punctuation">(</span><span class="string">"%s\n"</span>, path<span class="punctuation">);</span>
  <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">For each directory in the list ...</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>dirlist, <span class="type">string</span> dir<span class="punctuation">)</span>
<span class="punctuation">{</span>
  process_directory<span class="punctuation">(</span>dir, pf<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">void</span> accum_filesize<span class="punctuation">(</span><span class="type">string</span> path, <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> accum<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>path<span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">Accumulate size only if it is a regular file</span>
  <span class="punctuation">(</span>fs &amp;&amp; fs-&gt;isreg<span class="punctuation">)</span> &amp;&amp; <span class="punctuation">(</span>accum<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> += fs-&gt;size<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Verify arguments ...</span>
argc == <span class="number">2</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" dir"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.Stat fs<span class="punctuation">;</span> <span class="type">string</span> dir = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="punctuation">((</span>fs = file_stat<span class="punctuation">(</span>dir<span class="punctuation">))</span> &amp;&amp; fs-&gt;isdir<span class="punctuation">)</span> || die<span class="punctuation">(</span>dir + <span class="string">" does not exist / not a directory"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Collect data [use an array to accumulate results]</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> dirsize = <span class="punctuation">({</span><span class="number">0</span><span class="punctuation">});</span>
process_directory<span class="punctuation">(</span>dir, accum_filesize, dirsize<span class="punctuation">);</span> 

<span class="comment-delimiter">// </span><span class="comment">Report results</span>
write<span class="punctuation">(</span><span class="string">"%s contains %d bytes\n"</span>, dir, dirsize<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">void</span> biggest_file<span class="punctuation">(</span><span class="type">string</span> path, <span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> biggest<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>path<span class="punctuation">);</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>fs &amp;&amp; fs-&gt;isreg &amp;&amp; biggest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> &lt; fs-&gt;size<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    biggest<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> = path<span class="punctuation">;</span> biggest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> = fs-&gt;size<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Verify arguments ...</span>
argc == <span class="number">2</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" dir"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.Stat fs<span class="punctuation">;</span> <span class="type">string</span> dir = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="punctuation">((</span>fs = file_stat<span class="punctuation">(</span>dir<span class="punctuation">))</span> &amp;&amp; fs-&gt;isdir<span class="punctuation">)</span> || die<span class="punctuation">(</span>dir + <span class="string">" does not exist / not a directory"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Collect data [use an array to store results]</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> biggest = <span class="punctuation">({</span><span class="string">""</span>, <span class="number">0</span><span class="punctuation">});</span>
process_directory<span class="punctuation">(</span>dir, biggest_file, biggest<span class="punctuation">);</span> 

<span class="comment-delimiter">// </span><span class="comment">Report results</span>
write<span class="punctuation">(</span><span class="string">"Biggest file is %s containing %d bytes\n"</span>, biggest<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, biggest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">void</span> youngest_file<span class="punctuation">(</span><span class="type">string</span> path, <span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> youngest<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>path<span class="punctuation">);</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>fs &amp;&amp; fs-&gt;isreg &amp;&amp; youngest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> &gt; fs-&gt;ctime<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    youngest<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> = path<span class="punctuation">;</span> youngest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> = fs-&gt;ctime<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Verify arguments ...</span>
argc == <span class="number">2</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" dir"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.Stat fs<span class="punctuation">;</span> <span class="type">string</span> dir = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="punctuation">((</span>fs = file_stat<span class="punctuation">(</span>dir<span class="punctuation">))</span> &amp;&amp; fs-&gt;isdir<span class="punctuation">)</span> || die<span class="punctuation">(</span>dir + <span class="string">" does not exist / not a directory"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Collect data [use an array to store results]</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> youngest = <span class="punctuation">({</span><span class="string">""</span>, <span class="constant">Int</span>.NATIVE_MAX<span class="punctuation">});</span>
process_directory<span class="punctuation">(</span>dir, youngest_file, youngest<span class="punctuation">);</span> 

<span class="comment-delimiter">// </span><span class="comment">Report results</span>
write<span class="punctuation">(</span><span class="string">"Youngest file is %s dating %s\n"</span>, youngest<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>, ctime<span class="punctuation">(</span>youngest<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">void</span> print_name_if_dir<span class="punctuation">(</span><span class="type">string</span> path<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="constant">Stdio</span>.Stat fs = file_stat<span class="punctuation">(</span>path<span class="punctuation">);</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>fs &amp;&amp; fs-&gt;isdir<span class="punctuation">)</span> write<span class="punctuation">(</span><span class="string">"%s\n"</span>, path<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Verify arguments ...</span>
argc == <span class="number">2</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" dir"</span><span class="punctuation">);</span>
<span class="constant">Stdio</span>.Stat fs<span class="punctuation">;</span> <span class="type">string</span> dir = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span>
<span class="punctuation">((</span>fs = file_stat<span class="punctuation">(</span>dir<span class="punctuation">))</span> &amp;&amp; fs-&gt;isdir<span class="punctuation">)</span> || die<span class="punctuation">(</span>dir + <span class="string">" does not exist / not a directory"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Print directory names</span>
process_directory<span class="punctuation">(</span>dir, print_name_if_dir<span class="punctuation">);</span> 
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN519"
>Removing a Directory and Its Contents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Easy way - recommended</span>
<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> rmTree<span class="punctuation">(</span><span class="type">string</span> dirname<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="constant">Stdio</span>.recursive_rm<span class="punctuation">(</span>dirname<span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> dirtree = <span class="string">"/tmp/dirtree"</span><span class="punctuation">;</span>

rmTree<span class="punctuation">(</span>dirtree<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Problem removing directory tree %s\n"</span>, dirtree<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Another way, but unnecessary - probably for customised deletions only</span>
<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> rmTree<span class="punctuation">(</span><span class="type">string</span> dirname<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> process_directory<span class="punctuation">(</span>dirname, rm<span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> dirtree = <span class="string">"/tmp/dirtree"</span><span class="punctuation">;</span>

rmTree<span class="punctuation">(</span>dirtree<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Problem removing directory tree %s\n"</span>, dirtree<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN522"
>Renaming Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">A list of file names</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> names = <span class="punctuation">({</span><span class="string">"f1.txt"</span>, <span class="string">"f2.txt"</span>, <span class="string">"f3.txt"</span><span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">Dynamically assigned 'rename' procedure - can be reassigned at any time</span>
<span class="type">function</span> rename = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> name<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> replace<span class="punctuation">(</span>name, <span class="string">".txt"</span>, <span class="string">".text"</span><span class="punctuation">);</span> <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">Process all files</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>names, <span class="type">string</span> name<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Generate new name from existing name by applying 'rename' procedure</span>
  <span class="type">string</span> newname = rename<span class="punctuation">(</span>name<span class="punctuation">);</span> 

  <span class="comment-delimiter">// </span><span class="comment">Perform actual rename task on file</span>
  mv<span class="punctuation">(</span>name, newname<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Could not rename %s to %s\n"</span>, name, newname<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Slightly different to the Perl example, though it does use regexp</span>
<span class="comment-delimiter">// </span><span class="comment">and intent is roughly the same.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">pike SCRIPTNAME '\.txt$' '.text' f1.txt f2.txt df3.txg</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//    </span><span class="comment">f1.txt  -&gt; f1.text</span>
<span class="comment-delimiter">//    </span><span class="comment">f2.txt  -&gt; f2.text</span>
<span class="comment-delimiter">//    </span><span class="comment">df3.txg -&gt; df3.txg [no change]</span>
<span class="comment-delimiter">//</span><span class="comment"></span>

argc &gt; <span class="number">2</span> || die<span class="punctuation">(</span><span class="string">"usage: "</span> + argv<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> + <span class="string">" expr repl files..."</span><span class="punctuation">);</span>

<span class="type">string</span> expr = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>, repl = argv<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">];</span>

<span class="keyword">foreach</span><span class="punctuation">(</span>argv<span class="punctuation">[</span><span class="number">3</span>..<span class="punctuation">]</span>, <span class="type">string</span> name<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> newname = <span class="constant">Regexp</span>.replace<span class="punctuation">(</span>expr, name, repl<span class="punctuation">);</span> 

  <span class="keyword">if</span> <span class="punctuation">(</span>!equal<span class="punctuation">(</span>name, newname<span class="punctuation">))</span>
    mv<span class="punctuation">(</span>name, newname<span class="punctuation">)</span> || write<span class="punctuation">(</span><span class="string">"Could not rename %s to %s\n"</span>, name, newname<span class="punctuation">);</span>
<span class="punctuation">}</span> 
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN525"
>Splitting a Filename into Its Component Parts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">string</span> file_extension<span class="punctuation">(</span><span class="type">string</span> filename, <span class="type">void</span>|<span class="type">string</span> separator<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>filename / <span class="punctuation">(</span>separator || <span class="string">"."</span><span class="punctuation">))[</span><span class="number">-1</span><span class="punctuation">];</span>
<span class="punctuation">}</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> file_parse<span class="punctuation">(</span><span class="type">string</span> path<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span>
    mkmapping<span class="punctuation">(({</span><span class="string">"dirname"</span>, <span class="string">"basename"</span>, <span class="string">"extension"</span><span class="punctuation">})</span>,
      <span class="punctuation">({</span>dirname<span class="punctuation">(</span>path<span class="punctuation">)</span>, basename<span class="punctuation">(</span>path<span class="punctuation">)</span>, file_extension<span class="punctuation">(</span>basename<span class="punctuation">(</span>path<span class="punctuation">))}));</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> path = <span class="string">"/tmp/dirtree/s/s1/s1.txt"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> dir = dirname<span class="punctuation">(</span>path<span class="punctuation">);</span>
<span class="type">string</span> base = basename<span class="punctuation">(</span>path<span class="punctuation">);</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> pm = file_parse<span class="punctuation">(</span>path<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, pm<span class="punctuation">[</span><span class="string">"dirname"</span><span class="punctuation">]);</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, pm<span class="punctuation">[</span><span class="string">"basename"</span><span class="punctuation">]);</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, pm<span class="punctuation">[</span><span class="string">"extension"</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">string</span> path = <span class="string">"/usr/lib/libc.a"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">string</span> dir = dirname<span class="punctuation">(</span>path<span class="punctuation">);</span>
<span class="type">string</span> base = basename<span class="punctuation">(</span>path<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"dir is %s, file is %s\n"</span>, dir, base<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">string</span> path = <span class="string">"/usr/lib/libc.a"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> pm = file_parse<span class="punctuation">(</span>path<span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"dir is %s, name is %s, extension is %s\n"</span>,
  pm<span class="punctuation">[</span><span class="string">"dirname"</span><span class="punctuation">]</span>, pm<span class="punctuation">[</span><span class="string">"basename"</span><span class="punctuation">]</span>, <span class="string">"."</span> + pm<span class="punctuation">[</span><span class="string">"extension"</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Handle as a general purpose parse task</span>
<span class="type">string</span> path = <span class="string">"Hard%20Drive:System%20Folder:README.txt"</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span>
  pm = mkmapping<span class="punctuation">(({</span><span class="string">"drive"</span>, <span class="string">"folder"</span>, <span class="string">"filename"</span><span class="punctuation">})</span>,
                 replace<span class="punctuation">(</span>path, <span class="string">"%20"</span>, <span class="string">" "</span><span class="punctuation">)</span> / <span class="string">":"</span><span class="punctuation">)</span>,

  fm = mkmapping<span class="punctuation">(({</span><span class="string">"name"</span>, <span class="string">"extension"</span><span class="punctuation">})</span>,
                 pm<span class="punctuation">[</span><span class="string">"filename"</span><span class="punctuation">]</span> / <span class="string">"."</span><span class="punctuation">);</span>

write<span class="punctuation">(</span><span class="string">"dir is %s, name is %s, extension is %s\n"</span>,
  pm<span class="punctuation">[</span><span class="string">"drive"</span><span class="punctuation">]</span> + <span class="string">":"</span> + pm<span class="punctuation">[</span><span class="string">"folder"</span><span class="punctuation">]</span>,
  fm<span class="punctuation">[</span><span class="string">"name"</span><span class="punctuation">]</span>, <span class="string">"."</span> + fm<span class="punctuation">[</span><span class="string">"extension"</span><span class="punctuation">]);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">See implementation for 'file_extension' function above</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN528"
>Program: symirror</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>@@INCOMPLETE@@
@@INCOMPLETE@@
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN531"
>Program: lst</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>@@INCOMPLETE@@
@@INCOMPLETE@@
</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Contents</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Subroutines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>subroutines.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Subroutines</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Directories"
HREF="directories.html"><LINK
REL="NEXT"
TITLE="References and Records"
HREF="referencesandrecords.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="directories.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SUBROUTINES"
>10. Subroutines</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN536"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Here, in this simple example, 'greeted', is used as a 'global'</span>
<span class="comment-delimiter">// </span><span class="comment">variable. In a more complex program, however, this would not be</span>
<span class="comment-delimiter">// </span><span class="comment">the case [subsequent sections exlain why]</span>
<span class="type">int</span> greeted<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">void</span> hello<span class="punctuation">()</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"hi there!, this procedure has been called %d times\n"</span>, ++greeted<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="type">int</span> how_many_greetings<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> greeted<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  hello<span class="punctuation">();</span>
  <span class="type">int</span> greetings = how_many_greetings<span class="punctuation">();</span>
  write<span class="punctuation">(</span><span class="string">"bye there!, there have been %d greetings so far\n"</span>, greetings<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Alternate means of defining functions [could, optionally, have also</span>
<span class="comment-delimiter">// </span><span class="comment">included type information in 'function' declaration]; could also</span>
<span class="comment-delimiter">// </span><span class="comment">have been done within scope of 'main'</span>

<span class="type">int</span> greeted<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">function</span> hello = <span class="keyword">lambda</span><span class="punctuation">()</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"hi there!, this procedure has been called %d times\n"</span>, ++greeted<span class="punctuation">);</span>
  <span class="punctuation">};</span>

<span class="type">function</span> how_many_greetings = <span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> greeted<span class="punctuation">;</span> <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  hello<span class="punctuation">();</span>
  <span class="type">int</span> greetings = how_many_greetings<span class="punctuation">();</span>
  write<span class="punctuation">(</span><span class="string">"bye there!, there have been %d greetings so far\n"</span>, greetings<span class="punctuation">);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN539"
>Accessing Subroutine Arguments</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Subroutine parameters are named, that is, access to these items from</span>
<span class="comment-delimiter">// </span><span class="comment">within a function is reliant on their being named in the parameter</span>
<span class="comment-delimiter">// </span><span class="comment">list [together with mandatory type information], something which is</span>
<span class="comment-delimiter">// </span><span class="comment">in line with many other commonly-used languages</span>

<span class="type">float</span> hypotenuse<span class="punctuation">(</span><span class="type">float</span> side1, <span class="type">float</span> side2<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Arguments passed to this function are accessable as, 'side1',</span>
  <span class="comment-delimiter">// </span><span class="comment">and 'side2', respectively, and each is expected to be a 'float'</span>
  <span class="comment-delimiter">// </span><span class="comment">type</span>
  <span class="keyword">return</span> side1 * side1 + side2 * side2<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">'side1' -&gt; 3.0</span>
<span class="comment-delimiter">// </span><span class="comment">'side2' -&gt; 4.0</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">However, Pike also allows parameters [and return types where applicable]:</span>
<span class="comment-delimiter">// </span><span class="comment">* To have one of a set of types [see (1)]</span>
<span class="comment-delimiter">// </span><span class="comment">* To have a generic type [see (2)]</span>
<span class="comment-delimiter">// </span><span class="comment">* To be optional, in which case any arguments are packaged as an</span>
<span class="comment-delimiter">//   </span><span class="comment">array, and array notation needed to access each item [see (3)]</span>

<span class="comment-delimiter">// </span><span class="comment">(1). Here the function will accept either 'int' or 'float'</span>
<span class="comment-delimiter">// </span><span class="comment">arguments, and perform runtime type checking to identify what is</span>
<span class="comment-delimiter">// </span><span class="comment">supplied</span>
<span class="type">float</span> hypotenuse<span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span> side1, <span class="type">int</span>|<span class="type">float</span> side2<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">If 'int' arguments passed. convert to 'float'</span>
  <span class="type">float</span> s1 = intp<span class="punctuation">(</span>side1<span class="punctuation">)</span> ? <span class="punctuation">(</span><span class="type">float</span><span class="punctuation">)</span> side1 : side1<span class="punctuation">;</span>
  <span class="type">float</span> s2 = intp<span class="punctuation">(</span>side2<span class="punctuation">)</span> ? <span class="punctuation">(</span><span class="type">float</span><span class="punctuation">)</span> side2 : side2<span class="punctuation">;</span>

  <span class="keyword">return</span> s1 * s1 + s2 * s2<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Both are legal calls</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3</span>, <span class="number">4</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">(2). Here the function still expects to be called with two arguments </span>
<span class="comment-delimiter">// </span><span class="comment">but each may be of *any* type [admittedly a very contrived example</span>
<span class="comment-delimiter">// </span><span class="comment">of little utility except for illustrative value]. Such a function</span>
<span class="comment-delimiter">// </span><span class="comment">is almost entirely reliant on careful runtime type checking if it</span>
<span class="comment-delimiter">// </span><span class="comment">is to behave reliably</span>
<span class="type">float</span> hypotenuse<span class="punctuation">(</span><span class="type">mixed</span> side1, <span class="type">mixed</span> side2<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>stringp<span class="punctuation">(</span>side1<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>arrayp<span class="punctuation">(</span>side1<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>objectp<span class="punctuation">(</span>side1<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
  ...  
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">All are legal calls</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3</span>, <span class="number">4</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="string">"3"</span>, <span class="string">"4"</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(({</span><span class="number">3</span><span class="punctuation">})</span>, <span class="punctuation">({</span><span class="number">4</span><span class="punctuation">}));</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">(3). Here, the function is defined to accept two, mandatory</span>
<span class="comment-delimiter">// </span><span class="comment">parameters [still accessable via name], then a set of zero or more</span>
<span class="comment-delimiter">// </span><span class="comment">optional parameters, which are accessable within the function body</span>
<span class="comment-delimiter">// </span><span class="comment">via an array [the placeholder, 'args', represents an array of zero</span>
<span class="comment-delimiter">// </span><span class="comment">or more elements each corresponding to one of the passed arguments</span>
<span class="type">float</span> hypotenuse<span class="punctuation">(</span><span class="type">float</span> side1, <span class="type">mixed</span> side2, <span class="type">mixed</span> ... args<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Mandatory parameters still accessable as usual</span>
  ... side1 ... side2 ...

  <span class="comment-delimiter">// </span><span class="comment">Total number of arguments passed to function determinable via:</span>
  <span class="type">int</span> total_passed_args = query_num_arg<span class="punctuation">();</span>
  
  <span class="comment-delimiter">// </span><span class="comment">'args' contains all optional arguments: 0 - N</span>
  <span class="type">int</span> optional_args = sizeof<span class="punctuation">(</span>args<span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">Process variable arguments ...</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>args, <span class="type">mixed</span> arg<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    ... <span class="keyword">if</span> <span class="punctuation">(</span>strinp<span class="punctuation">(</span>arg<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
  <span class="punctuation">}</span>

  ...
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">All are legal calls</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span>, <span class="string">"a"</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span>, <span class="keyword">lambda</span><span class="punctuation">(){</span> <span class="keyword">return</span> <span class="number">5</span><span class="punctuation">;</span> <span class="punctuation">}</span>, <span class="string">"fff"</span><span class="punctuation">);</span>
<span class="type">float</span> diag = hypotenuse<span class="punctuation">(</span><span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">1</span>, <span class="string">"x"</span>, <span class="punctuation">({</span> <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span> <span class="punctuation">}));</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Modifies copy</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> int_all<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> arr<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> retarr = copy_value<span class="punctuation">(</span>arr<span class="punctuation">);</span>
  <span class="type">int</span> i<span class="punctuation">;</span> <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i &lt; sizeof<span class="punctuation">(</span>retarr<span class="punctuation">);</span> ++i<span class="punctuation">)</span> <span class="punctuation">{</span> retarr<span class="punctuation">[</span>i<span class="punctuation">]</span> = <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr<span class="punctuation">[</span>i<span class="punctuation">];</span> <span class="punctuation">}</span>
  <span class="keyword">return</span> retarr<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Modifies original</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> trunc_all<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> arr<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> i<span class="punctuation">;</span> <span class="keyword">for</span><span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i &lt; sizeof<span class="punctuation">(</span>arr<span class="punctuation">);</span> ++i<span class="punctuation">)</span> <span class="punctuation">{</span> arr<span class="punctuation">[</span>i<span class="punctuation">]</span> = <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr<span class="punctuation">[</span>i<span class="punctuation">];</span> <span class="punctuation">}</span>
  <span class="keyword">return</span> arr<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> nums = <span class="punctuation">({</span><span class="number">1.4</span>, <span class="number">3.5</span>, <span class="number">6.7</span><span class="punctuation">});</span>

<span class="comment-delimiter">// </span><span class="comment">Copy modified - 'ints' and 'nums' separate arrays</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span>|<span class="type">float</span><span class="punctuation">)</span> ints = int_all<span class="punctuation">(</span>nums<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, nums<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, ints<span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">Original modified - 'ints' acts as alias for 'nums'</span>
ints = trunc_all<span class="punctuation">(</span>nums<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, nums<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, ints<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN542"
>Making Variables Private to a Function</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="type">void</span> some_func<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Variables declared within a function are local to that function</span>
  <span class="type">mixed</span> variable = something<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Assuming these are defined at file level, that is, outside of 'main'</span>
<span class="comment-delimiter">// </span><span class="comment">or any other function they are accessable by every other member of</span>
<span class="comment-delimiter">// </span><span class="comment">the same file [and if this file (read: class or program) is the</span>
<span class="comment-delimiter">// </span><span class="comment">only one comprising the 'system', they are effectively 'global']</span>
<span class="type">string</span> name = argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">];</span> <span class="type">int</span> age = <span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> argv<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">];</span>

<span class="type">int</span> c = fetch_time<span class="punctuation">();</span>

<span class="type">int</span> condition<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> run_check<span class="punctuation">()</span>
<span class="punctuation">{</span>
  ...
  condition = <span class="number">1</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">int</span> check_x<span class="punctuation">(</span><span class="type">int</span> x<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">string</span> y = <span class="string">"whatever"</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Whilst 'run_check' has access to 'name', 'age', and 'c' [because</span>
  <span class="comment-delimiter">// </span><span class="comment">these are declared at a higher scope], it does not have access to</span>
  <span class="comment-delimiter">// </span><span class="comment">'y' or any other locally defined variable</span>
  run_check<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">'run_check' will have updated 'condition'</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>condition<span class="punctuation">)</span> write<span class="punctuation">(</span><span class="string">"got x: %d\n"</span>, x<span class="punctuation">);</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN545"
>Creating Persistent Private Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike does not implement C style 'static' variables [i.e. persisent</span>
<span class="comment-delimiter">// </span><span class="comment">local variables], nor does it implement C++ style 'class variables'</span>
<span class="comment-delimiter">// </span><span class="comment">[oddly enough, also implemented in C++ via use of the 'static'</span>
<span class="comment-delimiter">// </span><span class="comment">keyword], both of which could be used to implement solutions to the</span>
<span class="comment-delimiter">// </span><span class="comment">problems presented in this section. Also, there is no direct</span>
<span class="comment-delimiter">// </span><span class="comment">equivalent to Perl's 'BEGIN' block [closest equivalent is the</span>
<span class="comment-delimiter">// </span><span class="comment">class 'create' method]. So, to solve a problem like implementing a</span>
<span class="comment-delimiter">// </span><span class="comment">'counter':</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* Use Pike's OOP facilities [simple, natural]</span>
<span class="comment-delimiter">// </span><span class="comment">* Use closures [somewhat unwieldly, but possible]</span>

<span class="comment-delimiter">// </span><span class="comment">OOP Approach</span>
<span class="keyword">class</span> <span class="function-name">Counter</span>
<span class="punctuation">{</span>
  <span class="keyword">private</span> <span class="type">int</span> counter<span class="punctuation">;</span>

  <span class="keyword">static</span> <span class="type">void</span> create<span class="punctuation">(</span><span class="type">int</span> start<span class="punctuation">)</span> <span class="punctuation">{</span> counter = start<span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="keyword">public</span> <span class="type">int</span> next<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> ++counter<span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="keyword">public</span> <span class="type">int</span> prev<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> --counter<span class="punctuation">;</span> <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  Counter counter = Counter<span class="punctuation">(</span><span class="number">42</span><span class="punctuation">);</span>

  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter-&gt;next<span class="punctuation">());</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter-&gt;prev<span class="punctuation">());</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">A refinement of the previous implementation that mimics 'static'</span>
<span class="comment-delimiter">// </span><span class="comment">variables</span>

<span class="keyword">class</span> <span class="function-name">Static</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">'static' variable that is shared by all instance of 'Counter'</span>
  <span class="type">int</span> counter<span class="punctuation">;</span>

  <span class="keyword">class</span> <span class="function-name">Counter</span>
  <span class="punctuation">{</span>
    <span class="keyword">public</span> <span class="type">int</span> next<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> ++counter<span class="punctuation">;</span> <span class="punctuation">}</span>
    <span class="keyword">public</span> <span class="type">int</span> prev<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> --counter<span class="punctuation">;</span> <span class="punctuation">}</span>
  <span class="punctuation">}</span>

  Counter make<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> Counter<span class="punctuation">();</span> <span class="punctuation">}</span>

  <span class="keyword">public</span> <span class="type">void</span> create<span class="punctuation">(</span><span class="type">int</span> counter_<span class="punctuation">)</span> <span class="punctuation">{</span> counter = counter_<span class="punctuation">;</span> <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  Static mkst = Static<span class="punctuation">(</span><span class="number">42</span><span class="punctuation">);</span>

  <span class="constant">Static</span>.Counter counter_1 = mkst-&gt;make<span class="punctuation">();</span>
  <span class="constant">Static</span>.Counter counter_2 = mkst-&gt;make<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">Same value of, 'counter', is accessed by each object</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter_1-&gt;next<span class="punctuation">());</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter_1-&gt;next<span class="punctuation">());</span>

  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter_2-&gt;next<span class="punctuation">());</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, counter_2-&gt;prev<span class="punctuation">());</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Closure Approach [Admittedly somewhat contrived: a Scheme overdose ;) !]</span>

<span class="type">function</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">int</span><span class="punctuation">))</span> make_counter<span class="punctuation">(</span><span class="type">int</span> start<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> counter = start<span class="punctuation">;</span>
  <span class="type">int</span> next_counter<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> ++counter<span class="punctuation">;</span> <span class="punctuation">};</span>
  <span class="type">int</span> prev_counter<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> --counter<span class="punctuation">;</span> <span class="punctuation">};</span>
  
  <span class="keyword">return</span>
    <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> op<span class="punctuation">)</span>
    <span class="punctuation">{</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>op == <span class="string">"next"</span><span class="punctuation">)</span> <span class="keyword">return</span> next_counter<span class="punctuation">;</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>op == <span class="string">"prev"</span><span class="punctuation">)</span> <span class="keyword">return</span> prev_counter<span class="punctuation">;</span>
      <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
    <span class="punctuation">};</span>
<span class="punctuation">}</span>

<span class="type">int</span> next_counter<span class="punctuation">(</span><span class="type">function</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">int</span><span class="punctuation">))</span> counter<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> counter<span class="punctuation">(</span><span class="string">"next"</span><span class="punctuation">)();</span>
<span class="punctuation">}</span>

<span class="type">int</span> prev_counter<span class="punctuation">(</span><span class="type">function</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">int</span><span class="punctuation">))</span> counter<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">return</span> counter<span class="punctuation">(</span><span class="string">"prev"</span><span class="punctuation">)();</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">function</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">int</span><span class="punctuation">))</span> counter = make_counter<span class="punctuation">(</span><span class="number">42</span><span class="punctuation">);</span>

  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, next_counter<span class="punctuation">(</span>counter<span class="punctuation">));</span>
  write<span class="punctuation">(</span><span class="string">"%d\n"</span>, prev_counter<span class="punctuation">(</span>counter<span class="punctuation">));</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN548"
>Determining Current Function Name</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">It's possible to obtain a great deal of program metadata through the</span>
<span class="comment-delimiter">// </span><span class="comment">following sets of library functions:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* 'this_object', and the sets of 'object_...' and 'program_...'</span>
<span class="comment-delimiter">//   </span><span class="comment">functions</span>
<span class="comment-delimiter">// </span><span class="comment">* 'Program' module [provides object inheritance metadata]</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">The use of, 'this_object', in particular, allows the current object</span>
<span class="comment-delimiter">// </span><span class="comment">instance to be interrogated like a hash table i.e. all variables and</span>
<span class="comment-delimiter">// </span><span class="comment">methods are accessable as hash table entries.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Unfortunately, however, it doesn't appear possible to obtain the</span>
<span class="comment-delimiter">// </span><span class="comment">current method / function name, at least, not without resorting</span>
<span class="comment-delimiter">// </span><span class="comment">to tricks like embedding a string in each method explicitly naming</span>
<span class="comment-delimiter">// </span><span class="comment">it.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">An example of program metadata use appears in chapter 'Objects and</span>
<span class="comment-delimiter">// </span><span class="comment">Ties'. Since the function name cannot, AFAICT, be obtained, the</span>
<span class="comment-delimiter">// </span><span class="comment">current section is not implemented.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN551"
>Passing Arrays and Hashes by Reference</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Procedure parameters are passed by reference [read: the handle or</span>
<span class="comment-delimiter">// </span><span class="comment">address (or whatever) of an object is passed and is used to uniquely</span>
<span class="comment-delimiter">// </span><span class="comment">identify that object], so there is no special treatment required.</span>
<span class="comment-delimiter">// </span><span class="comment">If an argument represents a mutable object then care should be taken</span>
<span class="comment-delimiter">// </span><span class="comment">to not mutate the object within the function, either by making a copy</span>
<span class="comment-delimiter">// </span><span class="comment">of the object [e.g. use 'copy_value' to clone it], or by using a</span>
<span class="comment-delimiter">// </span><span class="comment">'read-only' control structure like 'foreach' [if applicable] to</span>
<span class="comment-delimiter">// </span><span class="comment">access it</span>

<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> array_diff<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> a, <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> b<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Ensure an array copy is made ...</span>
  <span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ret = sizeof<span class="punctuation">(</span>a<span class="punctuation">)</span> != sizeof<span class="punctuation">(</span>b<span class="punctuation">)</span> ? <span class="number">0</span> : copy_value<span class="punctuation">(</span>a<span class="punctuation">);</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>!ret<span class="punctuation">)</span> ret<span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">... transformed, and returned</span>
  <span class="keyword">for</span> <span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i &lt; sizeof<span class="punctuation">(</span>ret<span class="punctuation">);</span> ++i<span class="punctuation">)</span> <span class="punctuation">{</span> ret<span class="punctuation">[</span>i<span class="punctuation">]</span> -= b<span class="punctuation">[</span>i<span class="punctuation">];</span> <span class="punctuation">};</span> <span class="keyword">return</span> ret<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> add_vec_pair<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> a, <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> b<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> vecsize = sizeof<span class="punctuation">(</span>a<span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">Ensure an array copy is made ...</span>
  <span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> ret = vecsize != sizeof<span class="punctuation">(</span>b<span class="punctuation">)</span> ? <span class="number">0</span> : allocate<span class="punctuation">(</span>vecsize<span class="punctuation">);</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>!ret<span class="punctuation">)</span> ret<span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">... transformed, and returned</span>
  <span class="keyword">for</span> <span class="punctuation">(</span><span class="type">int</span> i<span class="punctuation">;</span> i &lt; vecsize<span class="punctuation">;</span> ++i<span class="punctuation">)</span> <span class="punctuation">{</span> ret<span class="punctuation">[</span>i<span class="punctuation">]</span> = a<span class="punctuation">[</span>i<span class="punctuation">]</span> + b<span class="punctuation">[</span>i<span class="punctuation">];</span> <span class="punctuation">};</span> <span class="keyword">return</span> ret<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> a = <span class="punctuation">({</span><span class="number">1</span>, <span class="number">2</span><span class="punctuation">})</span>, b = <span class="punctuation">({</span><span class="number">5</span>, <span class="number">8</span><span class="punctuation">});</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> c = add_vec_pair<span class="punctuation">(</span>a, b<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"%O\n"</span>, c<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN554"
>Detecting Return Context</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Just as for subroutine parameters, Pike allows variation in return</span>
<span class="comment-delimiter">// </span><span class="comment">types, where it may be of a specific type, one of a set of types, or</span>
<span class="comment-delimiter">// </span><span class="comment">a generic return type. Whilst the Perl examples require that the</span>
<span class="comment-delimiter">// </span><span class="comment">user to nominate a return type when the function is called, in Pike</span>
<span class="comment-delimiter">// </span><span class="comment">it is handled in one of two ways:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* Ensure function and receiving variable type match [see (1)]</span>
<span class="comment-delimiter">// </span><span class="comment">* Use generic receiving variable, and type check [see (2)]</span>

<span class="comment-delimiter">// </span><span class="comment">(1). Subroutine has set of return types. Whilst type checking</span>
<span class="comment-delimiter">// </span><span class="comment">does occur [thus user code only need handle these known types</span>
<span class="comment-delimiter">// </span><span class="comment">because other types won't be allowed], caller/ receiver needs to</span>
<span class="comment-delimiter">// </span><span class="comment">type check so as correctly handle known cases</span>
<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>|<span class="type">string</span> mysub<span class="punctuation">()</span>
<span class="punctuation">{</span>
  ...
  <span class="keyword">return</span> <span class="number">5</span><span class="punctuation">;</span>
  ...
  <span class="keyword">return</span> <span class="punctuation">({</span><span class="number">5</span><span class="punctuation">});</span>
  ...
  <span class="keyword">return</span> <span class="string">"5"</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span>|<span class="type">string</span> receiver = mysub<span class="punctuation">();</span>

<span class="keyword">if</span> <span class="punctuation">(</span>intp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
<span class="keyword">if</span> <span class="punctuation">(</span>arrayp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
<span class="keyword">if</span> <span class="punctuation">(</span>stringp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
...

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">(2). Subroutine has generic return type, so no type checking occurs.</span>
<span class="comment-delimiter">// </span><span class="comment">It is up to the caller / receiver to thoroughly type check lest</span>
<span class="comment-delimiter">// </span><span class="comment">some unforseen type be returned and possibly mishandled</span>
<span class="type">mixed</span> mysub<span class="punctuation">()</span>
<span class="punctuation">{</span>
  ...
  <span class="keyword">return</span> <span class="number">5</span><span class="punctuation">;</span>
  ...
  <span class="keyword">return</span> <span class="punctuation">({</span><span class="number">5</span><span class="punctuation">});</span>
  ...
  <span class="keyword">return</span> <span class="string">"5"</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">mixed</span> receiver = mysub<span class="punctuation">();</span>

<span class="keyword">if</span> <span class="punctuation">(</span>intp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
<span class="keyword">if</span> <span class="punctuation">(</span>arrayp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
<span class="keyword">if</span> <span class="punctuation">(</span>stringp<span class="punctuation">(</span>receiver<span class="punctuation">))</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
...
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN557"
>Passing by Named Parameter</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike doesn't directly support named / keyword parameters, but these</span>
<span class="comment-delimiter">// </span><span class="comment">can be easily mimiced using an array of mappings as function arguments</span>
<span class="comment-delimiter">// </span><span class="comment">The mappings, themselves, could be implemented via a custom class</span>
<span class="comment-delimiter">// </span><span class="comment">[see (1)], or via the 'mapping'type [see (2) - Perl examples]</span>

<span class="comment-delimiter">// </span><span class="comment">(1)</span>
<span class="keyword">class</span> <span class="function-name">KeyedValue</span>
<span class="punctuation">{</span>
  <span class="type">string</span> key<span class="punctuation">;</span> <span class="type">mixed</span> value<span class="punctuation">;</span>

  <span class="keyword">static</span> <span class="type">void</span> create<span class="punctuation">(</span><span class="type">string</span> key_, <span class="type">mixed</span> value_<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    key = key_<span class="punctuation">;</span> value = value_<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">void</span> the_func<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span>KeyedValue<span class="punctuation">)</span> keyargs<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="keyword">foreach</span><span class="punctuation">(</span>keyargs, KeyedValue kv<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    write<span class="punctuation">(</span><span class="string">"Key: %10s|Value: %10O\n"</span>, kv-&gt;key, kv-&gt;value<span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span>KeyedValue<span class="punctuation">)</span> keyargs =
    aggregate<span class="punctuation">(</span>KeyedValue<span class="punctuation">(</span><span class="string">"name"</span>, <span class="string">"Bob"</span><span class="punctuation">)</span>,
              KeyedValue<span class="punctuation">(</span><span class="string">"age"</span>, <span class="number">36</span><span class="punctuation">)</span>,
              KeyedValue<span class="punctuation">(</span><span class="string">"income"</span>, <span class="number">51000</span><span class="punctuation">));</span>

  the_func<span class="punctuation">(</span>keyargs<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">(2)</span>
<span class="keyword">class</span> <span class="function-name">RaceTime</span>
<span class="punctuation">{</span>
  <span class="type">int</span> time<span class="punctuation">;</span> <span class="type">string</span> dim<span class="punctuation">;</span>

  <span class="keyword">static</span> <span class="type">void</span> create<span class="punctuation">(</span><span class="type">int</span> time_, <span class="type">string</span> dim_<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    time = time_<span class="punctuation">;</span> dim = dim_<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="type">void</span> the_func<span class="punctuation">(</span><span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : RaceTime<span class="punctuation">)</span> ... args<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> start_time, finish_time, increment_time<span class="punctuation">;</span>
  <span class="type">string</span> start_dim, finish_dim, increment_dim<span class="punctuation">;</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>args, <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : RaceTime<span class="punctuation">)</span> arg<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    arg<span class="punctuation">[</span><span class="string">"start"</span><span class="punctuation">]</span> &amp;&amp; <span class="punctuation">(</span>start_time = arg<span class="punctuation">[</span><span class="string">"start"</span><span class="punctuation">]</span>-&gt;time, start_dim = arg<span class="punctuation">[</span><span class="string">"start"</span><span class="punctuation">]</span>-&gt;dim<span class="punctuation">);</span>
    arg<span class="punctuation">[</span><span class="string">"finish"</span><span class="punctuation">]</span> &amp;&amp; <span class="punctuation">(</span>finish_time = arg<span class="punctuation">[</span><span class="string">"finish"</span><span class="punctuation">]</span>-&gt;time, finish_dim = arg<span class="punctuation">[</span><span class="string">"finish"</span><span class="punctuation">]</span>-&gt;dim<span class="punctuation">);</span>
    arg<span class="punctuation">[</span><span class="string">"increment"</span><span class="punctuation">]</span> &amp;&amp; <span class="punctuation">(</span>increment_time = arg<span class="punctuation">[</span><span class="string">"increment"</span><span class="punctuation">]</span>-&gt;time, increment_dim = arg<span class="punctuation">[</span><span class="string">"increment"</span><span class="punctuation">]</span>-&gt;dim<span class="punctuation">);</span>
  <span class="punctuation">}</span>

  write<span class="punctuation">(</span><span class="string">"times: start %d, finish %d, increment %d\n"</span>,
        start_time, finish_time, increment_time<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : RaceTime<span class="punctuation">))</span> named_args =
    <span class="punctuation">({</span>
      <span class="punctuation">([</span><span class="string">"increment"</span> : RaceTime<span class="punctuation">(</span><span class="number">20</span>, <span class="string">"s"</span><span class="punctuation">)])</span>,
      <span class="punctuation">([</span><span class="string">"start"</span> : RaceTime<span class="punctuation">(</span><span class="number">5</span>, <span class="string">"m"</span><span class="punctuation">)])</span>,
      <span class="punctuation">([</span><span class="string">"finish"</span> : RaceTime<span class="punctuation">(</span><span class="number">3</span>, <span class="string">"m"</span><span class="punctuation">)])</span> <span class="punctuation">});</span>

  <span class="comment-delimiter">// </span><span class="comment">Package arguments as array for passing to function</span>
  the_func<span class="punctuation">(</span>@named_args<span class="punctuation">);</span>

  named_args =
    <span class="punctuation">({</span>
      <span class="punctuation">([</span><span class="string">"start"</span> : RaceTime<span class="punctuation">(</span><span class="number">5</span>, <span class="string">"m"</span><span class="punctuation">)])</span>,
      <span class="punctuation">([</span><span class="string">"finish"</span> : RaceTime<span class="punctuation">(</span><span class="number">30</span>, <span class="string">"m"</span><span class="punctuation">)])</span> <span class="punctuation">});</span>

  <span class="comment-delimiter">// </span><span class="comment">Ditto</span>
  the_func<span class="punctuation">(</span>@named_args<span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">Pass argument(s) directly in argument list</span>
  the_func<span class="punctuation">(([</span><span class="string">"finish"</span> : RaceTime<span class="punctuation">(</span><span class="number">30</span>, <span class="string">"m"</span><span class="punctuation">)]));</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN560"
>Skipping Selected Return Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">It is languages that support pattern matching, such as Prolog, Oz and</span>
<span class="comment-delimiter">// </span><span class="comment">SML, that tend to offer such facilities. These languages all offer</span>
<span class="comment-delimiter">// </span><span class="comment">a 'match all and throw away' operator that can be used in place of </span>
<span class="comment-delimiter">// </span><span class="comment">an identifier name(s), and have the resultant value(s) be discarded.</span>
<span class="comment-delimiter">// </span><span class="comment">Such a facility helps keep code uncluttered because only values</span>
<span class="comment-delimiter">// </span><span class="comment">that are required need to be named.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Pike does not implement pattern matching, so does not sport such an</span>
<span class="comment-delimiter">// </span><span class="comment">operator, nor any equivalent facility. Thus, none of the examples in</span>
<span class="comment-delimiter">// </span><span class="comment">this section are directly implementable.</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN563"
>Returning More Than One Array or Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike supports the return of a single value from a function. Where</span>
<span class="comment-delimiter">// </span><span class="comment">multiple values need to be returned, they can be packaged as an</span>
<span class="comment-delimiter">// </span><span class="comment">aggregate such as an array or mapping, and *that* item returned.</span>
<span class="comment-delimiter">// </span><span class="comment">The caller / receiver would, of course, be responsible for</span>
<span class="comment-delimiter">// </span><span class="comment">appropriately extracting required elements from that returned item</span>
<span class="comment-delimiter">// </span><span class="comment">(this process could be hardcoded, or generalised using extensive</span>
<span class="comment-delimiter">// </span><span class="comment">runtime type checking). Alternatively, a custom class encapsulating</span>
<span class="comment-delimiter">// </span><span class="comment">the return values can be used and an instance of that item returned</span>
<span class="comment-delimiter">// </span><span class="comment">and processed</span>
<span class="comment-delimiter">//</span><span class="comment"></span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> somefunc<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr = <span class="punctuation">({</span><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span><span class="punctuation">});</span>
  <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">int</span><span class="punctuation">)</span> hash = <span class="punctuation">([</span><span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">3</span><span class="punctuation">]);</span>

  <span class="comment-delimiter">// </span><span class="comment">Return an array containing an array and a hash</span>
  <span class="keyword">return</span> aggregate<span class="punctuation">(</span>arr, hash<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Get return array</span>
<span class="type">array</span><span class="punctuation">(</span><span class="type">mixed</span><span class="punctuation">)</span> arr = somefunc<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">Extract and process elements</span>
<span class="keyword">foreach</span><span class="punctuation">(</span>arr, <span class="type">mixed</span> item<span class="punctuation">)</span>
<span class="punctuation">{</span>
  write<span class="punctuation">(</span><span class="string">"Return item has type: %t, value: %O\n"</span>, item, item<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="keyword">class</span> <span class="function-name">RetValues</span>
<span class="punctuation">{</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">int</span><span class="punctuation">)</span> arr<span class="punctuation">;</span> <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span> : <span class="type">int</span><span class="punctuation">)</span> hash<span class="punctuation">;</span>

  <span class="keyword">static</span> <span class="type">void</span> create<span class="punctuation">()</span>
  <span class="punctuation">{</span>
    arr = aggregate<span class="punctuation">(</span><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span><span class="punctuation">);</span>
    hash = aggregate_mapping<span class="punctuation">(</span><span class="string">"x"</span>, <span class="number">1</span>, <span class="string">"y"</span>, <span class="number">2</span>, <span class="string">"z"</span>, <span class="number">3</span><span class="punctuation">);</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
  
RetValues somefunc<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> RetValues<span class="punctuation">();</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

RetValues rv = RetValues<span class="punctuation">();</span>

write<span class="punctuation">(</span><span class="string">"Return item has type: %t, value: %O\n"</span>, rv-&gt;arr, rv-&gt;arr<span class="punctuation">);</span>
write<span class="punctuation">(</span><span class="string">"Return item has type: %t, value: %O\n"</span>, rv-&gt;hash, rv-&gt;hash<span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN566"
>Returning Failure</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Pike offers a very simple, consistent means of 'returning failure':</span>
<span class="comment-delimiter">// </span><span class="comment">return 0 [representing 'false'] when a task does not succeed, otherwise</span>
<span class="comment-delimiter">// </span><span class="comment">return whatever was the expected value. This design is extensively</span>
<span class="comment-delimiter">// </span><span class="comment">used in the Pike library, and is well supported by the language in</span>
<span class="comment-delimiter">// </span><span class="comment">that:</span>
<span class="comment-delimiter">// </span><span class="comment">* Alternate return types may be specified</span>
<span class="comment-delimiter">// </span><span class="comment">* A 'mixed' return type, indicating possible return of any type</span>
<span class="comment-delimiter">//   </span><span class="comment">value, may be used</span>

<span class="type">void</span> die<span class="punctuation">(</span><span class="type">string</span> msg, <span class="type">void</span>|<span class="type">int</span><span class="punctuation">(</span><span class="number">1</span>..<span class="number">256</span><span class="punctuation">)</span> rc<span class="punctuation">)</span> <span class="punctuation">{</span> werror<span class="punctuation">(</span>msg + NEWLINE<span class="punctuation">);</span> exit<span class="punctuation">(</span>rc ? rc : PROBLEM<span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> afunc<span class="punctuation">()</span>
<span class="punctuation">{</span>
  ...

  <span class="keyword">if</span> <span class="punctuation">(</span>ok<span class="punctuation">)</span>
    <span class="comment-delimiter">// </span><span class="comment">... return an array ...</span>
  <span class="keyword">else</span>
    <span class="comment-delimiter">// </span><span class="comment">failure, so return 0</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="type">int</span>|<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> arr = afunc<span class="punctuation">();</span>

  <span class="keyword">if</span> <span class="punctuation">(</span>!arr<span class="punctuation">)</span> die<span class="punctuation">(</span><span class="string">"Error with 'afunc' ..."</span><span class="punctuation">);</span>

  <span class="comment-delimiter">// </span><span class="comment">ok, so use 'arr' ...</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN569"
>Prototyping Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Whether Pike is seen to support prototyping depends on the definition</span>
<span class="comment-delimiter">// </span><span class="comment">of this term used:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* Prototyping along the lines used in Ada, Modula X, and even C / C++,</span>
<span class="comment-delimiter">//   </span><span class="comment">in which a procedure's interface is declared separately from its</span>
<span class="comment-delimiter">//   </span><span class="comment">implementation, is *not* supported</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* Prototyping in which, as part of the procedure definition, parameter</span>
<span class="comment-delimiter">//   </span><span class="comment">information must be supplied. This is a requirement in Pike in that</span>
<span class="comment-delimiter">//   </span><span class="comment">parameter number, names and type, must be given. Return types must</span>
<span class="comment-delimiter">//   </span><span class="comment">also be specified, but there is an exeption when using lambdas</span>

<span class="type">void</span> func_with_no_arg<span class="punctuation">()</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>

<span class="type">void</span> func_with_one_arg<span class="punctuation">(</span><span class="type">int</span> arg1<span class="punctuation">)</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>

<span class="type">void</span> func_with_two_arg<span class="punctuation">(</span><span class="type">int</span> arg1, <span class="type">string</span> arg2<span class="punctuation">)</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>

<span class="type">void</span> func_with_three_arg<span class="punctuation">(</span><span class="type">int</span> arg1, <span class="type">string</span> arg2, <span class="type">float</span> arg3<span class="punctuation">)</span> <span class="punctuation">{</span> ...<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Return type, 'void', specified </span>
<span class="type">function</span> f = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">int</span> arg1 : <span class="type">void</span><span class="punctuation">)</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">Return type not specified, defaults to 'mixed'</span>
<span class="type">function</span> g = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">int</span> arg1<span class="punctuation">)</span> <span class="punctuation">{</span> ... <span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN572"
>Handling Exceptions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Like so many modern languages, Pike implements exception handling</span>
<span class="comment-delimiter">// </span><span class="comment">using the 'catch' and 'throw' keywords </span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Not exactly like the Perl example, but a way of immediately exiting</span>
<span class="comment-delimiter">// </span><span class="comment">from an application [note: using, 'exit', prevents any of the 'atexit'</span>
<span class="comment-delimiter">// </span><span class="comment">call backs from executing, so application cleanup may be compromised]</span>

<span class="type">void</span> die<span class="punctuation">(</span><span class="type">string</span> msg, <span class="type">void</span>|<span class="type">int</span><span class="punctuation">(</span><span class="number">1</span>..<span class="number">256</span><span class="punctuation">)</span> rc<span class="punctuation">)</span> <span class="punctuation">{</span> werror<span class="punctuation">(</span>msg + NEWLINE<span class="punctuation">);</span> exit<span class="punctuation">(</span>rc ? rc : PROBLEM<span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

die<span class="punctuation">(</span><span class="string">"some message"</span><span class="punctuation">);</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">int</span><span class="punctuation">(</span><span class="number">0</span>..<span class="number">1</span><span class="punctuation">)</span> rmAll<span class="punctuation">(</span><span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> filelist<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">'result' will be 0 if the 'catch' block succeeds</span>
  <span class="type">mixed</span> result = <span class="keyword">catch</span>
  <span class="punctuation">{</span>
    <span class="keyword">foreach</span><span class="punctuation">(</span>filelist, <span class="type">string</span> filename<span class="punctuation">)</span> <span class="punctuation">{</span> rm<span class="punctuation">(</span>filename<span class="punctuation">)</span> || <span class="keyword">throw</span><span class="punctuation">(</span>PROBLEM<span class="punctuation">);</span> <span class="punctuation">}</span>
  <span class="punctuation">};</span>

  <span class="comment-delimiter">// </span><span class="comment">Return value of 'catch' block can be tested, and appropriate</span>
  <span class="comment-delimiter">// </span><span class="comment">action taken; here, a non-zero return code will be returned</span>
  <span class="comment-delimiter">// </span><span class="comment">[like many library functions] to indicate failure</span>
  <span class="keyword">return</span> result == OK<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Attempt to remove the following files ...</span>

<span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> files = <span class="punctuation">({</span><span class="string">"..."</span>, <span class="string">"..."</span>, <span class="string">"..."</span><span class="punctuation">});</span>

rmAll<span class="punctuation">(</span>files<span class="punctuation">)</span> || die<span class="punctuation">(</span><span class="string">"Could not remove all files - exiting"</span><span class="punctuation">);</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN575"
>Saving Global Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Global variable</span>
<span class="type">int</span> age = <span class="number">18</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">void</span> print_age<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Global value, 'age', is accessed</span>
  write<span class="punctuation">(</span><span class="string">"Age is %d\n"</span>, age<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">A local variable named, 'age' will act to 'shadow' the globally</span>
  <span class="comment-delimiter">// </span><span class="comment">defined version, thus any changes to, 'age', will not affect</span>
  <span class="comment-delimiter">// </span><span class="comment">the global version</span>
  <span class="type">int</span> age = <span class="number">5</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 18, the current value of the global version</span>
  print_age<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">Local version is altered, *not* global version</span>
  age = <span class="number">23</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 18, the current value of the global version</span>
  print_age<span class="punctuation">();</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Global variable</span>
<span class="type">int</span> age = <span class="number">18</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">void</span> print_age<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Global value, 'age', is accessed</span>
  write<span class="punctuation">(</span><span class="string">"Age is %d\n"</span>, age<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Here no local version declared: any changes affect global version</span>
  age = <span class="number">5</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 5, the new value of the global version</span>
  print_age<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">Global version again altered</span>
  age = <span class="number">23</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 23, the new value of the global version</span>
  print_age<span class="punctuation">();</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">Global variable</span>
<span class="type">int</span> age = <span class="number">18</span><span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="type">void</span> print_age<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Global value, 'age', is accessed</span>
  write<span class="punctuation">(</span><span class="string">"Age is %d\n"</span>, age<span class="punctuation">);</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> main<span class="punctuation">()</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Global version value saved into local version</span>
  <span class="type">int</span> age = <span class="keyword">global</span>::age<span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 18, the new value of the global version</span>
  print_age<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">Global version this time altered</span>
  <span class="keyword">global</span>::age = <span class="number">23</span><span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 23, the new value of the global version</span>
  print_age<span class="punctuation">();</span>

  <span class="comment-delimiter">// </span><span class="comment">Global version value restored from saved local version</span>
  <span class="keyword">global</span>::age = age<span class="punctuation">;</span>

  <span class="comment-delimiter">// </span><span class="comment">Prints 18, the restored value of the global version</span>
  print_age<span class="punctuation">();</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN578"
>Redefining a Function</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Define functions - will be considered constant / unchangeable</span>
<span class="type">void</span> grow<span class="punctuation">()</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"grow\n"</span><span class="punctuation">);</span> <span class="punctuation">}</span>
<span class="type">void</span> shrink<span class="punctuation">()</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"shrink\n"</span><span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Execute functions: 'grow', 'shrink' output respectively</span>
grow<span class="punctuation">();</span> shrink<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">Attempt to redefine, 'grow' fails because it is considered a</span>
<span class="comment-delimiter">// </span><span class="comment">constant value:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//   </span><span class="comment">grow = shrink;</span>
<span class="comment-delimiter">//</span><span class="comment"></span>

<span class="comment-delimiter">// </span><span class="comment">However, it is possible to bind 'shrink' to a new local variable</span>
<span class="comment-delimiter">// </span><span class="comment">called, 'grow'</span>
<span class="type">function</span> grow = shrink<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">Execute functions: 'shrink', 'shrink' output respectively because</span>
<span class="comment-delimiter">// </span><span class="comment">local 'grow' shadows global version, and it is referencing the</span>
<span class="comment-delimiter">// </span><span class="comment">code for 'shrink'</span>
grow<span class="punctuation">();</span> shrink<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Define functions by assigning lambdas to global variables</span>
<span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">void</span><span class="punctuation">)</span> grow = <span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"grow\n"</span><span class="punctuation">);</span> <span class="punctuation">}</span>
<span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">void</span><span class="punctuation">)</span> shrink = <span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> write<span class="punctuation">(</span><span class="string">"shrink\n"</span><span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

<span class="comment-delimiter">// </span><span class="comment">Execute functions: 'grow', 'shrink' output respectively</span>
grow<span class="punctuation">();</span> shrink<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">Attempt to redefine, 'grow' successful since a simple variable</span>
<span class="comment-delimiter">// </span><span class="comment">assignment is being performed</span>
grow = shrink<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">Execute functions: 'shrink', 'shrink' output respectively - 'grow'</span>
<span class="comment-delimiter">// </span><span class="comment">has, effectively, been 'redefined' [note: reference to original</span>
<span class="comment-delimiter">// </span><span class="comment">'grow' code has been lost (but it could have been saved, then</span>
<span class="comment-delimiter">// </span><span class="comment">restored)]</span>
grow<span class="punctuation">();</span> shrink<span class="punctuation">();</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">function</span> barney = <span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> ... <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">...</span>

<span class="comment-delimiter">// </span><span class="comment">'fred' is now an alias for the code attached to 'barney'</span>
<span class="type">function</span> fred = barney<span class="punctuation">;</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">function</span> red = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> text<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="string">"&lt;FONT COLOR='red'&gt;"</span> + text + <span class="string">"&lt;/FONT&gt;"</span><span class="punctuation">;</span>
  <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

write<span class="punctuation">(</span><span class="string">"%s\n"</span>, red<span class="punctuation">(</span><span class="string">"careful here"</span><span class="punctuation">));</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">function</span> colour_font = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> colour, <span class="type">string</span> text<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="string">"&lt;FONT COLOR='"</span> + colour + <span class="string">"'&gt;"</span> + text + <span class="string">"&lt;/FONT&gt;"</span><span class="punctuation">;</span>
  <span class="punctuation">};</span>

<span class="type">function</span> red = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> text<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> colour_font<span class="punctuation">(</span><span class="string">"red"</span>, text<span class="punctuation">);</span> <span class="punctuation">};</span>
<span class="type">function</span> green = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">string</span> text<span class="punctuation">)</span> <span class="punctuation">{</span> <span class="keyword">return</span> colour_font<span class="punctuation">(</span><span class="string">"green"</span>, text<span class="punctuation">);</span> <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">... more 'colour' functions ...</span>

<span class="comment-delimiter">// </span><span class="comment">----</span>

write<span class="punctuation">(</span><span class="string">"%s\n"</span>, red<span class="punctuation">(</span><span class="string">"careful here"</span><span class="punctuation">));</span>
write<span class="punctuation">(</span><span class="string">"%s\n"</span>, green<span class="punctuation">(</span><span class="string">"careful there"</span><span class="punctuation">));</span>
<span class="comment-delimiter">// </span><span class="comment">... </span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="comment-delimiter">// </span><span class="comment">Pike offers the 'compile' family of functions that allow for the</span>
<span class="comment-delimiter">// </span><span class="comment">runtime compilation and [in combinaton with other Pike functions]</span>
<span class="comment-delimiter">// </span><span class="comment">the subsequent execution, of Pike code, obtained either as a</span>
<span class="comment-delimiter">// </span><span class="comment">dynamically-generated string, or loaded from file / URL. This,</span>
<span class="comment-delimiter">// </span><span class="comment">AFAICT, is the Pike feature closest to that of the 'eval' function</span>
<span class="comment-delimiter">// </span><span class="comment">found in languages like Scheme. The example here is rather</span>
<span class="comment-delimiter">// </span><span class="comment">contrived and unwieldly, but it does show how code is generated,</span>
<span class="comment-delimiter">// </span><span class="comment">compiled, and executed, and it *does* closely follow the Perl code</span>
<span class="comment-delimiter">//</span><span class="comment"></span>

<span class="comment-delimiter">// </span><span class="comment">Assemble text needed to build function</span>
<span class="type">string</span> build_colour_func<span class="punctuation">(</span><span class="type">string</span> colour<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">Could also use library function, 'sprintf', to build string</span>
  <span class="type">string</span> bodytext = <span class="string">"\"&lt;FONT COLOR='"</span> + colour + <span class="string">"'&gt;\" + text + \"&lt;/FONT&gt;\""</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="string">"string "</span> + colour + <span class="string">"(string text) { return "</span> + bodytext + <span class="string">"; };"</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="type">int</span> main<span class="punctuation">(</span><span class="type">int</span> argc, <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> argv<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="comment-delimiter">// </span><span class="comment">1. Generate source code. A function is built for each colour by</span>
  <span class="comment-delimiter">//    </span><span class="comment">calling, 'build_colour_func', and all the text collected into</span>
  <span class="comment-delimiter">//    </span><span class="comment">'cf_text'</span>
  <span class="type">array</span><span class="punctuation">(</span><span class="type">string</span><span class="punctuation">)</span> colours =
    <span class="punctuation">({</span><span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>, <span class="string">"yellow"</span>, <span class="string">"orange"</span>, <span class="string">"purple"</span>, <span class="string">"violet"</span><span class="punctuation">});</span>

  <span class="type">string</span> cf_text = <span class="string">""</span><span class="punctuation">;</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>colours, <span class="type">string</span> colour<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    cf_text += build_colour_func<span class="punctuation">(</span>colour<span class="punctuation">);</span>
  <span class="punctuation">}</span>

  <span class="comment-delimiter">// </span><span class="comment">2. Compile generated source code, and make it accessable to the</span>
  <span class="comment-delimiter">//    </span><span class="comment">current program. These two steps are, here, combined for brevity,</span>
  <span class="comment-delimiter">//    </span><span class="comment">but consist of the following:</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">//        </span><span class="comment">program prog = compile_string(cf_text);</span>
  <span class="comment-delimiter">//        </span><span class="comment">object cf_code = prog();</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">//    </span><span class="comment">The latter step sees the code's 'create' method called for</span>
  <span class="comment-delimiter">//    </span><span class="comment">initialisation, and also makes items accessable via:</span>
  <span class="comment-delimiter">//</span><span class="comment"></span>
  <span class="comment-delimiter">//        </span><span class="comment">cf_code[ITEMNAME]</span>
  <span class="comment-delimiter">//  </span><span class="comment"></span>
  <span class="comment-delimiter">//    </span><span class="comment">For example, the function, 'red', may be:</span>
  <span class="comment-delimiter">//        </span><span class="comment">referenced -&gt; cf_code["red"]</span>
  <span class="comment-delimiter">//        </span><span class="comment">applied    -&gt; cf_code["red"](" ... ")</span>
  <span class="comment-delimiter">//  </span><span class="comment"></span>
  <span class="type">object</span> cf_code = compile_string<span class="punctuation">(</span>cf_text<span class="punctuation">)();</span>

  <span class="comment-delimiter">// </span><span class="comment">3. Apply the generated functions</span>
  <span class="type">mapping</span><span class="punctuation">(</span><span class="type">string</span>:<span class="type">string</span><span class="punctuation">)</span> colours_and_text = 
    <span class="punctuation">([</span><span class="string">"red"</span>:<span class="string">"baron"</span>, <span class="string">"blue"</span>:<span class="string">"zephyr"</span>, <span class="string">"green"</span>:<span class="string">"beret"</span>,
      <span class="string">"yellow"</span>:<span class="string">"ribbon"</span>, <span class="string">"orange"</span>:<span class="string">"county"</span>, <span class="string">"purple"</span>:<span class="string">"haze"</span>,
      <span class="string">"violet"</span>:<span class="string">"temper"</span><span class="punctuation">]);</span>

  <span class="keyword">foreach</span><span class="punctuation">(</span>indices<span class="punctuation">(</span>colours_and_text<span class="punctuation">)</span>, <span class="type">string</span> colour<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="comment-delimiter">// </span><span class="comment">Get relevant function</span>
    <span class="type">function</span> colour_func = cf_code<span class="punctuation">[</span>colour<span class="punctuation">];</span>

    <span class="comment-delimiter">// </span><span class="comment">Apply function with relevant argument(s)</span>
    write<span class="punctuation">(</span><span class="string">"%s\n"</span>, colour_func<span class="punctuation">(</span>colours_and_text<span class="punctuation">[</span>colour<span class="punctuation">]));</span>

    <span class="comment-delimiter">// </span><span class="comment">Or, above lines can be replaced with:</span>
    <span class="comment-delimiter">//     </span><span class="comment">write("%s\n", cf_code[colour](colours_and_text[colour]));</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>    
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN581"
>Trapping Undefined Function Calls with AUTOLOAD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">@@INCOMPLETE@@</span>

<span class="comment-delimiter">// </span><span class="comment">in your class</span>

  <span class="type">mapping</span> functions = <span class="punctuation">([]);</span>
  <span class="type">function</span> `-&gt;<span class="punctuation">(</span><span class="type">string</span> fun<span class="punctuation">)</span> 
  <span class="punctuation">{</span>
    <span class="keyword">if</span><span class="punctuation">(</span>!functions-&gt;fun<span class="punctuation">)</span>
      functions<span class="punctuation">[</span>fun<span class="punctuation">]</span>=<span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">mixed</span>|<span class="type">void</span> ... args<span class="punctuation">)</span>
                     <span class="punctuation">{</span> 
                       <span class="keyword">return</span> sprintf<span class="punctuation">(</span><span class="string">"&lt;FONT COLOR=%s&gt;%{%s %}&lt;/FONT&gt;"</span>, fun, args<span class="punctuation">);</span> 
                     <span class="punctuation">};</span>
    <span class="keyword">return</span> functions<span class="punctuation">[</span>fun<span class="punctuation">];</span>
  <span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">then outside</span>
write<span class="punctuation">(</span>object_of_your_class-&gt;chartreuse<span class="punctuation">(</span><span class="string">"stuff"</span><span class="punctuation">));</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN584"
>Nesting Subroutines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">Alternate, though identically-behaving, nested subroutine definitions</span>

<span class="type">int</span> outer<span class="punctuation">(</span><span class="type">int</span> arg<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> x = arg + <span class="number">35</span><span class="punctuation">;</span>
  <span class="type">int</span> inner<span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> x * <span class="number">19</span><span class="punctuation">;</span> <span class="punctuation">};</span>
  <span class="keyword">return</span> x + inner<span class="punctuation">();</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">int</span> outer<span class="punctuation">(</span><span class="type">int</span> arg<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> x = arg + <span class="number">35</span><span class="punctuation">;</span>
  <span class="type">function</span><span class="punctuation">(</span><span class="type">void</span> : <span class="type">int</span><span class="punctuation">)</span> inner = <span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> x * <span class="number">19</span><span class="punctuation">;</span> <span class="punctuation">};</span>
  <span class="keyword">return</span> x + inner<span class="punctuation">();</span>
<span class="punctuation">}</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">function</span> outer = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">int</span> arg<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">int</span> x = arg + <span class="number">35</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> x * <span class="number">19</span><span class="punctuation">;</span> <span class="punctuation">})()</span> + x<span class="punctuation">;</span>
  <span class="punctuation">};</span>

<span class="comment-delimiter">// </span><span class="comment">------------</span>

<span class="type">function</span><span class="punctuation">(</span><span class="type">int</span> : <span class="type">int</span><span class="punctuation">)</span> outer = <span class="keyword">lambda</span><span class="punctuation">(</span><span class="type">int</span> arg<span class="punctuation">)</span>
  <span class="punctuation">{</span>
    <span class="type">int</span> x = arg + <span class="number">35</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="keyword">lambda</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="keyword">return</span> x * <span class="number">19</span><span class="punctuation">;</span> <span class="punctuation">})()</span> + x<span class="punctuation">;</span>
  <span class="punctuation">};</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN587"
>Program: Sorting Your Mail</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>@@INCOMPLETE@@
@@INCOMPLETE@@

</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="directories.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Directories</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>References and Records</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>referencesandrecords.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>References and Records</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Subroutines"
HREF="subroutines.html"><LINK
REL="NEXT"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REFERENCESANDRECORDS"
>11. References and Records</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN592"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN595"
>Taking References to Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN598"
>Making Hashes of Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN601"
>Taking References to Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN604"
>Taking References to Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN607"
>Taking References to Scalars</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN610"
>Creating Arrays of Scalar References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN613"
>Using Closures Instead of Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN616"
>Creating References to Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN619"
>Constructing Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN622"
>Reading and Writing Hash Records to Text Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN625"
>Printing Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN628"
>Copying Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN631"
>Storing Data Structures to Disk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN634"
>Transparently Persistent Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN637"
>Program: Binary Trees</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Subroutines</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages, Libraries, and Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>packagesetc.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>classesetc.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Classes, Objects, and Ties</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><LINK
REL="NEXT"
TITLE="Database Access"
HREF="dbaccess.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CLASSESETC"
>13. Classes, Objects, and Ties</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN704"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN707"
>Constructing an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN710"
>Destroying an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN713"
>Managing Instance Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN716"
>Managing Class Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN719"
>Using Classes as Structs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN722"
>Cloning Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN725"
>Calling Methods Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN728"
>Determining Subclass Membership</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN731"
>Writing an Inheritable Class</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN734"
>Accessing Overridden Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN737"
>Generating Attribute Methods Using AUTOLOAD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN740"
>Solving the Data Inheritance Problem</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN743"
>Coping with Circular Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN746"
>Overloading Operators</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN749"
>Creating Magic Variables with tie</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Packages, Libraries, and Modules</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Database Access</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>dbaccess.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Database Access</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><LINK
REL="NEXT"
TITLE="User Interfaces"
HREF="userinterfaces.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="userinterfaces.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DBACCESS"
>14. Database Access</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN754"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN757"
>Making and Using a DBM File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN760"
>Emptying a DBM File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN763"
>Converting Between DBM Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN766"
>Merging DBM Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN769"
>Locking DBM Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN772"
>Sorting Large DBM Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN775"
>Treating a Text File as a Database Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN778"
>Storing Complex Data in a DBM File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN781"
>Persistent Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN784"
>Executing an SQL Command Using DBI and DBD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN787"
>Program: ggh - Grep Netscape Global History</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="userinterfaces.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Classes, Objects, and Ties</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>User Interfaces</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>userinterfaces.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>User Interfaces</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Database Access"
HREF="dbaccess.html"><LINK
REL="NEXT"
TITLE="Process Management and Communication"
HREF="processmanagementetc.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dbaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="processmanagementetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="USERINTERFACES"
>15. User Interfaces</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN792"
>Parsing Program Arguments</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN795"
>Testing Whether a Program Is Running Interactively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN798"
>Clearing the Screen</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN801"
>Determining Terminal or Window Size</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN804"
>Changing Text Color</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN807"
>Reading from the Keyboard</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN810"
>Ringing the Terminal Bell</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN813"
>Using POSIX termios</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN816"
>Checking for Waiting Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN819"
>Reading Passwords</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN822"
>Editing Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN825"
>Managing the Screen</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN828"
>Controlling Another Program with Expect</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN831"
>Creating Menus with Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN834"
>Creating Dialog Boxes with Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN837"
>Responding to Tk Resize Events</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN840"
>Removing the DOS Shell Window with Windows Perl/Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN843"
>Program: Small termcap program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN846"
>Program: tkshufflepod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dbaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="processmanagementetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Database Access</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Process Management and Communication</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>processmanagementetc.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Process Management and Communication</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="User Interfaces"
HREF="userinterfaces.html"><LINK
REL="NEXT"
TITLE="Sockets"
HREF="sockets.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="userinterfaces.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sockets.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PROCESSMANAGEMENTETC"
>16. Process Management and Communication</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN851"
>Gathering Output from a Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN854"
>Running Another Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN857"
>Replacing the Current Program with a Different One</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN860"
>Reading or Writing to Another Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN863"
>Filtering Your Own Output</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN866"
>Preprocessing Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN869"
>Reading STDERR from a Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN872"
>Controlling Input and Output of Another Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN875"
>Controlling the Input, Output, and Error of Another Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN878"
>Communicating Between Related Processes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN881"
>Making a Process Look Like a File with Named Pipes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN884"
>Sharing Variables in Different Processes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN887"
>Listing Available Signals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN890"
>Sending a Signal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN893"
>Installing a Signal Handler</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN896"
>Temporarily Overriding a Signal Handler</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN899"
>Writing a Signal Handler</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN902"
>Catching Ctrl-C</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN905"
>Avoiding Zombie Processes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN908"
>Blocking Signals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN911"
>Timing Out an Operation</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN914"
>Program: sigrand</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="userinterfaces.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sockets.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>User Interfaces</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Sockets</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>sockets.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Sockets</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Process Management and Communication"
HREF="processmanagementetc.html"><LINK
REL="NEXT"
TITLE="Internet Services"
HREF="internetservices.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="processmanagementetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="internetservices.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SOCKETS"
>17. Sockets</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN919"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>

<span class="comment-delimiter">//</span><span class="comment">Pike doesn't normally use packed IP addresses. Strings such as "204.148.40.9" are used literally.</span>

<span class="comment-delimiter">// </span><span class="comment">-----------------------------</span>

<span class="comment-delimiter">// </span><span class="comment">DNS lookups can be done with gethostbyname() and gethostbyaddr()</span>
<span class="punctuation">[</span><span class="type">string</span> host,<span class="type">array</span> ip,<span class="type">array</span> alias<span class="punctuation">]</span> = gethostbyname<span class="punctuation">(</span><span class="string">"www.example.com"</span><span class="punctuation">);</span>
<span class="comment-delimiter">// </span><span class="comment">ip[0] is a string "192.0.32.10"</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN922"
>Writing a TCP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="constant">Stdio</span>.File sock=<span class="constant">Stdio</span>.File<span class="punctuation">();</span>
<span class="keyword">if</span> <span class="punctuation">(</span>!sock-&gt;connect<span class="punctuation">(</span>remote_host,remote_port<span class="punctuation">))</span> <span class="comment-delimiter">//</span><span class="comment">Connection failed. Error code is in sock-&gt;errno() .</span>
<span class="punctuation">{</span>
    werror<span class="punctuation">(</span><span class="string">"Couldn't connect to %s:%d: %s\n"</span>,remote_host,remote_port,strerror<span class="punctuation">(</span>sock-&gt;errno<span class="punctuation">()));</span>
    <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
sock-&gt;write<span class="punctuation">(</span><span class="string">"Hello, world!"</span><span class="punctuation">);</span> <span class="comment-delimiter">//</span><span class="comment">Send something to the socket</span>
<span class="type">string</span> answer=sock-&gt;read<span class="punctuation">();</span> <span class="comment-delimiter">//</span><span class="comment">Read until the remote side disconnects. Use sock-&gt;read(1024,1) to read only some (up to 1KB here).</span>
sock-&gt;close<span class="punctuation">();</span> <span class="comment-delimiter">//</span><span class="comment">Not necessary if the sock object goes out of scope here.</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN925"
>Writing a TCP Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="constant">Stdio</span>.Port mainsock=<span class="constant">Stdio</span>.Port<span class="punctuation">();</span>
<span class="keyword">if</span> <span class="punctuation">(</span>!mainsock-&gt;bind<span class="punctuation">(</span>server_port<span class="punctuation">))</span>
<span class="punctuation">{</span>
    werror<span class="punctuation">(</span><span class="string">"Couldn't be a tcp server on port %d: %s\n"</span>,server_port,strerror<span class="punctuation">(</span>mainsock-&gt;errno<span class="punctuation">()));</span>
    <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="keyword">while</span> <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
    <span class="constant">Stdio</span>.File sock=mainsock-&gt;accept<span class="punctuation">();</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>!sock<span class="punctuation">)</span> <span class="keyword">break</span><span class="punctuation">;</span>
    <span class="comment-delimiter">// </span><span class="comment">sock is the new connection</span>
    <span class="comment-delimiter">// </span><span class="comment">if you don't do anything and just let sock expire, the client connection will be closed</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN928"
>Communicating over TCP</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
sock-&gt;write<span class="punctuation">(</span><span class="string">"What is your name?\n"</span><span class="punctuation">);</span>
<span class="type">string</span> response=sock-&gt;read<span class="punctuation">(</span><span class="number">1024</span>,<span class="number">1</span><span class="punctuation">);</span> <span class="comment-delimiter">//</span><span class="comment">Reads up to 1KB or whatever is available (minimum 1 byte).</span>
<span class="comment-delimiter">//</span><span class="comment">Buffered reads:</span>
<span class="constant">Stdio</span>.FILE sock2=<span class="constant">Stdio</span>.FILE<span class="punctuation">();</span> sock2-&gt;assign<span class="punctuation">(</span>sock<span class="punctuation">);</span>
<span class="type">string</span> response=sock2-&gt;gets<span class="punctuation">();</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>

<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN931"
>Setting Up a UDP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN934"
>Setting Up a UDP Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN937"
>Using UNIX Domain Sockets</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN940"
>Identifying the Other End of a Socket</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="type">string</span> other_end=sock-&gt;query_address<span class="punctuation">();</span> <span class="comment-delimiter">//</span><span class="comment">eg "10.1.1.1 123"</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN943"
>Finding Your Own Name and Address</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN946"
>Closing a Socket After Forking</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
sock-&gt;close<span class="punctuation">(</span><span class="string">"r"</span><span class="punctuation">);</span>   <span class="comment-delimiter">//</span><span class="comment">Close the read direction</span>
sock-&gt;close<span class="punctuation">(</span><span class="string">"w"</span><span class="punctuation">);</span>   <span class="comment-delimiter">//</span><span class="comment">Close the write direction</span>
sock-&gt;close<span class="punctuation">(</span><span class="string">"rw"</span><span class="punctuation">);</span>  <span class="comment-delimiter">//</span><span class="comment">Shut down both directions</span>
sock-&gt;close<span class="punctuation">();</span>      <span class="comment-delimiter">//</span><span class="comment">Close completely</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN949"
>Writing Bidirectional Clients</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN952"
>Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>

<span class="comment-delimiter">//</span><span class="comment">Forking is generally unnecessary in Pike, as the driver works more efficiently with other models.</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN955"
>Pre-Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN958"
>Non-Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>

<span class="comment-delimiter">//</span><span class="comment">Incomplete. There's multiple ways to do this, including:</span>
<span class="comment-delimiter">//</span><span class="comment">1) Threaded server (works like forking but clients can share global state if desired)</span>
<span class="comment-delimiter">//</span><span class="comment">2) Multiplexing using select()</span>
<span class="comment-delimiter">//</span><span class="comment">3) Callback mode (puts the sockets under the control of a Backend which uses select())</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN961"
>Writing a Multi-Homed Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="constant">Stdio</span>.Port mainsock=<span class="constant">Stdio</span>.Port<span class="punctuation">();</span>
<span class="keyword">if</span> <span class="punctuation">(</span>!mainsock-&gt;bind<span class="punctuation">(</span>server_port<span class="punctuation">))</span>
<span class="punctuation">{</span>
    werror<span class="punctuation">(</span><span class="string">"Couldn't be a tcp server on port %d: %s\n"</span>,server_port,strerror<span class="punctuation">(</span>mainsock-&gt;errno<span class="punctuation">()));</span>
    <span class="keyword">return</span> <span class="number">1</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="keyword">while</span> <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span>
<span class="punctuation">{</span>
    <span class="constant">Stdio</span>.File sock=mainsock-&gt;accept<span class="punctuation">();</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>!sock<span class="punctuation">)</span> <span class="keyword">break</span><span class="punctuation">;</span>
    <span class="type">string</span> localaddr=sock-&gt;query_address<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">);</span> <span class="comment-delimiter">//</span><span class="comment">Is the IP address and port connected to.</span>
    <span class="comment-delimiter">//</span><span class="comment">The IP will be that of one of your interfaces, and the port should be equal to server_port</span>
<span class="punctuation">}</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN964"
>Making a Daemon Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="keyword">if</span> <span class="punctuation">(</span>!<span class="constant">System</span>.chroot<span class="punctuation">(</span><span class="string">"/var/daemon"</span><span class="punctuation">))</span> werror<span class="punctuation">(</span><span class="string">"Unable to chroot to /var/daemon: %s\n"</span>,strerror<span class="punctuation">(</span>errno<span class="punctuation">()));</span>
<span class="comment-delimiter">//</span><span class="comment">Incomplete (I don't fork in Pike). See predef::fork() and Process.create_process() for details.</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN967"
>Restarting a Server on Demand</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>
<span class="comment-delimiter">//</span><span class="comment">The best way to restart the server is to adopt a microkernel concept and restart only the parts of</span>
<span class="comment-delimiter">//</span><span class="comment">the server that need updating. However, if you must reload, see Process.exec()</span>
<span class="comment-delimiter">//</span><span class="comment">-----------------------------</span>

</pre>
  </body>
</html></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN970"
>Program: backsniff</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN973"
>Program: fwdport</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="processmanagementetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="internetservices.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Process Management and Communication</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Internet Services</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>internetservices.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Internet Services</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Sockets"
HREF="sockets.html"><LINK
REL="NEXT"
TITLE="CGI Programming"
HREF="cgiprogramming.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sockets.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="cgiprogramming.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INTERNETSERVICES"
>18. Internet Services</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN978"
>Simple DNS Lookups</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN981"
>Being an FTP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN984"
>Sending Mail</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN987"
>Reading and Posting Usenet News Messages</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN990"
>Reading Mail with POP3</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN993"
>Simulating Telnet from a Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN996"
>Pinging a Machine</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN999"
>Using Whois to Retrieve Information from the InterNIC</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1002"
>Program: expn and vrfy</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sockets.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="cgiprogramming.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Sockets</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CGI Programming</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>cgiprogramming.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>CGI Programming</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Internet Services"
HREF="internetservices.html"><LINK
REL="NEXT"
TITLE="Web Automation"
HREF="webautomation.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="internetservices.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="webautomation.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CGIPROGRAMMING"
>19. CGI Programming</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1007"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1010"
>Writing a CGI Script</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1013"
>Redirecting Error Messages</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1016"
>Fixing a 500 Server Error</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1019"
>Writing a Safe CGI Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1022"
>Making CGI Scripts Efficient</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1025"
>Executing Commands Without Shell Escapes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1028"
>Formatting Lists and Tables with HTML Shortcuts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1031"
>Redirecting to a Different Location</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1034"
>Debugging the Raw HTTP Exchange</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1037"
>Managing Cookies</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1040"
>Creating Sticky Widgets</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1043"
>Writing a Multiscreen CGI Script</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1046"
>Saving a Form to a File or Mail Pipe</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1049"
>Program: chemiserie</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="internetservices.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="webautomation.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Internet Services</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Web Automation</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>webautomation.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Web Automation</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="CGI Programming"
HREF="cgiprogramming.html"><LINK
REL="NEXT"
TITLE="Helpers"
HREF="a1102.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="cgiprogramming.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="a1102.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="WEBAUTOMATION"
>20. Web Automation</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1054"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1057"
>Fetching a URL from a Perl Script</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1060"
>Automating Form Submission</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1063"
>Extracting URLs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1066"
>Converting ASCII to HTML</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1069"
>Converting HTML to ASCII</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1072"
>Extracting or Removing HTML Tags</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1075"
>Finding Stale Links</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1078"
>Finding Fresh Links</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1081"
>Creating HTML Templates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1084"
>Mirroring Web Pages</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1087"
>Creating a Robot</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1090"
>Parsing a Web Server Log File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1093"
>Processing Server Logs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1096"
>Program: htmlsub</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1099"
>Program: hrefsub</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="cgiprogramming.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="a1102.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>CGI Programming</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Helpers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><hr><h2>a1102.html</h2>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Helpers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Pike
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Web Automation"
HREF="webautomation.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #ff7f50;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .number {
        /* font-lock-number-face */
        color: #cdcd00;
      }
      .punctuation {
        /* font-lock-punctuation-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #9ac0cd;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="APPENDIX"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Pike
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="webautomation.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
>&nbsp;</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="APPENDIX"
><H1
CLASS="APPENDIX"
><A
NAME="AEN1102"
>A. Helpers</A
></H1
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">// </span><span class="comment">(this section is optional; use it if you need to import very</span>
<span class="comment-delimiter">// </span><span class="comment">generic stuff for the whole code)</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">Note: To avoid clutter each example will only include any necessary</span>
<span class="comment-delimiter">// </span><span class="comment">code. However, it should be understood that:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* The following constants need to be defined:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//    </span><span class="comment">constant FALSE = 0, TRUE = 1, PROBLEM = 1, OK = 0,</span>
<span class="comment-delimiter">//      </span><span class="comment">EOF = -1, NULL = "", NEWLINE = "\n", LF = 10, SPACE = 32;</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">// </span><span class="comment">* Each example needs to be enclosed within the following block:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//    </span><span class="comment">int main(int argc, array(string) argv)</span>
<span class="comment-delimiter">//    </span><span class="comment">{</span>
<span class="comment-delimiter">//      </span><span class="comment">...</span>
<span class="comment-delimiter">//    </span><span class="comment">}</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//   </span><span class="comment">where a 'main' is not provided. Also:</span>
<span class="comment-delimiter">//</span><span class="comment"></span>
<span class="comment-delimiter">//   </span><span class="comment">- Any function definitions would ordinarily be placed</span>
<span class="comment-delimiter">//     </span><span class="comment">before, and outside of, 'main'</span>
<span class="comment-delimiter">//   </span><span class="comment">- Variables can be assumed to be locals residing in 'main';</span>
<span class="comment-delimiter">//     </span><span class="comment">any 'global' variables will be defined at the start of the</span>
<span class="comment-delimiter">//     </span><span class="comment">code example prior to any function definitions</span>

<span class="comment-delimiter">// </span><span class="comment">----------------------------</span>

<span class="type">string</span> chop<span class="punctuation">(</span><span class="type">string</span> s, <span class="type">void</span>|<span class="type">int</span> size<span class="punctuation">)</span>
<span class="punctuation">{</span>
  <span class="type">int</span> length = sizeof<span class="punctuation">(</span>s<span class="punctuation">);</span>
  <span class="keyword">return</span> size &gt; <span class="number">0</span> &amp;&amp; size &lt; length ? s<span class="punctuation">[</span>..length - <span class="punctuation">(</span>size + <span class="number">1</span><span class="punctuation">)]</span> : s<span class="punctuation">;</span>
<span class="punctuation">}</span>
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="webautomation.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Web Automation</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
></TABLE
></DIV
></BODY
></HTML
></body></html>
